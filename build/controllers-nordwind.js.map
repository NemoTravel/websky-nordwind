{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","angular","component","templateUrl","controllerAs","controller","vm","this","close","jQuery","fancybox","2","popupSeatWarningController","isUserAgree","isAgree","agreeWithAirplaneChange","service","active","userAgree","switchDropdown","isDropdownOpen","bindings","3","hideCountriesOnSpecificRouteController","$scope","COUNTRY_CODES_FOR_REMOVE","firstRoute","routes","flights","$watch","origincity","destinationcity","dontFlyToMexico","countries","filter","country","_","contains","app","directive","bindToController","scope","4","isRouteController","backend","$location","onNewSearchOrderFlights","forEach","flightSegment","userFlight","origin","originport","destination","destinationport","redefineBrands","redefineRules","redefineRule","flight","from","to","console","log","flightBrand","brand","brandAvailableProps","brandUnavailableProps","brandPaidProps","originalBrands","getBrandConfig","brands","props","prop","available","push","name","onNewSearchResult","newSearchResult","needToRestoreBrandsInfo","copy","replaceInfo","needToRedefine","replaceInfoInBrandList","brandsList","map","item","needRedefine","segmentRows","segment","segmentFlight","flightsInfo","rules","replaceWithBrand","slice","replaceBrandInfo","brandProp","extend","restoreBrandsInfo","selectedVariantsInfo","rearrangeBrandProps","selectedVariant","originalBrand","getOriginalBrand","availableProps","paidProps","unavailableProps","shortDesc","brandCode","$parent","ready","then","JSON","parse","getAlias","error","bind","searchResult","path","orderInfo","newFlights","scopeAs","5","showAirplanePopupInfoController","fancyboxTools","showPopup","newServiceState","openHandler","showWarningSeatPopup","popupWasAccepted","priority","6","run","$rootScope","redirect","$on","href","location","split","route","pnr","lastName","decodeURIComponent","goToSearchOrder","./components/popup-extra-services-rules/popup-extra-services-rules","./components/popup-seat-warning/popup-seat-warning","./directives/hideCountriesOnSpecificRoute","./directives/replaceWith","./directives/showAirplanePopupInfo","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","7","$routeParams","$window","utils","submitPayment","removeInsuranceAeroexpress","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","resp","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","mode","submitCallback","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","disableOutsideCloseClick","fatalError","paymentFormChangeHandler","reloadPage","reload","clearSession","swithcSubmitButtonHoverState","submitButtonHover","loading","searchOrderLoading","openOrder","event","data","element","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","es","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","8","SearchOrderScreenController","$timeout","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","date","needToSpecifyDocument","orderCompletelyInitialized","updateOrderInfoHandler","addingExtraServicesAllowed","goToAddServices","pnrOrTicketNumber","errorHandler","cb","updateOrderInfo","passengers","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module(\"app\").component(\"popupExtraServicesRules\", {\n    templateUrl: \"components/popup-extra-services-rules/popup-extra-services-rules.html\",\n    controllerAs: \"vm\",\n    controller: function(){\n        var vm = this;\n        vm.close = jQuery.fancybox.close;\n    }\n});\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module(\"app\").component(\"popupSeatWarning\", {\n  templateUrl: \"components/popup-seat-warning/popup-seat-warning.html\",\n  controller: [popupSeatWarningController],\n  controllerAs: \"vm\",\n  bindings: {\n    agreeWithAirplaneChange: \"=\",\n    service: \"=\"\n  }\n});\n\nfunction popupSeatWarningController() {\n  var vm = this;\n  vm.isDropdownOpen = false;\n\n  vm.isUserAgree = isUserAgree;\n  vm.switchDropdown = switchDropdown;\n\n  vm.close = jQuery.fancybox.close;\n\n  function isUserAgree(isAgree) {\n    vm.agreeWithAirplaneChange = isAgree;\n    if (isAgree) {\n      vm.service.active = isAgree;\n      vm.service.userAgree = true;\n      vm.close();\n    } else {\n      vm.service.active = false;\n      vm.close();\n    }\n  }\n\n  function switchDropdown() {\n    vm.isDropdownOpen = !vm.isDropdownOpen;\n  }\n}\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module(\"app\");\n\napp.directive(\"hideCountriesOnSpecificRoute\", function() {\n  return {\n    controller: \"hideCountriesOnSpecificRouteController\",\n    controllerAs: \"vm\",\n    bindToController: true,\n    scope: {\n      routes: \"<\",\n      countries: \"=\",\n      dontFlyToMexico: \"=\",\n    }\n  };\n});\n\napp.controller(\"hideCountriesOnSpecificRouteController\", [\n  \"$scope\",\n  hideCountriesOnSpecificRouteController\n]);\n\nfunction hideCountriesOnSpecificRouteController($scope) {\n  var vm = this;\n\n  var COUNTRY_CODES_FOR_REMOVE = [\n    \"AM\",\n    \"KZ\",\n    \"GE\",\n    \"TJ\",\n    \"UZ\",\n    \"ТМ\",\n    \"AZ\",\n    \"KG\",\n    \"TM\"\n  ];\n\n  var firstRoute = vm.routes[0].flights[0];\n\n  $scope.$watch(\"vm.routes\", function() {\n    if (!vm.routes) {\n      return;\n    }\n\n    if (\n      firstRoute.origincity === \"MOW\" &&\n      firstRoute.destinationcity === \"CUN\"\n    ) {\n      vm.dontFlyToMexico = true;\n      vm.countries = vm.countries.filter(function(country) {\n        return !_.contains(COUNTRY_CODES_FOR_REMOVE, country.code);\n      });\n    } else {\n      vm.dontFlyToMexico = false;\n    }\n  });\n\n\n  // $scope.$watch(\"vm.passengers\", function() {\n  //   if (vm.dontFlyToMexico && !vm.passengersWasFiltered) {\n  //     console.log('here');\n  //     filterPassengers();\n  //   }\n  // });\n  //\n  // function filterPassengers() {\n  //   if (!vm.passengers || !vm.passengers.length) {\n  //     return;\n  //   }\n  //\n  //\n  //   vm.passengers = _.filter(vm.passengers, function(passenger){\n  //       return !_.contains(COUNTRY_CODES_FOR_REMOVE, passenger.nationality);\n  //   });\n  //   console.log(vm.passengers);\n  //\n  //   vm.passengersWasFiltered = true;\n  // }\n}\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', '$location', isRouteController]);\n\nfunction isRouteController($scope, backend, $location) {\n    var vm = $scope.$parent.vm;\n    vm.originalBrands = false;\n    vm.needToRestoreBrandsInfo = false;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.selectedVariantsInfo;\n        }), restoreBrandsInfo);\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.searchResult\n        }), function (newSearchResult) {\n\n            if ($location.path() === '/search-order') {\n                return;\n            }\n\n            onNewSearchResult(newSearchResult);\n        });\n\n        $scope.$watch(angular.bind(this, function () {\n            if (vm.orderInfo) {\n                return vm.orderInfo.flights\n            }\n        }), function (newFlights) {\n            onNewSearchOrderFlights(newFlights);\n        });\n\n    });\n\n\n    function onNewSearchOrderFlights(flights) {\n        if (!flights) {\n            return;\n        }\n\n        _.forEach(flights, function (flightSegment) {\n\n            _.forEach(flightSegment.flights, function (userFlight) {\n                var origin = userFlight.originport ? userFlight.originport : userFlight.origincity;\n                var destination = userFlight.destinationport ? userFlight.destinationport : userFlight.destinationcity;\n\n                var redefineBrands = false;\n\n\n                _.forEach(vm.redefineRules, function (redefineRule) {\n                    _.forEach(redefineRule.routes, function (flight) {\n\n                        if (origin === flight.from && destination === flight.to ||\n                            flight.from === destination && flight.to === origin) {\n                            console.log('we redefine some rules here, check the replacWith directive');\n\n                            redefineBrands = true;\n\n                            var flightBrand = {\n                                brand: userFlight.brand,\n                                brandAvailableProps: userFlight.brandAvailableProps,\n                                brandUnavailableProps: userFlight.brandUnavailableProps,\n                                brandPaidProps: userFlight.brandPaidProps\n                            };\n\n                            var originalBrands = backend.getBrandConfig();\n\n                            var originalBrand = originalBrands.filter(function (brand) {\n                                return brand.code === flightBrand.brand;\n                            })[0];\n\n\n                            _.forEach(redefineRule.brands, function (brand) {\n                                if (flightBrand.brand === brand.brand) {\n                                    var available = [];\n                                    var unavailable = [];\n                                    var paid = [];\n\n                                    _.forEach(brand.props, function (prop) {\n                                        switch (prop.available) {\n                                            case 'yes':\n                                                userFlight.brandAvailableProps.push(prop.name);\n                                                break;\n                                            case 'no':\n                                                userFlight.brandUnavailableProps.push(prop.name);\n                                                break;\n                                            case 'paid':\n                                                userFlight.brandPaidProps.push(prop.name);\n                                                break;\n                                            default:\n                                                break;\n                                        }\n                                    });\n                                }\n                            })\n                        }\n                    });\n                });\n            })\n        })\n\n\n    }\n\n    function onNewSearchResult(newSearchResult) {\n        vm.needToRestoreBrandsInfo = false;\n\n        if (newSearchResult && typeof vm.originalBrands === 'boolean') {\n            // Нужно закэшировать оригинальные бренды\n            // т.к. потом они заменятся а поскольку в js не примитивы передаются по ссылке\n            // нужно будет восстанавливать из этого массива значения если\n            // выбраны направления которые не переопределяются\n            vm.originalBrands = angular.copy(backend.getBrandConfig());\n        }\n        var replaceInfo = false;\n\n        if (needToRedefine(newSearchResult)) {\n            replaceInfo = true;\n        }\n\n        if (replaceInfo) {\n            replaceInfoInBrandList(newSearchResult.brandsList);\n        } else {\n            if (typeof vm.originalBrands !== 'boolean' && newSearchResult.brandsList) {\n                // Восстанавливаем кэшированное значение\n                newSearchResult.brandsList = newSearchResult.brandsList.map(function (e, i) {\n                    return vm.originalBrands.filter(function (item) {\n                        return item.code === e.code;\n                    })[0];\n                });\n\n                vm.needToRestoreBrandsInfo = true;\n            }\n        }\n    }\n\n    function needToRedefine(newSearchResult) {\n        var needRedefine = false;\n        _.forEach(vm.redefineRules, function (redefineRule) {\n            _.forEach(redefineRule.routes, function (flight) {\n                _.forEach(newSearchResult.segmentRows, function (segment) {\n                    _.forEach(segment, function (segmentFlight) {\n                        // если есть конкретный аэропорт вылета, искать по нему\n                        var origin = segmentFlight.flightsInfo.originport ? segmentFlight.flightsInfo.originport : segmentFlight.flightsInfo.origincity;\n                        var destination = segmentFlight.flightsInfo.destinationport ? segmentFlight.flightsInfo.destinationport : segmentFlight.flightsInfo.destinationcity;\n\n                        if (origin === flight.from && destination === flight.to || origin === flight.to && destination === flight.from) {\n                            needRedefine = true;\n                        }\n                    });\n                });\n            });\n        });\n        return needRedefine;\n    }\n\n\n    function replaceInfoInBrandList(brandsList) {\n\n        _.forEach(vm.redefineRules, function (rules) {\n            _.forEach(rules.brands, function (replaceWithBrand) {\n                _.forEach(brandsList.slice(), function (brand) {\n                    if (brand.code === replaceWithBrand.brand) {\n                        replaceBrandInfo(brand, replaceWithBrand)\n                    }\n                })\n            });\n        })\n    }\n\n\n    function replaceBrandInfo(brand, replaceWithBrand) {\n        console.log('we redefine some rules here, head to web.brandConfig.redefine');\n        console.log(brand, replaceWithBrand);\n        _.forEach(brand.props, function (brandProp) {\n            if (replaceWithBrand.props[brandProp.code]) {\n                _.extend(brandProp, replaceWithBrand.props[brandProp.code]);\n            }\n        })\n    }\n\n    function restoreBrandsInfo() {\n        if (!vm.selectedVariantsInfo) {\n            return;\n        }\n\n        if (!vm.needToRestoreBrandsInfo) {\n            return;\n        }\n\n        console.log('restoreBrandsInfo');\n        // console.log(vm.selectedVariantsInfo);\n        // console.log(vm.originalBrands);\n\n\n        _.forEach(vm.selectedVariantsInfo, rearrangeBrandProps);\n    }\n\n    function rearrangeBrandProps(selectedVariant) {\n        var originalBrand = getOriginalBrand(selectedVariant.brand);\n        var availableProps = [];\n        var paidProps = [];\n        var unavailableProps = [];\n\n        _.forEach(originalBrand.props, function (prop) {\n            switch (prop.available) {\n                case 'yes':\n                    if(prop.shortDesc) {\n                        availableProps.push(prop.shortDesc);\n                    } else {\n                        availableProps.push(prop.name);\n                    }\n                    break;\n                case 'paid':\n                    paidProps.push(prop.name);\n                    break;\n                case 'no':\n                    unavailableProps.push(prop.name);\n                    break;\n                default:\n                    return;\n            }\n        });\n\n        selectedVariant.brandAvailableProps = availableProps.slice();\n        selectedVariant.brandPaidProps = paidProps.slice();\n        selectedVariant.brandUnavailableProps = unavailableProps.slice();\n    }\n\n    function getOriginalBrand(brandCode) {\n        return vm.originalBrands.filter(function (brand) {\n            return brand.code === brandCode;\n        })[0]\n    }\n}\n},{}],5:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module(\"app\");\n\napp.directive(\"showAirplanePopup\", function() {\n  return {\n    scope: {\n      service: \"=service\",\n      showWarningSeatPopup: \"=showWarningSeatPopup\",\n      popupWasAccepted: \"=\"\n    },\n    controllerAs: \"vm\",\n    priority: 10000,\n    bindToController: true,\n    controller: \"showAirplanePopupInfoController\"\n  };\n});\n\napp.controller(\"showAirplanePopupInfoController\", [\n  \"$scope\",\n  \"backend\",\n  \"fancyboxTools\",\n  showAirplanePopupInfoController\n]);\n\nfunction showAirplanePopupInfoController($scope, backend, fancyboxTools) {\n  var vm = this;\n  vm.showPopup = null;\n\n  backend.ready.then(function(){\n      vm.showPopup = !!backend.getAlias('web.seatWarning.content').length;\n  });\n\n  $scope.$watch(\"vm.service.active\", function(newServiceState) {\n    if (newServiceState) {\n      if (!vm.service.userAgree && newServiceState === true && vm.showPopup) {\n        vm.service.active = false;\n        fancyboxTools.openHandler(\"popupSeatWarning\");\n      }\n    }\n  });\n}\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\nrequire('./directives/replaceWith');\nrequire('./directives/showAirplanePopupInfo');\nrequire('./directives/hideCountriesOnSpecificRoute');\nrequire('./components/popup-seat-warning/popup-seat-warning');\nrequire('./components/popup-extra-services-rules/popup-extra-services-rules');\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            redirect.goToSearchOrder(pnr, lastName);\n        }\n\n    })\n}]);\n\n},{\"./components/popup-extra-services-rules/popup-extra-services-rules\":1,\"./components/popup-seat-warning/popup-seat-warning\":2,\"./directives/hideCountriesOnSpecificRoute\":3,\"./directives/replaceWith\":4,\"./directives/showAirplanePopupInfo\":5,\"./screens/add-services/AddServicesScreenController\":7,\"./screens/search-order/search-order\":8}],7:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$routeParams', 'backend', 'redirect', '$timeout', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($routeParams, backend, redirect, $timeout) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n        if (\n            $routeParams.pnrOrTicketNumber &&\n            $routeParams.lastName &&\n            backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET'\n        ) {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            $timeout(submitSearch);\n        } else {\n            updateOrderInfoHandler();\n        }\n\n    });\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if (\n            (!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) &&\n            vm.searchOrderForm.$valid\n        ) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler(function () {\n                        console.log('inside updateOrderInfoHandler(callback)');\n                        if (vm.orderInfo.addingExtraServicesAllowed) {\n                            redirect.goToAddServices(vm.searchParams.pnrOrTicketNumber, vm.searchParams.lastName);\n                        }\n                    });\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n\n}\n\n},{}]},{},[6]);\n"]}