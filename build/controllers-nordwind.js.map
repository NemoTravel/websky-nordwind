{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","nwMealPopupController","$scope","backend","fancyboxTools","submit","submitCallback","close","jQuery","fancybox","vm","this","popupId","esCode","setOpenListener","link","params","popup","angular","element","popupWrapper","parents","hasClass","addClass","component","templateUrl","controller","bindToController","controllerAs","bindings","locked","es","transclude","extra-service","2","orderWithEsController","$window","$timeout","utils","redirect","uniqueTabIdGenerator","retryPayment","removeInsuranceAeroexpress","loading","retryRegister","then","resp","pnr","lastName","location","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","openHandler","mode","errorMessage","error","bindOrder","orderInfo","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","clearSession","goToSearchOrder","newBooking","clearLastSearchParams","getAlias","choosePayMethodFailMsg","tabId","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","$on","event","data","popupChoosePayMethodPending","$onInit","resultParam","getParamFromLocation","status","waitPayment","hasFailedServices","paymentRedirectTo","showPaymentFrame","ignoreFailedServices","disableOutsideCloseClick","getParam","hasBonusCard","ffpSumm","ffpBonus","total","app","extra-services","payment","3","isRouteController","$location","onNewSearchOrderFlights","flights","_","forEach","flightSegment","userFlight","origin","originport","origincity","destination","destinationport","destinationcity","redefineBrands","redefineRules","redefineRule","routes","flight","from","to","console","log","flightBrand","brand","brandAvailableProps","brandUnavailableProps","brandPaidProps","originalBrands","getBrandConfig","filter","brands","props","prop","available","push","name","onNewSearchResult","newSearchResult","needToRestoreBrandsInfo","copy","replaceInfo","needToRedefine","replaceInfoInBrandList","brandsList","map","item","needRedefine","segmentRows","segment","segmentFlight","flightsInfo","rules","replaceWithBrand","slice","replaceBrandInfo","brandProp","extend","restoreBrandsInfo","selectedVariantsInfo","rearrangeBrandProps","selectedVariant","originalBrand","getOriginalBrand","availableProps","paidProps","unavailableProps","shortDesc","brandCode","$parent","ready","JSON","parse","$watch","bind","searchResult","path","newFlights","directive","scope","scopeAs","4","config","$compileProvider","debugInfoEnabled","run","$rootScope","href","split","route","decodeURIComponent","./components/nw-meal-popup/nw-meal-popup","./components/order-with-es/order-with-es","./directives/replaceWith","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","5","$routeParams","submitPayment","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","goToConfirmOrder","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","fatalError","paymentFormChangeHandler","reloadPage","reload","swithcSubmitButtonHoverState","submitButtonHover","searchOrderLoading","openOrder","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","6","SearchOrderScreenController","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","date","needToSpecifyDocument","initAddServicesListeners","orderCompletelyInitialized","updateOrderInfoHandler","errorHandler","cb","updateOrderInfo","passengers","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp","pnrOrTicketNumber"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('nwEsPopup', {\n    templateUrl: 'components/nw-meal-popup/nw-meal-popup.html',\n    controller: 'nwMealPopupController',\n    bindToController: true,\n    controllerAs: 'vm',\n    bindings: {\n        locked: '=',\n        esCode: '<',\n        es: '='\n    },\n    transclude: {\n        'extra-service': 'wrap',\n    },\n});\n\n\nangular.module('app').controller('nwMealPopupController', ['$scope', 'backend', 'fancyboxTools', nwMealPopupController]);\n\nfunction nwMealPopupController($scope, backend, fancyboxTools) {\n\n    var vm = this;\n    var submitCallback = false;\n\n    vm.close = close;\n    vm.submit = submit;\n\n    vm.popupId = '#nw-' + vm.esCode + '-popup';\n\n    fancyboxTools.setOpenListener('nw-' + vm.esCode + '-popup', function (link, params) {\n        var popup = angular.element(vm.popupId);\n        var popupWrapper = popup.parents('.fancybox-wrap');\n\n        // нужно прописать класс, чтобы проставить ширину попапа\n        if (!popupWrapper.hasClass('extra-service__popup')) {\n            popupWrapper.addClass('extra-service__popup');\n        }\n\n    });\n\n    function submit() {\n        if (submitCallback) {\n            submitCallback(true);\n            close();\n        }\n    }\n\n    function close() {\n        jQuery.fancybox.close();\n    }\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.component('orderWithEs', {\n    templateUrl: 'components/order-with-es/order-with-es.html',\n    controller: 'orderWithEsController',\n    controllerAs: 'vm',\n    transclude: {\n        'extra-services': 'extraServicesList',\n        'payment': 'div'\n    },\n    bindings: {\n        orderInfo: '='\n    }\n});\n\napp.controller('orderWithEsController', ['$scope', '$window', '$timeout', 'backend',\n    'utils', 'redirect', 'fancyboxTools', 'uniqueTabIdGenerator', orderWithEsController]);\n\nfunction orderWithEsController($scope, $window, $timeout, backend,\n                               utils, redirect, fancyboxTools, uniqueTabIdGenerator) {\n    var vm = this;\n    vm.loading = true;\n    vm.errorMessage = false;\n    vm.choosePayMethodFailMsg = false;\n    vm.tabId = uniqueTabIdGenerator();\n    vm.openExchange = redirect.goToExchange;\n    vm.openRefund = redirect.goToRefund;\n    vm.openAddServices = redirect.goToAddServices;\n    vm.suffixCount = utils.suffixCount;\n\n    vm.retryPayment = retryPayment;\n    vm.bindOrder = bindOrder;\n    vm.clearSession = clearSession;\n    vm.newBooking = newBooking;\n\n    $scope.$on(\"popupChoosePayMethodChoosePayMethodFailMsg\", function (event, data) {\n        vm.choosePayMethodFailMsg = data;\n    });\n\n    $scope.$on(\"popupChoosePayMethodPending\", function (event, data) {\n        vm.popupChoosePayMethodPending = data;\n    });\n\n    vm.$onInit = function () {\n        var resultParam = utils.getParamFromLocation(\"result\");\n\n        if (resultParam === \"success\") {\n            if (\n                vm.orderInfo.header &&\n                (vm.orderInfo.header.status === \"being_paid\" ||\n                    vm.orderInfo.header.status === \"being_paid_for_exchange\")\n            ) {\n                backend\n                    .waitPayment(vm.orderInfo.header.regnum, vm.orderInfo.header.lastName)\n                    .then(\n                        function () {\n                            $window.location =\n                                \"./order?pnr=\" +\n                                vm.orderInfo.header.regnum +\n                                \"&lastName=\" +\n                                vm.orderInfo.header.lastName +\n                                \"&result=success\";\n                            return;\n                        },\n                        function () {\n                            vm.loading = false;\n                        }\n                    );\n            } else {\n                vm.loading = false;\n            }\n        } else {\n            // Платежный фрэйм открывается независимо от статуса заказа\n            // Необходимое условие для оплаты онлайн страховок\n            if (!vm.orderInfo.hasFailedServices && vm.orderInfo.paymentRedirectTo) {\n                vm.showPaymentFrame = true;\n            }\n            vm.loading = false;\n        }\n\n        if (\n            vm.orderInfo.hasFailedServices &&\n            !resultParam &&\n            vm.orderInfo.header &&\n            (vm.orderInfo.header.status === \"being_paid\" ||\n                vm.orderInfo.header.status === \"booked\")\n        ) {\n            $timeout(function () {\n                fancyboxTools.openHandler(\"popupRemovedServicesWarningByOrder\", false, {\n                    submitCallback: function submitCallback() {\n                        if (vm.orderInfo.paymentRedirectTo) {\n                            vm.showPaymentFrame = true;\n                        }\n                        vm.ignoreFailedServices = true;\n                    },\n\n                    disableOutsideCloseClick: true\n                });\n            });\n        }\n\n        if (\n            backend.getParam(\"ffp.enable\") &&\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\n        ) {\n            backend.ffpBonus().then(function (resp) {\n                vm.ffpBonus = resp.total || 0;\n            });\n        }\n    };\n\n    function retryPayment(removeInsuranceAeroexpress) {\n        vm.loading = true;\n        backend.retryRegister(removeInsuranceAeroexpress).then(\n            function (resp) {\n                if (resp.pnr && resp.lastName) {\n                    $window.location =\n                        \"./order?pnr=\" + resp.pnr + \"&lastName=\" + resp.lastName;\n                } else if (\n                    resp.eraseAeroexpressBecauseOfCurrency ||\n                    resp.eraseInsuranceBecauseOfCurrency\n                ) {\n                    fancyboxTools.openHandler(\"popupChangeCurrencyError\", false, {\n                        eraseAeroexpressBecauseOfCurrency:\n                        resp.eraseAeroexpressBecauseOfCurrency,\n                        eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                        mode: \"retryRegister\",\n                        submitCallback: retryPayment\n                    });\n                }\n                vm.loading = false;\n            },\n            function (resp) {\n                vm.loading = false;\n                vm.errorMessage = resp.error;\n            }\n        );\n    }\n\n    function bindOrder() {\n        if (\n            !vm.orderInfo.header ||\n            !vm.orderInfo.header.regnum ||\n            !vm.orderInfo.header.lastName\n        ) {\n            return;\n        }\n        vm.loading = true;\n        backend\n            .bindOrder(vm.orderInfo.header.regnum, vm.orderInfo.header.lastName)\n            .then(\n                function () {\n                    vm.loading = false;\n                    vm.orderInfo.bindAlowed = false;\n                    vm.showBindOrderSuccessMessage = true;\n                    $timeout(function () {\n                        vm.showBindOrderSuccessMessage = false;\n                    }, 10000);\n                },\n                function () {\n                    vm.loading = false;\n                    vm.showBindOrderFailMessage = true;\n                    $timeout(function () {\n                        vm.showBindOrderFailMessage = false;\n                    }, 10000);\n                }\n            );\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function newBooking() {\n        backend.clearLastSearchParams().then(function () {\n            $window.location = backend.getAlias(\"web.site.firstStepUrl\");\n        });\n    }\n}\n},{}],3:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', '$location', isRouteController]);\n\nfunction isRouteController($scope, backend, $location) {\n    var vm = $scope.$parent.vm;\n    vm.originalBrands = false;\n    vm.needToRestoreBrandsInfo = false;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.selectedVariantsInfo;\n        }), restoreBrandsInfo);\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.searchResult\n        }), function (newSearchResult) {\n\n            if ($location.path() === '/search-order') {\n                return;\n            }\n\n            onNewSearchResult(newSearchResult);\n        });\n\n        $scope.$watch(angular.bind(this, function () {\n            if (vm.orderInfo) {\n                return vm.orderInfo.flights\n            }\n        }), function (newFlights) {\n            onNewSearchOrderFlights(newFlights);\n        });\n\n    });\n\n\n    function onNewSearchOrderFlights(flights) {\n        if (!flights) {\n            return;\n        }\n\n        _.forEach(flights, function (flightSegment) {\n\n            _.forEach(flightSegment.flights, function (userFlight) {\n                var origin = userFlight.originport ? userFlight.originport : userFlight.origincity;\n                var destination = userFlight.destinationport ? userFlight.destinationport : userFlight.destinationcity;\n\n                var redefineBrands = false;\n\n\n                _.forEach(vm.redefineRules, function (redefineRule) {\n                    _.forEach(redefineRule.routes, function (flight) {\n\n                        if (origin === flight.from && destination === flight.to ||\n                            flight.from === destination && flight.to === origin) {\n                            console.log('we redefine some rules here, check the replacWith directive');\n\n                            redefineBrands = true;\n\n                            var flightBrand = {\n                                brand: userFlight.brand,\n                                brandAvailableProps: userFlight.brandAvailableProps,\n                                brandUnavailableProps: userFlight.brandUnavailableProps,\n                                brandPaidProps: userFlight.brandPaidProps\n                            };\n\n                            var originalBrands = backend.getBrandConfig();\n\n                            var originalBrand = originalBrands.filter(function (brand) {\n                                return brand.code === flightBrand.brand;\n                            })[0];\n\n\n                            _.forEach(redefineRule.brands, function (brand) {\n                                if (flightBrand.brand === brand.brand) {\n                                    var available = [];\n                                    var unavailable = [];\n                                    var paid = [];\n\n                                    _.forEach(brand.props, function (prop) {\n                                        switch (prop.available) {\n                                            case 'yes':\n                                                userFlight.brandAvailableProps.push(prop.name);\n                                                break;\n                                            case 'no':\n                                                userFlight.brandUnavailableProps.push(prop.name);\n                                                break;\n                                            case 'paid':\n                                                userFlight.brandPaidProps.push(prop.name);\n                                                break;\n                                            default:\n                                                break;\n                                        }\n                                    });\n                                }\n                            })\n                        }\n                    });\n                });\n            })\n        })\n\n\n    }\n\n    function onNewSearchResult(newSearchResult) {\n        vm.needToRestoreBrandsInfo = false;\n\n        if (newSearchResult && typeof vm.originalBrands === 'boolean') {\n            // Нужно закэшировать оригинальные бренды\n            // т.к. потом они заменятся а поскольку в js не примитивы передаются по ссылке\n            // нужно будет восстанавливать из этого массива значения если\n            // выбраны направления которые не переопределяются\n            vm.originalBrands = angular.copy(backend.getBrandConfig());\n        }\n        var replaceInfo = false;\n\n        if (needToRedefine(newSearchResult)) {\n            replaceInfo = true;\n        }\n\n        if (replaceInfo) {\n            replaceInfoInBrandList(newSearchResult.brandsList);\n        } else {\n            if (typeof vm.originalBrands !== 'boolean' && newSearchResult.brandsList) {\n                // Восстанавливаем кэшированное значение\n                newSearchResult.brandsList = newSearchResult.brandsList.map(function (e, i) {\n                    return vm.originalBrands.filter(function (item) {\n                        return item.code === e.code;\n                    })[0];\n                });\n\n                vm.needToRestoreBrandsInfo = true;\n            }\n        }\n    }\n\n    function needToRedefine(newSearchResult) {\n        var needRedefine = false;\n        _.forEach(vm.redefineRules, function (redefineRule) {\n            _.forEach(redefineRule.routes, function (flight) {\n                _.forEach(newSearchResult.segmentRows, function (segment) {\n                    _.forEach(segment, function (segmentFlight) {\n                        // если есть конкретный аэропорт вылета, искать по нему\n                        var origin = segmentFlight.flightsInfo.originport ? segmentFlight.flightsInfo.originport : segmentFlight.flightsInfo.origincity;\n                        var destination = segmentFlight.flightsInfo.destinationport ? segmentFlight.flightsInfo.destinationport : segmentFlight.flightsInfo.destinationcity;\n\n                        if (origin === flight.from && destination === flight.to || origin === flight.to && destination === flight.from) {\n                            needRedefine = true;\n                        }\n                    });\n                });\n            });\n        });\n        return needRedefine;\n    }\n\n\n    function replaceInfoInBrandList(brandsList) {\n\n        _.forEach(vm.redefineRules, function (rules) {\n            _.forEach(rules.brands, function (replaceWithBrand) {\n                _.forEach(brandsList.slice(), function (brand) {\n                    if (brand.code === replaceWithBrand.brand) {\n                        replaceBrandInfo(brand, replaceWithBrand)\n                    }\n                })\n            });\n        })\n    }\n\n\n    function replaceBrandInfo(brand, replaceWithBrand) {\n        console.log('we redefine some rules here, head to web.brandConfig.redefine');\n        console.log(brand, replaceWithBrand);\n        _.forEach(brand.props, function (brandProp) {\n            if (replaceWithBrand.props[brandProp.code]) {\n                _.extend(brandProp, replaceWithBrand.props[brandProp.code]);\n            }\n        })\n    }\n\n    function restoreBrandsInfo() {\n        if (!vm.selectedVariantsInfo) {\n            return;\n        }\n\n        if (!vm.needToRestoreBrandsInfo) {\n            return;\n        }\n\n        console.log('restoreBrandsInfo');\n        // console.log(vm.selectedVariantsInfo);\n        // console.log(vm.originalBrands);\n\n\n        _.forEach(vm.selectedVariantsInfo, rearrangeBrandProps);\n    }\n\n    function rearrangeBrandProps(selectedVariant) {\n        var originalBrand = getOriginalBrand(selectedVariant.brand);\n        var availableProps = [];\n        var paidProps = [];\n        var unavailableProps = [];\n\n        _.forEach(originalBrand.props, function (prop) {\n            switch (prop.available) {\n                case 'yes':\n                    if(prop.shortDesc) {\n                        availableProps.push(prop.shortDesc);\n                    } else {\n                        availableProps.push(prop.name);\n                    }\n                    break;\n                case 'paid':\n                    paidProps.push(prop.name);\n                    break;\n                case 'no':\n                    unavailableProps.push(prop.name);\n                    break;\n                default:\n                    return;\n            }\n        });\n\n        selectedVariant.brandAvailableProps = availableProps.slice();\n        selectedVariant.brandPaidProps = paidProps.slice();\n        selectedVariant.brandUnavailableProps = unavailableProps.slice();\n    }\n\n    function getOriginalBrand(brandCode) {\n        return vm.originalBrands.filter(function (brand) {\n            return brand.code === brandCode;\n        })[0]\n    }\n}\n},{}],4:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\nrequire('./directives/replaceWith');\nrequire('./components/nw-meal-popup/nw-meal-popup');\nrequire('./components/order-with-es/order-with-es');\n\n// TODO: remove it!!\nangular.module('app').config(['$compileProvider', function ($compileProvider) {\n    $compileProvider.debugInfoEnabled(true);\n}]);\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            redirect.goToSearchOrder(pnr, lastName);\n        }\n\n    })\n}]);\n\n},{\"./components/nw-meal-popup/nw-meal-popup\":1,\"./components/order-with-es/order-with-es\":2,\"./directives/replaceWith\":3,\"./screens/add-services/AddServicesScreenController\":5,\"./screens/search-order/search-order\":6}],5:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$scope', '$routeParams', 'backend',\n        'redirect', '$timeout', 'utils', 'fancyboxTools', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($scope, $routeParams, backend, redirect, $timeout, utils, fancyboxTools) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitPayment = submitPayment;\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n\n        if (\n            $routeParams.pnrOrTicketNumber &&\n            $routeParams.lastName &&\n            backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET'\n        ) {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            console.log('submit search');\n            $timeout(submitSearch);\n        } else {\n            console.log('else block');\n            updateOrderInfoHandler();\n            initAddServicesListeners();\n        }\n\n        // add-services logic\n        backend.addOrderInfoListener(function (orderInfo) {\n            console.log('add order info listener');\n            vm.orderInfo = orderInfo;\n        });\n\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType,\n            removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if (\n            (!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) &&\n            vm.searchOrderForm.$valid\n        ) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n                initAddServicesListeners();\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler();\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function initAddServicesListeners() {\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n\n\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}\n\n},{}]},{},[4]);\n"]}