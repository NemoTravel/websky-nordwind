{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","angular","run","$rootScope","redirect","backend","$on","href","location","split","route","pnr","lastName","decodeURIComponent","searchOrder","then","resp","addingExtraServicesAllowed","goToAddServices","goToSearchOrder","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","2","controller","$scope","$routeParams","$window","utils","fancyboxTools","submitPayment","removeInsuranceAeroexpress","vm","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","openHandler","mode","submitCallback","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","disableOutsideCloseClick","error","fatalError","paymentFormChangeHandler","reloadPage","reload","clearSession","swithcSubmitButtonHoverState","submitButtonHover","this","loading","searchOrderLoading","openOrder","event","data","ready","element","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","orderInfo","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","es","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","3","SearchOrderScreenController","$timeout","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","flight","date","needToSpecifyDocument","orderCompletelyInitialized","updateOrderInfoHandler","pnrOrTicketNumber","errorHandler","cb","updateOrderInfo","passengers","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp"],"mappings":"CAAA,WAAY,QAASA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAE,kBAAmBC,UAASA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,GAAGF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAQ,IAAI,GAAIL,GAAE,kBAAmBD,UAASA,QAAQH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,GAAE,MAAOJ,OAAOiB,GAAG,SAAST,EAAQU,EAAOJ,GACxe,YACAN,GAAQ,sDACRA,EAAQ,uCAERW,QAAQD,OAAO,OAAOE,KAAK,aAAc,WAAY,UAAW,SAAUC,EAAYC,EAAUC,GAC5FF,EAAWG,IAAI,uBAAwB,SAAUvB,GAE7C,GAAIwB,GAAOC,SAASD,KAAKE,MAAM,KAAK,EAEpCF,GAAOA,EAAKE,MAAM,IAElB,IAAIC,GAAQH,EAAK,GACbI,EAAMJ,EAAK,GACXK,EAAWL,EAAK,EAGN,kBAAVG,GAA4BC,GAAOC,IACnCA,EAAWC,mBAAmBD,GAE9BP,EAAQS,YAAYH,EAAKC,GAAUG,KAAK,SAAUC,GAC1CA,EAAKC,2BACLb,EAASc,kBAETd,EAASe,gBAAgBR,EAAKC,aAS/CQ,qDAAqD,EAAEC,sCAAsC,IAAIC,GAAG,SAAShC,EAAQU,EAAOJ,GAC/H,YAGAK,SAAQD,OAAO,OAAOuB,WAAW,+BAAgC,SAAU,eAAgB,UAAW,WAAY,UAAW,QAAS,gBAAiB,SAAUC,EAAQC,EAAcC,EAAStB,EAAUC,EAASsB,EAAOC,GAkFtN,QAASC,GAAcC,IACfC,EAAGC,OAAUD,EAAGE,uBAA0BF,EAAGG,uBACzCH,EAAGI,qBAAuBJ,EAAGK,oBAC7BC,EAAqBP,GAErBC,EAAGO,iCAAkC,GAKjD,QAASD,GAAqBP,EAA4BS,EAAOC,GAC7DT,EAAGU,gBAAiB,EAEhBV,EAAGW,oBACIX,GAAGW,aAGdrC,EAAQsC,6BAA6BZ,EAAGI,oBAAqBJ,EAAGK,oBAAqBN,EAA4BS,EAAOC,EAAOT,EAAGa,MAAM7B,KAAK,SAAUC,GAC/IA,EAAKL,KAAOK,EAAKJ,SACjBR,EAASyC,mBACF7B,EAAK8B,mCAAqC9B,EAAK+B,gCACtDnB,EAAcoB,YAAY,4BAA4B,GAClDF,kCAAmC9B,EAAK8B,kCACxCC,gCAAiC/B,EAAK+B,gCACtCE,KAAM,cACNC,eAAgBrB,IAEbb,EAAKmC,aAAenC,EAAKmC,YAAYrD,QAC5C8B,EAAcoB,YAAY,+BAA+B,GACrDE,eAAgB,WACZb,EAAqBP,EAA4BS,EAAOC,IAE5DY,cAAe,WACX/C,EAAQgD,qBAAoB,IAGhCF,YAAanC,EAAKmC,YAClBG,YAAatC,EAAKsC,YAClBC,oBAAqBvC,EAAKuC,oBAC1BC,0BAA0B,IAIlCzB,EAAGU,gBAAiB,GACrB,SAAUzB,GACU,uCAAfA,EAAKyC,MACL1B,EAAG2B,WAAa1C,EAAKyC,MAErB1B,EAAGW,aAAe1B,EAAKyC,MAG3B1B,EAAGU,gBAAiB,IAI5B,QAASkB,KACL5B,EAAGO,iCAAkC,EAGzC,QAASsB,KAEL,MADAlC,GAAQlB,SAASqD,UACV,EAGX,QAASC,KACLzD,EAAQyD,eAAe/C,KAAK,WACxBX,EAASe,oBAIjB,QAAS4C,KACLhC,EAAGiC,mBAAqBjC,EAAGiC,kBAxJ/B,GAAIjC,GAAKkC,IAETlC,GAAGmC,SAAU,EACbnC,EAAGoC,oBAAqB,EACxBpC,EAAGG,sBAAuB,EAE1BH,EAAGqC,UAAYhE,EAASe,gBACxBY,EAAGF,cAAgBA,EACnBE,EAAG4B,yBAA2BA,EAC9B5B,EAAG6B,WAAaA,EAChB7B,EAAG+B,aAAeA,EAClB/B,EAAGgC,6BAA+BA,EAElCvC,EAAOlB,IAAI,mCAAoC,SAAU+D,EAAOC,GAC5DvC,EAAGa,KAAO0B,IAGdjE,EAAQkE,MAAMxD,KAAK,WACfd,QAAQuE,QAAQ,SAASC,KAAKpE,EAAQqE,mBAAmB,iBAAkB,gBAE3E3C,EAAGmC,SAAU,EAEb7D,EAAQsE,0BACRtE,EAAQuE,oCAERvE,EAAQwE,qBAAqB,SAAUC,GACnC/C,EAAG+C,UAAYA,IAGnBzE,EAAQ0E,+BAA+B,SAAU/D,GAC7Ce,EAAG+C,UAAY9D,EAAK,GACpBe,EAAGiD,aAAehE,EAAK,GACvBe,EAAGkD,mBAAqBtD,EAAMsD,mBAAmBjE,EAAK,IAElDe,EAAGkD,qBACHlD,EAAGO,iCAAkC,GAGzCP,EAAGmD,GAAKvD,EAAMwD,+BAA+BnE,EAAK,GAAIe,EAAG+C,UAAW/C,EAAGmD,IACvEnD,EAAGqD,OAASzD,EAAM0D,8BAA8BrE,EAAK,GAAIe,EAAGmD,IAE5DnD,EAAGoC,oBAAqB,EACxBpC,EAAGG,sBAAuB,EAEtB7B,EAAQiF,SAAS,gBAAkBvD,EAAG+C,UAAUS,cAAgBxD,EAAG+C,UAAUU,UAC7EnF,EAAQoF,WAAW1E,KAAK,SAAUC,GAC9Be,EAAG0D,SAAWzE,EAAK0E,OAAS,KAGrC,SAAU1E,GACTe,EAAGoC,oBAAqB,EACxBpC,EAAGG,sBAAuB,EAC1BH,EAAG4D,aAAe3E,EAAKyC,QAG3BpD,EAAQgD,qBAAoB,GAAMtC,KAAK,WACnCgB,EAAGmC,SAAU,EAEb7D,EAAQuF,8BAA8B7D,EAAGqD,OAAQrD,EAAGmD,GAAInD,EAAG+C,WAAW/D,KAAK,WACvEgB,EAAGmC,SAAU,GACd,SAAUlD,GACTe,EAAG4D,aAAe3E,EAAKyC,MACvB1B,EAAGmC,SAAU,MAIrB7D,EAAQwF,wBAAwB,SAAUC,GACtC/D,EAAGE,uBAAyB6D,EAC5B/D,EAAGG,sBAAuB,IAG9B7B,EAAQ0F,6BAA6B,SAAU/E,EAAMgF,GAC5CA,GAAoB,SAAbA,EAAItG,OACZqC,EAAGkE,oBAAsBjF,EAAKyC,OAGlC1B,EAAGE,uBAAwB,EAC3BF,EAAGG,sBAAuB,cA+EhCgE,GAAG,SAAS5G,EAAQU,EAAOJ,GACjC,YAQA,SAASuG,GAA4B1E,EAAcpB,EAASD,EAAUgG,GA8BlE,QAASC,KACLhG,EAAQyD,eACRzD,EAAQiG,iBACRvE,EAAG+C,WAAY,EACf/C,EAAGwE,gBAAiB,EACpBxE,EAAGyE,4BAGP,QAASC,KACL1E,EAAG2E,eAAgB,EACbrG,EAAQiF,SAAS,sCAAuCvD,EAAG4E,mBAAqB5E,EAAG6E,gBAAgBC,SACrG9E,EAAG+E,eAAgB,EACnB/E,EAAG4D,cAAe,EAClBtF,EAAQ0G,oBAAoBhF,EAAGiF,eAAgBjF,EAAGyE,yBAAyB1G,QAAQiB,KAAK,SAAUC,GAC1Fe,EAAGiF,aAAaC,QAAUlF,EAAGiF,aAAaE,KAC1CnF,EAAGiF,cACCC,OAAQlF,EAAGiF,aAAaC,OACxBC,KAAMnF,EAAGiF,aAAaE,MAElBlG,EAAKmG,wBACbpF,EAAGiF,iBAEPjF,EAAGoF,sBAAwBnG,EAAKmG,sBAChCpF,EAAGwE,gBAAiB,EACpBxE,EAAG2E,eAAgB,EAGf1F,EAAKoG,4BACLrF,EAAGyE,4BAIHa,EAAuB,WACftF,EAAG+C,UAAU7D,4BACbb,EAASc,gBAAgBa,EAAGiF,aAAaM,kBAAmBvF,EAAGiF,aAAapG,cAIhFI,EAAKwF,2BACLzE,EAAGyE,yBAA2BxF,EAAKwF,0BAEnCzE,EAAGoF,wBACHpF,EAAGwE,gBAAiB,IAG5BxE,EAAG+E,eAAgB,GACpBS,IAIX,QAASF,GAAuBG,GAC5BnH,EAAQoH,kBAAkB1G,KAAK,SAAU+D,GACjCA,EAAU4C,aACV3F,EAAG+C,UAAYA,EACf/C,EAAGwE,gBAAiB,EACF,kBAAPiB,IACPA,KAGRzF,EAAGmC,SAAU,GACdqD,GAGP,QAASA,GAAavG,GAClBe,EAAGmC,SAAU,EACbnC,EAAG+E,eAAgB,EACA,4BAAf9F,EAAKyC,QACL1B,EAAG4D,aAAe3E,EAAKyC,OAI/B,QAASkE,KACLtH,EAAQuH,iCAAiC7G,KAAKsG,EAAwBE,GAG1E,QAASM,KACL9F,EAAGwE,gBAAiB,EAxGxB,GAAIxE,GAAKkC,IACTlC,GAAGmC,SAAU,EACbnC,EAAGwE,gBAAiB,EACpBxE,EAAGiF,gBACHjF,EAAGyE,4BACHzE,EAAG0E,aAAeA,EAClB1E,EAAG4F,eAAiBA,EACpB5F,EAAGsE,MAAQA,EACXtE,EAAG8F,aAAeA,EAElBxH,EAAQkE,MAAMxD,KAAK,WAEfd,QAAQuE,QAAQ,SAASC,KAAKpE,EAAQqE,mBAAmB,iBAAkB,gBAE3E3C,EAAG+F,wBAA0BzH,EAAQ0H,qBAAqBD,wBAC1D/F,EAAGiG,kBAAoB3H,EAAQ0H,qBAAqBC,kBACpDjG,EAAGkG,aAAe5H,EAAQ0H,qBAAqBE,aAE3CxG,EAAa6F,mBAAqB7F,EAAab,UAAwD,yBAA5CP,EAAQiF,SAAS,wBAC5EvD,EAAGiF,aAAaM,kBAAoB7F,EAAa6F,kBACjDvF,EAAGiF,aAAapG,SAAWa,EAAab,SACxCmB,EAAGmC,SAAU,EACbkC,EAASK,IAETY,MA/BZpH,QAAQD,OAAO,OAAOuB,WAClB,+BACC,eAAgB,UAAW,WAAY,WAAY4E,cAiH7C","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            backend.searchOrder(pnr, lastName).then(function (resp) {\n                if (resp.addingExtraServicesAllowed) {\n                    redirect.goToAddServices();\n                } else {\n                    redirect.goToSearchOrder(pnr, lastName);\n                }\n            });\n\n        }\n\n    })\n}]);\n\n},{\"./screens/add-services/AddServicesScreenController\":2,\"./screens/search-order/search-order\":3}],2:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$routeParams', 'backend', 'redirect', '$timeout', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($routeParams, backend, redirect, $timeout) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n        if ($routeParams.pnrOrTicketNumber && $routeParams.lastName && backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET') {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            $timeout(submitSearch);\n        } else {\n            updateOrderInfoHandler();\n        }\n    });\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if ((!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) && vm.searchOrderForm.$valid) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler(function () {\n                        if (vm.orderInfo.addingExtraServicesAllowed) {\n                            redirect.goToAddServices(vm.searchParams.pnrOrTicketNumber, vm.searchParams.lastName);\n                        }\n                    });\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n}\n\n},{}]},{},[1]);\n"]}