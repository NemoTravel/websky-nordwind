{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","angular","run","$rootScope","redirect","backend","$on","href","location","split","route","pnr","lastName","decodeURIComponent","goToSearchOrder","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","2","controller","$scope","$routeParams","$window","utils","fancyboxTools","submitPayment","removeInsuranceAeroexpress","vm","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","then","resp","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","openHandler","mode","submitCallback","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","disableOutsideCloseClick","error","fatalError","paymentFormChangeHandler","reloadPage","reload","clearSession","swithcSubmitButtonHoverState","submitButtonHover","this","loading","searchOrderLoading","openOrder","event","data","ready","element","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","orderInfo","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","es","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","3","SearchOrderScreenController","$timeout","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","flight","date","needToSpecifyDocument","orderCompletelyInitialized","updateOrderInfoHandler","addingExtraServicesAllowed","goToAddServices","pnrOrTicketNumber","errorHandler","cb","updateOrderInfo","passengers","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            redirect.goToSearchOrder(pnr, lastName);\n        }\n\n    })\n}]);\n\n},{\"./screens/add-services/AddServicesScreenController\":2,\"./screens/search-order/search-order\":3}],2:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$routeParams', 'backend', 'redirect', '$timeout', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($routeParams, backend, redirect, $timeout) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n        if ($routeParams.pnrOrTicketNumber && $routeParams.lastName && backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET') {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            $timeout(submitSearch);\n        } else {\n            updateOrderInfoHandler();\n        }\n    });\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if ((!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) && vm.searchOrderForm.$valid) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler(function () {\n                        if (vm.orderInfo.addingExtraServicesAllowed) {\n                            redirect.goToAddServices(vm.searchParams.pnrOrTicketNumber, vm.searchParams.lastName);\n                        }\n                    });\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n}\n\n},{}]},{},[1]);\n"]}