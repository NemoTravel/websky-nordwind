{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","isRouteController","$scope","backend","replaceInfoInBrandList","brandsList","_","forEach","vm","redefineRules","rules","brands","replaceWithBrand","slice","brand","replaceBrandInfo","console","log","props","brandProp","extend","$parent","originalBrands","ready","then","JSON","parse","getAlias","error","$watch","angular","bind","this","searchResult","newSearchResult","copy","getBrandConfig","replaceInfo","redefineRule","routes","flight","segmentRows","segment","segmentFlight","flightsInfo","origincity","from","destinationcity","to","map","filter","item","app","directive","scope","controllerAs","bindToController","scopeAs","controller","2","run","$rootScope","redirect","$on","href","location","split","route","pnr","lastName","decodeURIComponent","goToSearchOrder","./directives/replaceWith","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","3","$routeParams","$window","utils","fancyboxTools","submitPayment","removeInsuranceAeroexpress","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","resp","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","openHandler","mode","submitCallback","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","disableOutsideCloseClick","fatalError","paymentFormChangeHandler","reloadPage","reload","clearSession","swithcSubmitButtonHoverState","submitButtonHover","loading","searchOrderLoading","openOrder","event","data","element","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","orderInfo","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","es","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","4","SearchOrderScreenController","$timeout","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","date","needToSpecifyDocument","orderCompletelyInitialized","updateOrderInfoHandler","addingExtraServicesAllowed","goToAddServices","pnrOrTicketNumber","errorHandler","cb","updateOrderInfo","passengers","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', isRouteController]);\n\nfunction isRouteController($scope, backend) {\n    var vm = $scope.$parent.vm;\n    vm.originalBrands = false;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n    });\n\n    $scope.$watch(angular.bind(this, function () {\n        return vm.searchResult\n    }), function (newSearchResult) {\n\n        if (newSearchResult && typeof vm.originalBrands === 'boolean') {\n            // Нужно закэшировать оригинальные бренды\n            // т.к. потом они заменятся а поскольку в js не примитивы передаются по ссылке\n            // нужно будет восстанавливать из этого массива значения если\n            // выбраны направления которые не переопределяются\n            vm.originalBrands = angular.copy(backend.getBrandConfig());\n        }\n\n        var replaceInfo = false;\n        _.forEach(vm.redefineRules, function (redefineRule) {\n            _.forEach(redefineRule.routes, function (flight) {\n                _.forEach(newSearchResult.segmentRows, function (segment) {\n                    _.forEach(segment, function (segmentFlight) {\n                        if (segmentFlight.flightsInfo.origincity === flight.from && segmentFlight.flightsInfo.destinationcity === flight.to) {\n                            replaceInfo = true;\n                        }\n                    })\n                })\n            });\n        });\n\n        if (replaceInfo) {\n            replaceInfoInBrandList(newSearchResult.brandsList);\n        } else {\n            if (typeof vm.originalBrands !== 'boolean' && newSearchResult.brandsList) {\n                // Восстанавливаем кэшированное значение\n                newSearchResult.brandsList = newSearchResult.brandsList.map(function (e, i) {\n                    return vm.originalBrands.filter(function (item) {\n                        return item.code === e.code;\n                    })[0];\n                });\n                console.log(newSearchResult.brandsList);\n            }\n        }\n\n    }, true);\n\n\n    function replaceInfoInBrandList(brandsList) {\n\n        _.forEach(vm.redefineRules, function (rules) {\n            _.forEach(rules.brands, function (replaceWithBrand) {\n                _.forEach(brandsList.slice(), function (brand) {\n                    if (brand.code === replaceWithBrand.brand) {\n                        replaceBrandInfo(brand, replaceWithBrand)\n                    }\n                })\n            });\n        })\n    }\n\n\n    function replaceBrandInfo(brand, replaceWithBrand) {\n        console.log('we redefine some rules here, head to web.brandConfig.redefine');\n        console.log(brand, replaceWithBrand);\n        _.forEach(brand.props, function (brandProp) {\n            if (replaceWithBrand.props[brandProp.code]) {\n                _.extend(brandProp, replaceWithBrand.props[brandProp.code]);\n            }\n        })\n    }\n}\n},{}],2:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\nrequire('./directives/replaceWith');\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            redirect.goToSearchOrder(pnr, lastName);\n        }\n\n    })\n}]);\n\n},{\"./directives/replaceWith\":1,\"./screens/add-services/AddServicesScreenController\":3,\"./screens/search-order/search-order\":4}],3:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$routeParams', 'backend', 'redirect', '$timeout', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($routeParams, backend, redirect, $timeout) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n        if (\n            $routeParams.pnrOrTicketNumber &&\n            $routeParams.lastName &&\n            backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET'\n        ) {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            $timeout(submitSearch);\n        } else {\n            updateOrderInfoHandler();\n        }\n\n    });\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if (\n            (!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) &&\n            vm.searchOrderForm.$valid\n        ) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler(function () {\n                        console.log('inside updateOrderInfoHandler(callback)');\n                        if (vm.orderInfo.addingExtraServicesAllowed) {\n                            redirect.goToAddServices(vm.searchParams.pnrOrTicketNumber, vm.searchParams.lastName);\n                        }\n                    });\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n\n}\n\n},{}]},{},[2]);\n"]}