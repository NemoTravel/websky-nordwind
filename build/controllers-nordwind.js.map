{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","nordwindEsController","backend","utils","handleEsSelect","esCode","vm","selected","console","log","this","ready","then","getExtraServices","extraServices","extraServicesList","slice","getAvailableExtraServicesList","orderInfo","angular","component","templateUrl","bindings","controller","controllerAs","2","nordwindMealController","service","3","./components/nordwind-es/nordwind-es","./components/nordwind-meal/nordwind-meal","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","4","$scope","$routeParams","$window","redirect","fancyboxTools","orderReadyHandler","addOrderInfoListener","addUpdateOrderServicesListener","resp","priceVariant","isFreePricevariant","showNeedSelectPaymentFormMesage","es","reformatAvailableExtraServices","esList","searchOrderLoading","orderServicesLoading","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","error","showBackButton","updateOrderServices","loading","switchDefaultSelectedServices","addExtraServiceListener","state","modifyServicesLoading","addExtraServiceErrorListener","req","modifyServicesError","submitPayment","removeInsuranceAeroexpress","agree","selectedPaymentForm","selectedPaymentType","openHandler","phoneRequiredToo","submitCallback","email","phone","submitPaymentConfirm","confirmLoading","confirmError","startPaymentForExtraServices","card","pnr","lastName","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","mode","removedSvcs","closeCallback","svcsToIssue","noExtraServicesLeft","disableOutsideCloseClick","fatalError","paymentFormChangeHandler","reloadPage","location","reload","openOrder","pnrOrTicketNumber","goToViewSeparateOrder","goToSearchOrder","clearSession","$on","event","data","element","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","getOrderInfo","searchOrder","5","SearchOrderScreenController","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","goToAddServices","searchParams","clear","goToSearchSeparateOrder","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","clearOrderInfo","orderLoaded"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('nordwindEs', {\n    templateUrl: 'components/nordwind-es/nordwind-es.html',\n    bindings: {\n        orderInfo: '='\n    },\n    controller: ['backend', 'utils', nordwindEsController],\n    controllerAs: 'vm'\n});\n\n\nfunction nordwindEsController(backend, utils) {\n    var vm = this;\n\n    vm.selected = null;\n    vm.handleEsSelect = handleEsSelect;\n\n    backend.ready.then(function () {\n\n        backend.getExtraServices().then(function (extraServices) {\n            vm.extraServicesList = extraServices.slice();\n            // console.log(vm.extraServicesList);\n            // ??? isnt working!\n            console.log(utils.getAvailableExtraServicesList(extraServices, vm.orderInfo, vm.extraServicesList));\n        });\n    });\n\n    function handleEsSelect(esCode) {\n        vm.selected = esCode;\n        console.log(vm.selected);\n    }\n\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('nordwindMeal', {\n    templateUrl: 'components/nordwind-meal/nordwind-meal.html',\n    bindings: {\n        service: '='\n    },\n    controller: ['backend', nordwindMealController],\n    controllerAs: 'vm'\n});\n\n\nfunction nordwindMealController(backend) {\n    var vm = this;\n    console.log(vm.service);\n\n\n    backend.ready.then(function(){\n\n        backend.getExtraServices().then(function(extraServices){\n            vm.extraServicesList = extraServices.slice();\n            console.log(vm.extraServicesList);\n        });\n\n    });\n\n\n\n}\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\nrequire('./components/nordwind-es/nordwind-es');\nrequire('./components/nordwind-meal/nordwind-meal');\n\n},{\"./components/nordwind-es/nordwind-es\":1,\"./components/nordwind-meal/nordwind-meal\":2,\"./screens/add-services/AddServicesScreenController\":4,\"./screens/search-order/search-order\":5}],4:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = openOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n        vm.lastName = $routeParams.lastName;\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        vm.orderInfo = backend.getOrderInfo();\n\n        if (vm.orderInfo) {\n            orderReadyHandler();\n        } else {\n            backend.searchOrder(vm.pnrOrTicketNumber, vm.lastName, true).then(orderReadyHandler, function (resp) {\n                vm.searchOrderLoading = false;\n                vm.orderServicesLoading = false;\n                vm.errorMessage = resp.error;\n            });\n        }\n\n    });\n\n    function orderReadyHandler() {\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n\n            if (vm.errorMessage === 'web.extraServices.submitError') {\n                vm.showBackButton = true;\n            }\n        });\n\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    }\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                if (backend.getParam('site.rossiyaAirlineMode')) {\n                    fancyboxTools.openHandler('popupOrderEmailRequired', false, {\n                        phoneRequiredToo: true,\n                        submitCallback: function submitCallback(email, phone) {\n                            submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                        }\n                    });\n                } else {\n                    submitPaymentConfirm(removeInsuranceAeroexpress);\n                }\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder(resp.pnr, resp.lastName);\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function openOrder(pnrOrTicketNumber, lastName) {\n        if (backend.getParam('site.separatePassengersSearchOrder')) {\n            redirect.goToViewSeparateOrder(pnrOrTicketNumber, lastName);\n        } else {\n            redirect.goToSearchOrder(pnrOrTicketNumber, lastName);\n        }\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n}]);\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$routeParams', 'backend', 'redirect', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($routeParams, backend, redirect) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.searchParams = {};\n    vm.submitSearch = submitSearch;\n    vm.clear = clear;\n\n    backend.ready.then(function () {\n\n        if (backend.getParam('site.rossiyaAirlineMode')) {\n            redirect.goToSearchSeparateOrder();\n            return;\n        }\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n\n        backend.clearOrderInfo();\n        backend.addOrderInfoListener(function () {\n            vm.orderLoaded = true;\n        });\n\n        if ($routeParams.pnrOrTicketNumber && $routeParams.lastName) {\n\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n\n            vm.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.lastName = $routeParams.lastName;\n\n            vm.submitTouched = true;\n\n        }\n\n        vm.loading = false;\n\n    });\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if (\n            (!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) &&\n            vm.searchOrderForm.$valid\n        ) {\n            redirect.goToAddServices(vm.searchParams.pnrOrTicketNumber, vm.searchParams.lastName);\n        }\n    }\n\n    function clear() {\n        vm.pnrOrTicketNumber = false;\n        vm.lastName = false;\n    }\n\n}\n\n},{}]},{},[3]);\n"]}