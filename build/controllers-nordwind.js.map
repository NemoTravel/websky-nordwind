{"version":3,"sources":["controllers-nordwind.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","extraServicesListController","utils","vm","this","isCommonService","isCommonServiceCode","app","angular","component","templateUrl","controller","controllerAs","bindings","es","list","availableBundlesByPassengerSegments","locked","2","nwMealPopupController","$scope","backend","fancyboxTools","submit","submitCallback","close","jQuery","fancybox","popupId","esCode","setOpenListener","link","params","popup","element","popupWrapper","parents","hasClass","addClass","bindToController","transclude","extra-service","3","MealController","$element","switchService","checkServiceRemovalProhibited","service","active","selectFirstAvailablePassengerFlight","removeExtraService","closePopup","selectFlightPassenger","flightNum","passengerNum","selectedFlight","selectedPassenger","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","mealMenuSubgroup","mealCountChangeHandler","subgroupNum","mealItem","delta","modifyExtraService","passenger_id","orderInfo","passengers","id","segment_id","plainFlights","subgroup","subgroups","amount","alreadySelectedCount","rfisc","removePassengerFlightMeal","getSelectedPassengerFlightMeal","currency","count","cost","groupedEditableExtraServices","meal","forEach","item","totalPrice","Big","plus","toFixed","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","4","orderWithEsController","$window","$timeout","redirect","uniqueTabIdGenerator","retryPayment","removeInsuranceAeroexpress","loading","retryRegister","then","resp","pnr","lastName","location","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","openHandler","mode","errorMessage","error","bindOrder","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","clearSession","goToSearchOrder","newBooking","clearLastSearchParams","getAlias","choosePayMethodFailMsg","tabId","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","$on","event","data","popupChoosePayMethodPending","$onInit","resultParam","getParamFromLocation","status","waitPayment","hasFailedServices","paymentRedirectTo","showPaymentFrame","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","extra-services","payment","5","isRouteController","$location","onNewSearchOrderFlights","flights","_","flightSegment","userFlight","origin","originport","origincity","destination","destinationport","destinationcity","redefineBrands","redefineRules","redefineRule","routes","flight","from","to","console","log","flightBrand","brand","brandAvailableProps","brandUnavailableProps","brandPaidProps","originalBrands","getBrandConfig","filter","brands","props","prop","available","push","name","onNewSearchResult","newSearchResult","needToRestoreBrandsInfo","copy","replaceInfo","needToRedefine","replaceInfoInBrandList","brandsList","map","needRedefine","segmentRows","segment","segmentFlight","flightsInfo","rules","replaceWithBrand","slice","replaceBrandInfo","brandProp","extend","restoreBrandsInfo","selectedVariantsInfo","rearrangeBrandProps","selectedVariant","originalBrand","getOriginalBrand","availableProps","paidProps","unavailableProps","shortDesc","brandCode","$parent","ready","JSON","parse","bind","searchResult","path","newFlights","directive","scope","scopeAs","6","config","$compileProvider","debugInfoEnabled","run","$rootScope","href","split","route","decodeURIComponent","./components/nw-extra-services-list/nw-extra-services-list","./components/nw-meal-popup/nw-meal-popup","./components/nw-meal/nw-meal","./components/order-with-es/order-with-es","./directives/replaceWith","./screens/add-services/AddServicesScreenController","./screens/search-order/search-order","7","$routeParams","submitPayment","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","submitPaymentConfirm","showNeedSelectPaymentFormMesage","email","phone","confirmLoading","confirmError","startPaymentForExtraServices","card","goToConfirmOrder","removedSvcs","closeCallback","updateOrderServices","svcsToIssue","noExtraServicesLeft","fatalError","paymentFormChangeHandler","reloadPage","reload","swithcSubmitButtonHoverState","submitButtonHover","searchOrderLoading","openOrder","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addUpdateOrderServicesListener","priceVariant","isFreePricevariant","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","8","SearchOrderScreenController","clear","clearOrderInfo","showSearchForm","partiallyAddedPassengers","submitSearch","submitTouched","searchOrderAgree","searchOrderForm","$valid","searchLoading","searchOrderByParams","searchParams","date","needToSpecifyDocument","initAddServicesListeners","orderCompletelyInitialized","updateOrderInfoHandler","errorHandler","cb","updateOrderInfo","confirmHandler","finishSeparatePassengersSearch","addPassenger","passengerLastNameRegexp","applicationConstants","pnrOrTicketRegexp","ticketRegexp","pnrOrTicketNumber"],"mappings":"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","file":"controllers-nordwind.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.component('nwExtraServicesList', {\n    templateUrl: 'components/nw-extra-services-list/nw-extra-services-list.html',\n    controller: 'extraServicesListController',\n    controllerAs: 'vm',\n    bindings: {\n        es: '=es',\n        list: '=list',\n        availableBundlesByPassengerSegments: '<',\n        locked: '=locked'\n    }\n});\n\n\napp.controller('extraServicesListController', ['utils', extraServicesListController]);\n\nfunction extraServicesListController(utils) {\n\n    var vm = this;\n    vm.isCommonService = utils.isCommonServiceCode;\n\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('nwEsPopup', {\n    templateUrl: 'components/nw-meal-popup/nw-meal-popup.html',\n    controller: 'nwMealPopupController',\n    bindToController: true,\n    controllerAs: 'vm',\n    bindings: {\n        locked: '=',\n        esCode: '<',\n        es: '='\n    },\n    transclude: {\n        'extra-service': 'wrap',\n    },\n});\n\n\nangular.module('app').controller('nwMealPopupController', ['$scope', 'backend', 'fancyboxTools', nwMealPopupController]);\n\nfunction nwMealPopupController($scope, backend, fancyboxTools) {\n\n    var vm = this;\n    var submitCallback = false;\n\n    vm.close = close;\n    vm.submit = submit;\n\n    vm.popupId = '#nw-' + vm.esCode + '-popup';\n\n    fancyboxTools.setOpenListener('nw-' + vm.esCode + '-popup', function (link, params) {\n        var popup = angular.element(vm.popupId);\n        var popupWrapper = popup.parents('.fancybox-wrap');\n\n        // нужно прописать класс, чтобы проставить ширину попапа\n        if (!popupWrapper.hasClass('extra-service__popup')) {\n            popupWrapper.addClass('extra-service__popup');\n        }\n\n    });\n\n    function submit() {\n        if (submitCallback) {\n            submitCallback(true);\n            close();\n        }\n    }\n\n    function close() {\n        jQuery.fancybox.close();\n    }\n}\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.component('nwMeal', {\n    templateUrl: 'components/nw-meal/nw-meal.html',\n    controller: ['$scope', '$element', 'backend', 'utils', MealController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked',\n        closePopup: '&',\n    }\n});\n\nfunction MealController($scope, $element, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer');\n\n    vm.switchService = switchService;\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.mealCountChangeHandler = mealCountChangeHandler;\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n    vm.hasAlias = backend.hasAlias;\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n    vm.closePopup = vm.closePopup();\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    vm.selectedFlight = 0;\n    vm.selectedPassenger = 0;\n\n    if (backend.getParam('site.externalStorageBaseUrl')) {\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\n    } else {\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\n    }\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    $scope.$watch('vm.service', function () {\n        updateMealMenu();\n    });\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        updateMealMenu();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                backend.removeExtraService({\n                    code: 'meal'\n                });\n            }\n            vm.closePopup();\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateMealMenu();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateMealMenu();\n    }\n\n    function updateMealMenu() {\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\n        vm.mealMenuSubgroup = false;\n    }\n\n    function mealCountChangeHandler(subgroupNum, mealItem, delta) {\n        if (!vm.locked) {\n            backend.modifyExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                subgroup: vm.service.subgroups[subgroupNum],\n                amount: (mealItem.alreadySelectedCount || 0) + delta,\n                rfisc: mealItem.rfisc\n            });\n        }\n    }\n\n    function removePassengerFlightMeal(passengerNum, flightNum) {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\n            backend.removeExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            });\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n\n        var count = 0,\n            cost = 0,\n            currency;\n\n        if (\n            vm.orderInfo.groupedEditableExtraServices &&\n            vm.orderInfo.groupedEditableExtraServices.meal &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum] &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum] &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum].length\n        ) {\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum].forEach(function (item) {\n                if (item.amount) {\n                    count += item.amount;\n                }\n                if (item.totalPrice) {\n                    cost = Big(cost).plus(item.totalPrice).toFixed(2);\n                    currency = item.currency;\n                }\n            });\n        }\n\n        if (count) {\n            return {\n                count: count,\n                cost: cost,\n                currency: currency\n            };\n        } else {\n            return false;\n        }\n\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n}\n\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.component('orderWithEs', {\n    templateUrl: 'components/order-with-es/order-with-es.html',\n    controller: 'orderWithEsController',\n    controllerAs: 'vm',\n    transclude: {\n        'extra-services': 'nwExtraServicesList',\n        'payment': 'div'\n    },\n    bindings: {\n        orderInfo: '='\n    }\n});\n\napp.controller('orderWithEsController', ['$scope', '$window', '$timeout', 'backend',\n    'utils', 'redirect', 'fancyboxTools', 'uniqueTabIdGenerator', orderWithEsController]);\n\nfunction orderWithEsController($scope, $window, $timeout, backend,\n                               utils, redirect, fancyboxTools, uniqueTabIdGenerator) {\n    var vm = this;\n    vm.loading = true;\n    vm.errorMessage = false;\n    vm.choosePayMethodFailMsg = false;\n    vm.tabId = uniqueTabIdGenerator();\n    vm.openExchange = redirect.goToExchange;\n    vm.openRefund = redirect.goToRefund;\n    vm.openAddServices = redirect.goToAddServices;\n    vm.suffixCount = utils.suffixCount;\n\n    vm.retryPayment = retryPayment;\n    vm.bindOrder = bindOrder;\n    vm.clearSession = clearSession;\n    vm.newBooking = newBooking;\n\n    $scope.$on(\"popupChoosePayMethodChoosePayMethodFailMsg\", function (event, data) {\n        vm.choosePayMethodFailMsg = data;\n    });\n\n    $scope.$on(\"popupChoosePayMethodPending\", function (event, data) {\n        vm.popupChoosePayMethodPending = data;\n    });\n\n    vm.$onInit = function () {\n        var resultParam = utils.getParamFromLocation(\"result\");\n\n        if (resultParam === \"success\") {\n            if (\n                vm.orderInfo.header &&\n                (vm.orderInfo.header.status === \"being_paid\" ||\n                    vm.orderInfo.header.status === \"being_paid_for_exchange\")\n            ) {\n                backend\n                    .waitPayment(vm.orderInfo.header.regnum, vm.orderInfo.header.lastName)\n                    .then(\n                        function () {\n                            $window.location =\n                                \"./order?pnr=\" +\n                                vm.orderInfo.header.regnum +\n                                \"&lastName=\" +\n                                vm.orderInfo.header.lastName +\n                                \"&result=success\";\n                            return;\n                        },\n                        function () {\n                            vm.loading = false;\n                        }\n                    );\n            } else {\n                vm.loading = false;\n            }\n        } else {\n            // Платежный фрэйм открывается независимо от статуса заказа\n            // Необходимое условие для оплаты онлайн страховок\n            if (!vm.orderInfo.hasFailedServices && vm.orderInfo.paymentRedirectTo) {\n                vm.showPaymentFrame = true;\n            }\n            vm.loading = false;\n        }\n\n        if (\n            vm.orderInfo.hasFailedServices &&\n            !resultParam &&\n            vm.orderInfo.header &&\n            (vm.orderInfo.header.status === \"being_paid\" ||\n                vm.orderInfo.header.status === \"booked\")\n        ) {\n            $timeout(function () {\n                fancyboxTools.openHandler(\"popupRemovedServicesWarningByOrder\", false, {\n                    submitCallback: function submitCallback() {\n                        if (vm.orderInfo.paymentRedirectTo) {\n                            vm.showPaymentFrame = true;\n                        }\n                        vm.ignoreFailedServices = true;\n                    },\n\n                    disableOutsideCloseClick: true\n                });\n            });\n        }\n\n        if (\n            backend.getParam(\"ffp.enable\") &&\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\n        ) {\n            backend.ffpBonus().then(function (resp) {\n                vm.ffpBonus = resp.total || 0;\n            });\n        }\n    };\n\n    function retryPayment(removeInsuranceAeroexpress) {\n        vm.loading = true;\n        backend.retryRegister(removeInsuranceAeroexpress).then(\n            function (resp) {\n                if (resp.pnr && resp.lastName) {\n                    $window.location =\n                        \"./order?pnr=\" + resp.pnr + \"&lastName=\" + resp.lastName;\n                } else if (\n                    resp.eraseAeroexpressBecauseOfCurrency ||\n                    resp.eraseInsuranceBecauseOfCurrency\n                ) {\n                    fancyboxTools.openHandler(\"popupChangeCurrencyError\", false, {\n                        eraseAeroexpressBecauseOfCurrency:\n                        resp.eraseAeroexpressBecauseOfCurrency,\n                        eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                        mode: \"retryRegister\",\n                        submitCallback: retryPayment\n                    });\n                }\n                vm.loading = false;\n            },\n            function (resp) {\n                vm.loading = false;\n                vm.errorMessage = resp.error;\n            }\n        );\n    }\n\n    function bindOrder() {\n        if (\n            !vm.orderInfo.header ||\n            !vm.orderInfo.header.regnum ||\n            !vm.orderInfo.header.lastName\n        ) {\n            return;\n        }\n        vm.loading = true;\n        backend\n            .bindOrder(vm.orderInfo.header.regnum, vm.orderInfo.header.lastName)\n            .then(\n                function () {\n                    vm.loading = false;\n                    vm.orderInfo.bindAlowed = false;\n                    vm.showBindOrderSuccessMessage = true;\n                    $timeout(function () {\n                        vm.showBindOrderSuccessMessage = false;\n                    }, 10000);\n                },\n                function () {\n                    vm.loading = false;\n                    vm.showBindOrderFailMessage = true;\n                    $timeout(function () {\n                        vm.showBindOrderFailMessage = false;\n                    }, 10000);\n                }\n            );\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function newBooking() {\n        backend.clearLastSearchParams().then(function () {\n            $window.location = backend.getAlias(\"web.site.firstStepUrl\");\n        });\n    }\n}\n},{}],5:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', '$location', isRouteController]);\n\nfunction isRouteController($scope, backend, $location) {\n    var vm = $scope.$parent.vm;\n    vm.originalBrands = false;\n    vm.needToRestoreBrandsInfo = false;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.selectedVariantsInfo;\n        }), restoreBrandsInfo);\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.searchResult\n        }), function (newSearchResult) {\n\n            if ($location.path() === '/search-order') {\n                return;\n            }\n\n            onNewSearchResult(newSearchResult);\n        });\n\n        $scope.$watch(angular.bind(this, function () {\n            if (vm.orderInfo) {\n                return vm.orderInfo.flights\n            }\n        }), function (newFlights) {\n            onNewSearchOrderFlights(newFlights);\n        });\n\n    });\n\n\n    function onNewSearchOrderFlights(flights) {\n        if (!flights) {\n            return;\n        }\n\n        _.forEach(flights, function (flightSegment) {\n\n            _.forEach(flightSegment.flights, function (userFlight) {\n                var origin = userFlight.originport ? userFlight.originport : userFlight.origincity;\n                var destination = userFlight.destinationport ? userFlight.destinationport : userFlight.destinationcity;\n\n                var redefineBrands = false;\n\n\n                _.forEach(vm.redefineRules, function (redefineRule) {\n                    _.forEach(redefineRule.routes, function (flight) {\n\n                        if (origin === flight.from && destination === flight.to ||\n                            flight.from === destination && flight.to === origin) {\n                            console.log('we redefine some rules here, check the replacWith directive');\n\n                            redefineBrands = true;\n\n                            var flightBrand = {\n                                brand: userFlight.brand,\n                                brandAvailableProps: userFlight.brandAvailableProps,\n                                brandUnavailableProps: userFlight.brandUnavailableProps,\n                                brandPaidProps: userFlight.brandPaidProps\n                            };\n\n                            var originalBrands = backend.getBrandConfig();\n\n                            var originalBrand = originalBrands.filter(function (brand) {\n                                return brand.code === flightBrand.brand;\n                            })[0];\n\n\n                            _.forEach(redefineRule.brands, function (brand) {\n                                if (flightBrand.brand === brand.brand) {\n                                    var available = [];\n                                    var unavailable = [];\n                                    var paid = [];\n\n                                    _.forEach(brand.props, function (prop) {\n                                        switch (prop.available) {\n                                            case 'yes':\n                                                userFlight.brandAvailableProps.push(prop.name);\n                                                break;\n                                            case 'no':\n                                                userFlight.brandUnavailableProps.push(prop.name);\n                                                break;\n                                            case 'paid':\n                                                userFlight.brandPaidProps.push(prop.name);\n                                                break;\n                                            default:\n                                                break;\n                                        }\n                                    });\n                                }\n                            })\n                        }\n                    });\n                });\n            })\n        })\n\n\n    }\n\n    function onNewSearchResult(newSearchResult) {\n        vm.needToRestoreBrandsInfo = false;\n\n        if (newSearchResult && typeof vm.originalBrands === 'boolean') {\n            // Нужно закэшировать оригинальные бренды\n            // т.к. потом они заменятся а поскольку в js не примитивы передаются по ссылке\n            // нужно будет восстанавливать из этого массива значения если\n            // выбраны направления которые не переопределяются\n            vm.originalBrands = angular.copy(backend.getBrandConfig());\n        }\n        var replaceInfo = false;\n\n        if (needToRedefine(newSearchResult)) {\n            replaceInfo = true;\n        }\n\n        if (replaceInfo) {\n            replaceInfoInBrandList(newSearchResult.brandsList);\n        } else {\n            if (typeof vm.originalBrands !== 'boolean' && newSearchResult.brandsList) {\n                // Восстанавливаем кэшированное значение\n                newSearchResult.brandsList = newSearchResult.brandsList.map(function (e, i) {\n                    return vm.originalBrands.filter(function (item) {\n                        return item.code === e.code;\n                    })[0];\n                });\n\n                vm.needToRestoreBrandsInfo = true;\n            }\n        }\n    }\n\n    function needToRedefine(newSearchResult) {\n        var needRedefine = false;\n        _.forEach(vm.redefineRules, function (redefineRule) {\n            _.forEach(redefineRule.routes, function (flight) {\n                _.forEach(newSearchResult.segmentRows, function (segment) {\n                    _.forEach(segment, function (segmentFlight) {\n                        // если есть конкретный аэропорт вылета, искать по нему\n                        var origin = segmentFlight.flightsInfo.originport ? segmentFlight.flightsInfo.originport : segmentFlight.flightsInfo.origincity;\n                        var destination = segmentFlight.flightsInfo.destinationport ? segmentFlight.flightsInfo.destinationport : segmentFlight.flightsInfo.destinationcity;\n\n                        if (origin === flight.from && destination === flight.to || origin === flight.to && destination === flight.from) {\n                            needRedefine = true;\n                        }\n                    });\n                });\n            });\n        });\n        return needRedefine;\n    }\n\n\n    function replaceInfoInBrandList(brandsList) {\n\n        _.forEach(vm.redefineRules, function (rules) {\n            _.forEach(rules.brands, function (replaceWithBrand) {\n                _.forEach(brandsList.slice(), function (brand) {\n                    if (brand.code === replaceWithBrand.brand) {\n                        replaceBrandInfo(brand, replaceWithBrand)\n                    }\n                })\n            });\n        })\n    }\n\n\n    function replaceBrandInfo(brand, replaceWithBrand) {\n        console.log('we redefine some rules here, head to web.brandConfig.redefine');\n        console.log(brand, replaceWithBrand);\n        _.forEach(brand.props, function (brandProp) {\n            if (replaceWithBrand.props[brandProp.code]) {\n                _.extend(brandProp, replaceWithBrand.props[brandProp.code]);\n            }\n        })\n    }\n\n    function restoreBrandsInfo() {\n        if (!vm.selectedVariantsInfo) {\n            return;\n        }\n\n        if (!vm.needToRestoreBrandsInfo) {\n            return;\n        }\n\n        console.log('restoreBrandsInfo');\n        // console.log(vm.selectedVariantsInfo);\n        // console.log(vm.originalBrands);\n\n\n        _.forEach(vm.selectedVariantsInfo, rearrangeBrandProps);\n    }\n\n    function rearrangeBrandProps(selectedVariant) {\n        var originalBrand = getOriginalBrand(selectedVariant.brand);\n        var availableProps = [];\n        var paidProps = [];\n        var unavailableProps = [];\n\n        _.forEach(originalBrand.props, function (prop) {\n            switch (prop.available) {\n                case 'yes':\n                    if(prop.shortDesc) {\n                        availableProps.push(prop.shortDesc);\n                    } else {\n                        availableProps.push(prop.name);\n                    }\n                    break;\n                case 'paid':\n                    paidProps.push(prop.name);\n                    break;\n                case 'no':\n                    unavailableProps.push(prop.name);\n                    break;\n                default:\n                    return;\n            }\n        });\n\n        selectedVariant.brandAvailableProps = availableProps.slice();\n        selectedVariant.brandPaidProps = paidProps.slice();\n        selectedVariant.brandUnavailableProps = unavailableProps.slice();\n    }\n\n    function getOriginalBrand(brandCode) {\n        return vm.originalBrands.filter(function (brand) {\n            return brand.code === brandCode;\n        })[0]\n    }\n}\n},{}],6:[function(require,module,exports){\n\"use strict\";\nrequire('./screens/add-services/AddServicesScreenController');\nrequire('./screens/search-order/search-order');\nrequire('./directives/replaceWith');\nrequire('./components/nw-meal-popup/nw-meal-popup');\nrequire('./components/order-with-es/order-with-es');\nrequire('./components/nw-extra-services-list/nw-extra-services-list');\nrequire('./components/nw-meal/nw-meal');\n\n// TODO: remove it!!\nangular.module('app').config(['$compileProvider', function ($compileProvider) {\n    $compileProvider.debugInfoEnabled(true);\n}]);\n\nangular.module('app').run(['$rootScope', 'redirect', 'backend', function ($rootScope, redirect, backend) {\n    $rootScope.$on('$locationChangeStart', function (e) {\n\n        var href = location.href.split('#')[1];\n\n        href = href.split('/');\n\n        var route = href[1],\n            pnr = href[2],\n            lastName = href[3];\n\n\n        if (route === 'add-services' && pnr && lastName) {\n            lastName = decodeURIComponent(lastName);\n\n            redirect.goToSearchOrder(pnr, lastName);\n        }\n\n    })\n}]);\n\n},{\"./components/nw-extra-services-list/nw-extra-services-list\":1,\"./components/nw-meal-popup/nw-meal-popup\":2,\"./components/nw-meal/nw-meal\":3,\"./components/order-with-es/order-with-es\":4,\"./directives/replaceWith\":5,\"./screens/add-services/AddServicesScreenController\":7,\"./screens/search-order/search-order\":8}],7:[function(require,module,exports){\n\"use strict\";\n'use strict';\n\nangular.module('app').controller('AddServicesScreenController', ['$scope', '$routeParams', '$window', 'redirect', 'backend', 'utils', 'fancyboxTools', function ($scope, $routeParams, $window, redirect, backend, utils, fancyboxTools) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n\n    vm.openOrder = redirect.goToSearchOrder;\n    vm.submitPayment = submitPayment;\n    vm.paymentFormChangeHandler = paymentFormChangeHandler;\n    vm.reloadPage = reloadPage;\n    vm.clearSession = clearSession;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n        vm.card = data;\n    });\n\n    backend.ready.then(function () {\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'addServices'));\n\n        vm.loading = false;\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n        backend.addOrderInfoListener(function (orderInfo) {\n            vm.orderInfo = orderInfo;\n        });\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType, removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}]);\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n\"use strict\";\n\nangular.module('app').controller(\n    'SearchOrderScreenController',\n    ['$scope', '$routeParams', 'backend',\n        'redirect', '$timeout', 'utils', 'fancyboxTools', SearchOrderScreenController]\n);\n\nfunction SearchOrderScreenController($scope, $routeParams, backend, redirect, $timeout, utils, fancyboxTools) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.searchOrderLoading = true;\n    vm.orderServicesLoading = true;\n    vm.showSearchForm = true;\n    vm.searchParams = {};\n    vm.partiallyAddedPassengers = [];\n    vm.submitPayment = submitPayment;\n    vm.submitSearch = submitSearch;\n    vm.confirmHandler = confirmHandler;\n    vm.clear = clear;\n    vm.addPassenger = addPassenger;\n    vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n    backend.ready.then(function () {\n\n        angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'searchOrder'));\n\n\n        vm.passengerLastNameRegexp = backend.applicationConstants.passengerLastNameRegexp;\n        vm.pnrOrTicketRegexp = backend.applicationConstants.pnrOrTicketRegexp;\n        vm.ticketRegexp = backend.applicationConstants.ticketRegexp;\n\n\n        backend.clearOrderInfoListeners();\n        backend.clearUpdateOrderServicesListeners();\n\n\n        if (\n            $routeParams.pnrOrTicketNumber &&\n            $routeParams.lastName &&\n            backend.getParam('site.searchOrdersBy') === 'LAST_NAME_PNR_TICKET'\n        ) {\n            vm.searchParams.pnrOrTicketNumber = $routeParams.pnrOrTicketNumber;\n            vm.searchParams.lastName = $routeParams.lastName;\n            vm.loading = false;\n            console.log('submit search');\n            $timeout(submitSearch);\n        } else {\n            console.log('else block');\n            updateOrderInfoHandler();\n            initAddServicesListeners();\n        }\n\n        // add-services logic\n        backend.addOrderInfoListener(function (orderInfo) {\n            console.log('add order info listener');\n            vm.orderInfo = orderInfo;\n        });\n\n    });\n\n    function submitPayment(removeInsuranceAeroexpress) {\n        if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n            if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                submitPaymentConfirm(removeInsuranceAeroexpress);\n            } else {\n                vm.showNeedSelectPaymentFormMesage = true;\n            }\n        }\n    }\n\n    function submitPaymentConfirm(removeInsuranceAeroexpress, email, phone) {\n        vm.confirmLoading = true;\n\n        if (vm.confirmError) {\n            delete vm.confirmError;\n        }\n\n        backend.startPaymentForExtraServices(vm.selectedPaymentForm, vm.selectedPaymentType,\n            removeInsuranceAeroexpress, email, phone, vm.card).then(function (resp) {\n            if (resp.pnr && resp.lastName) {\n                redirect.goToConfirmOrder();\n            } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                    eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                    eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                    mode: 'addServices',\n                    submitCallback: submitPayment\n                });\n            } else if (resp.removedSvcs && resp.removedSvcs.length) {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function submitCallback() {\n                        submitPaymentConfirm(removeInsuranceAeroexpress, email, phone);\n                    },\n                    closeCallback: function closeCallback() {\n                        backend.updateOrderServices(true);\n                    },\n\n                    removedSvcs: resp.removedSvcs,\n                    svcsToIssue: resp.svcsToIssue,\n                    noExtraServicesLeft: resp.noExtraServicesLeft,\n                    disableOutsideCloseClick: true\n                });\n            }\n\n            vm.confirmLoading = false;\n        }, function (resp) {\n            if (resp.error === 'web.noBookedConfirmedExtraServices') {\n                vm.fatalError = resp.error;\n            } else {\n                vm.confirmError = resp.error;\n            }\n\n            vm.confirmLoading = false;\n        });\n    }\n\n    function paymentFormChangeHandler() {\n        vm.showNeedSelectPaymentFormMesage = false;\n    }\n\n    function reloadPage() {\n        $window.location.reload();\n        return false;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n    function clear() {\n        backend.clearSession();\n        backend.clearOrderInfo();\n        vm.orderInfo = false;\n        vm.showSearchForm = true;\n        vm.partiallyAddedPassengers = [];\n    }\n\n    function submitSearch() {\n        vm.submitTouched = true;\n        if (\n            (!backend.getParam('site.useSearchOrderAgreeCheckbox') || vm.searchOrderAgree) &&\n            vm.searchOrderForm.$valid\n        ) {\n            vm.searchLoading = true;\n            vm.errorMessage = false;\n            backend.searchOrderByParams(vm.searchParams, !!vm.partiallyAddedPassengers.length).then(function (resp) {\n                if (vm.searchParams.flight && vm.searchParams.date) {\n                    vm.searchParams = {\n                        flight: vm.searchParams.flight,\n                        date: vm.searchParams.date\n                    };\n                } else if (!resp.needToSpecifyDocument) {\n                    vm.searchParams = {};\n                }\n                vm.needToSpecifyDocument = resp.needToSpecifyDocument;\n                vm.showSearchForm = false;\n                vm.submitTouched = false;\n\n                initAddServicesListeners();\n\n                if (resp.orderCompletelyInitialized) {\n                    vm.partiallyAddedPassengers = [];\n                    // call updateOrderInfo with callback\n                    // because need to redirect to add-services\n                    // only if adding extra services allowed\n                    updateOrderInfoHandler();\n                } else {\n                    if (resp.partiallyAddedPassengers) {\n                        vm.partiallyAddedPassengers = resp.partiallyAddedPassengers;\n                    }\n                    if (vm.needToSpecifyDocument) {\n                        vm.showSearchForm = true;\n                    }\n                }\n                vm.searchLoading = false;\n            }, errorHandler);\n        }\n    }\n\n    function initAddServicesListeners() {\n\n        backend.addUpdateOrderServicesListener(function (resp) {\n            vm.orderInfo = resp[1];\n            vm.priceVariant = resp[2];\n            vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n            if (vm.isFreePricevariant) {\n                vm.showNeedSelectPaymentFormMesage = false;\n            }\n\n            vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n            vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n\n            if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                backend.ffpBonus().then(function (resp) {\n                    vm.ffpBonus = resp.total || 0;\n                });\n            }\n        }, function (resp) {\n            vm.searchOrderLoading = false;\n            vm.orderServicesLoading = false;\n            vm.errorMessage = resp.error;\n        });\n\n        backend.updateOrderServices(true).then(function () {\n            vm.loading = true;\n\n            backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo).then(function () {\n                vm.loading = false;\n            }, function (resp) {\n                vm.errorMessage = resp.error;\n                vm.loading = false;\n            });\n        });\n\n        backend.addExtraServiceListener(function (state) {\n            vm.modifyServicesLoading = !state;\n            vm.orderServicesLoading = true;\n        });\n\n        backend.addExtraServiceErrorListener(function (resp, req) {\n            if (!req || req.code !== 'seat') {\n                vm.modifyServicesError = resp.error;\n            }\n\n            vm.modifyServicesLoading = false;\n            vm.orderServicesLoading = true;\n        });\n\n\n    }\n\n    function updateOrderInfoHandler(cb) {\n        backend.updateOrderInfo().then(function (orderInfo) {\n            if (orderInfo.passengers) {\n                vm.orderInfo = orderInfo;\n                vm.showSearchForm = false;\n                if (typeof cb === 'function') {\n                    cb();\n                }\n            }\n            vm.loading = false;\n        }, errorHandler);\n    }\n\n    function errorHandler(resp) {\n        vm.loading = false;\n        vm.searchLoading = false;\n        if (resp.error !== 'web.messages.emptyOrder') {\n            vm.errorMessage = resp.error;\n        }\n    }\n\n    function confirmHandler() {\n        backend.finishSeparatePassengersSearch().then(updateOrderInfoHandler, errorHandler);\n    }\n\n    function addPassenger() {\n        vm.showSearchForm = true;\n    }\n\n    function swithcSubmitButtonHoverState() {\n        vm.submitButtonHover = !vm.submitButtonHover;\n    }\n}\n\n},{}]},{},[6]);\n"]}