!function(){function e(r,n,o){function a(i,s){if(!n[i]){if(!r[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(t)return t(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[i]={exports:{}};r[i][0].call(l.exports,function(e){var n=r[i][1][e];return a(n||e)},l,l.exports,e,r,n,o)}return n[i].exports}for(var t="function"==typeof require&&require,i=0;i<o.length;i++)a(o[i]);return a}return e}()({1:[function(e,r,n){"use strict";function o(e,r,n){function o(e){t.selected=e}function a(){t.selected=null}var t=this;t.selected=null,t.handleEsSelect=o,t.closePopup=a,r.ready.then(function(){r.getExtraServices().then(function(e){t.extraServicesList=e.slice(),t.es=n.reformatAvailableExtraServices(e.slice(),t.orderInfo,void 0)})})}angular.module("app").component("nordwindEs",{templateUrl:"components/nordwind-es/nordwind-es.html",bindings:{orderInfo:"="},controller:["$scope","backend","utils",o],controllerAs:"vm"})},{}],2:[function(e,r,n){"use strict";function o(e){var r=this;e.ready.then(function(){e.getExtraServices().then(function(e){r.extraServicesList=e.slice()})})}angular.module("app").component("nordwindMeal",{templateUrl:"components/nordwind-meal/nordwind-meal.html",bindings:{service:"="},controller:["backend",o],controllerAs:"vm"})},{}],3:[function(e,r,n){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),e("./components/nordwind-es/nordwind-es"),e("./components/nordwind-meal/nordwind-meal")},{"./components/nordwind-es/nordwind-es":1,"./components/nordwind-meal/nordwind-meal":2,"./screens/add-services/AddServicesScreenController":4,"./screens/search-order/search-order":5}],4:[function(e,r,n){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,n,o,a,t,i){function s(){a.addOrderInfoListener(function(e){p.orderInfo=e}),a.addUpdateOrderServicesListener(function(e){p.orderInfo=e[1],p.priceVariant=e[2],p.isFreePricevariant=t.isFreePricevariant(e[2]),p.isFreePricevariant&&(p.showNeedSelectPaymentFormMesage=!1),p.es=t.reformatAvailableExtraServices(e[0],p.orderInfo,p.es),p.esList=t.getAvailableExtraServicesList(e[0],p.es),p.searchOrderLoading=!1,p.orderServicesLoading=!1,a.getParam("ffp.enable")&&(p.orderInfo.hasBonusCard||p.orderInfo.ffpSumm)&&a.ffpBonus().then(function(e){p.ffpBonus=e.total||0})},function(e){p.searchOrderLoading=!1,p.orderServicesLoading=!1,p.errorMessage=e.error,"web.extraServices.submitError"===p.errorMessage&&(p.showBackButton=!0)}),a.updateOrderServices(!0).then(function(){p.loading=!0,a.switchDefaultSelectedServices(p.esList,p.es,p.orderInfo).then(function(){p.loading=!1})}),a.addExtraServiceListener(function(e){p.modifyServicesLoading=!e,p.orderServicesLoading=!0}),a.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(p.modifyServicesError=e.error),p.modifyServicesLoading=!1,p.orderServicesLoading=!0})}function c(e){!p.agree||p.modifyServicesLoading||p.orderServicesLoading||(p.selectedPaymentForm&&p.selectedPaymentType?a.getParam("site.rossiyaAirlineMode")?i.openHandler("popupOrderEmailRequired",!1,{phoneRequiredToo:!0,submitCallback:function(r,n){d(e,r,n)}}):d(e):p.showNeedSelectPaymentFormMesage=!0)}function d(e,r,n){p.confirmLoading=!0,p.confirmError&&delete p.confirmError,a.startPaymentForExtraServices(p.selectedPaymentForm,p.selectedPaymentType,e,r,n,p.card).then(function(t){t.pnr&&t.lastName?o.goToConfirmOrder(t.pnr,t.lastName):t.eraseAeroexpressBecauseOfCurrency||t.eraseInsuranceBecauseOfCurrency?i.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:t.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:t.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:c}):t.removedSvcs&&t.removedSvcs.length&&i.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d(e,r,n)},closeCallback:function(){a.updateOrderServices(!0)},removedSvcs:t.removedSvcs,svcsToIssue:t.svcsToIssue,noExtraServicesLeft:t.noExtraServicesLeft,disableOutsideCloseClick:!0}),p.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?p.fatalError=e.error:p.confirmError=e.error,p.confirmLoading=!1})}function l(){p.showNeedSelectPaymentFormMesage=!1}function u(){return n.location.reload(),!1}function m(e,r){a.getParam("site.separatePassengersSearchOrder")?o.goToViewSeparateOrder(e,r):o.goToSearchOrder(e,r)}function f(){a.clearSession().then(function(){o.goToSearchOrder()})}var p=this;p.loading=!0,p.searchOrderLoading=!0,p.orderServicesLoading=!0,p.openOrder=m,p.submitPayment=c,p.paymentFormChangeHandler=l,p.reloadPage=u,p.clearSession=f,e.$on("plasticCardForPaymentChangeEvent",function(e,r){p.card=r}),a.ready.then(function(){angular.element("title").text(a.getAliasWithPrefix("web.pageTitle.","addServices")),p.pnrOrTicketNumber=r.pnrOrTicketNumber,p.lastName=r.lastName,p.loading=!1,a.clearOrderInfoListeners(),a.clearUpdateOrderServicesListeners(),p.orderInfo=a.getOrderInfo(),p.orderInfo?s():a.searchOrder(p.pnrOrTicketNumber,p.lastName,!0).then(s,function(e){p.searchOrderLoading=!1,p.orderServicesLoading=!1,p.errorMessage=e.error})})}])},{}],5:[function(e,r,n){"use strict";function o(e,r,n){function o(){t.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!t.searchOrderAgree||!t.searchOrderForm.$valid||n.goToAddServices(t.searchParams.pnrOrTicketNumber,t.searchParams.lastName)}function a(){t.pnrOrTicketNumber=!1,t.lastName=!1}var t=this;t.loading=!0,t.searchParams={},t.submitSearch=o,t.clear=a,r.ready.then(function(){return r.getParam("site.rossiyaAirlineMode")?void n.goToSearchSeparateOrder():(angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),t.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,t.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,r.clearOrderInfo(),r.addOrderInfoListener(function(){t.orderLoaded=!0}),e.pnrOrTicketNumber&&e.lastName&&(t.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,t.searchParams.lastName=e.lastName,t.pnrOrTicketNumber=e.pnrOrTicketNumber,t.lastName=e.lastName,t.submitTouched=!0),void(t.loading=!1))})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","redirect",o])},{}]},{},[3]);
//# sourceMappingURL=controllers-nordwind.js.map
