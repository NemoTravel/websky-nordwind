!function(){function e(r,n,t){function s(a,i){if(!n[a]){if(!r[a]){var c="function"==typeof require&&require;if(!i&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[a]={exports:{}};r[a][0].call(l.exports,function(e){var n=r[a][1][e];return s(n||e)},l,l.exports,e,r,n,t)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<t.length;a++)s(t[a]);return s}return e}()({1:[function(e,r,n){!function(e,t){"object"==typeof n&&"undefined"!=typeof r?t(n):"function"==typeof define&&define.amd?define(["exports"],t):t(e.lvovich={})}(this,function(e){"use strict";function r(e){return a(e,x.firstname)}function n(e){return a(e,x.lastname)}function t(e){return a(e,x.middlename)}function s(e,r){return e===O?r:r===O?e:e===r?e:null}function o(e){return d(function(e){var o=O;if(e.middle&&(o=s(o,t(e.middle.trim()))),e.first&&(o=s(o,r(e.first.trim()))),e.last){var a=n(e.last.trim());null!==a&&(o=s(o,a))}return o}(e))}function a(e,r){if(!e||!r)return null;var n=e.toLowerCase();if(r.exceptions){var t=i(r.exceptions,function(e){return e.startsWith("-")?n.endsWith(e.substr(1)):e===n});if(t)return t}return r.suffixes?i(r.suffixes,function(e){return n.endsWith(e)}):null}function i(e,r){var n=Object.keys(e).filter(function(n){var t=e[n];return Array.isArray(t)&&t.some(r)});return 1!==n.length?(Object.keys(e).forEach(function(n){var t=e[n];Array.isArray(t)&&t.some(r)}),null):c(n[0])}function c(e){switch(e){case"male":case w:return w;case"female":case E:return E;case"androgynous":case O:return O;default:return null}}function d(e){switch(e){case"male":case w:return"male";case"female":case E:return"female";case"androgynous":case O:return"androgynous";default:return null}}function l(e){Array.isArray(e.exceptions)&&e.exceptions.forEach(function(e){e.gender=c(e.gender)}),Array.isArray(e.suffixes)&&e.suffixes.forEach(function(e){e.gender=c(e.gender)})}function u(e,r,n,t){for(var s=function(e){switch(e){case"nominative":case C:return C;case"genitive":case L:return L;case"dative":case I:return I;case"accusative":case k:return k;case"instrumental":case F:return F;case"prepositional":case T:return T;default:return null}}(r),o=c(n),a=e.split("-"),i=[],d=0;d<a.length;d++){var l=a[d],u=m(l,o,t,{firstWord:0===d&&1<a.length});i.push(u?v(u,l,s):l)}return i.join("-")}function m(e,r,n){var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(!e)return null;var s=e.toLowerCase(),o=[];if(Object.keys(t).forEach(function(e){t[e]&&o.push(e)}),n.exceptions){var a=g(n.exceptions,r,function(e){return e===s},o);if(a)return a}return n.suffixes?g(n.suffixes,r,function(e){return s.endsWith(e)},o):null}function g(e,r,n){for(var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],s=0;s<e.length;s++){var o=e[s];if((!o.tags||o.tags.find(function(e){return-1!=t.indexOf(e)}))&&(o.gender===O||r===o.gender)&&o.test)for(var a=0;a<o.test.length;a++)if(n(o.test[a]))return o}return null}function f(e,r){return e&&r<=e.length?e[r]:"."}function v(e,r,n){var t;switch(n){case C:t=".";break;case L:t=f(e.mods,0);break;case I:t=f(e.mods,1);break;case k:t=f(e.mods,2);break;case F:t=f(e.mods,3);break;case T:t=f(e.mods,4);break;default:t="."}return p(r,t)}function p(e,r){for(var n=0;n<r.length;n++){var t=r[n];switch(t){case".":break;case"-":e=e.substr(0,e.length-1);break;default:e+=t}}return e}function h(e){return u(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||r(e),M)}function S(e){return u(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||n(e),A)}function y(e){return u(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||t(e),B)}function P(e,r){for(var n=e.toLowerCase(),t=0;t<r.length;t++)if(r[t]===n)return!0;return!1}function b(e,r,n){if(1<n.length){if(P(e,R))return!0;for(var t=0;r>t;t++)if(P(n[t],_))return!0}return!1}var x={lastname:{exceptions:{androgynous:["бова","регин","дарвин","пэйлин","грин","цин","шенгелая"]},suffixes:{androgynous:["ан","ко","дзе","швили","ян","к","ер","ц","г","йн","дт","ен","ич","о","ун"],female:["ова","ая","ына","ина","ева","ска","ёва"],male:["кий","ов","ын","ев","ин","ёв","хий","ний","ый","ой"]}},firstname:{exceptions:{androgynous:["анри","алвард","валери","женя","закия","захария","иона","кири","ким","муса","райхон","саша","сева","ардак","арман","асыл","баглан","бакыт","бахыт","еркежан","жанат","жаркын","куаныш","манат","мереке","рауан","сымбат","тлеухан","умит","улжалгас","ырыс","айбала","акбала","ирза","арши","амиль"],male:["аба","абиба","савва","лёва","вова","-ага","агга","серега","алиада","муктада","абида","алда","маджуда","нурлыхуда","гиа","элиа","гарсиа","вавила","гавриила","генка","лука","дима","зосима","тима","фима","фома","кузьма","жора","миша","ермила","данила","гаврила","абдалла","аталла","абдилла","атилла","кайролла","абула","свитлана","бена","гена","агелина","джанна","кришна","степа","дра","назера","валера","эстера","двойра","калистра","заратустра","юра","иса","аиса","халиса","холиса","валенса","мусса","ата","паата","алета","никита","мота","шота","фаста","коста","маритта","малюта","васюта","вафа","мустафа","ганифа","лев","яков","константин","марсель","рамиль","эмиль","бактыгуль","даниэль","игорь","арминэ","изя","кузя","гия","мазия","кирикия","ркия","еркия","эркия","гулия","аксания","закария","зекерия","гарсия","шендля","филя","вилля","толя","коля","ваня","саня","загиря","боря","цайся","вася","ося","петя","витя","митя","костя","илья","абдала","абдель","фидель","фридель","абдилла","аталла","абла","лазарь","ава","вовка","семён"],female:["судаба","сураба","любава","джанлука","варвара","наташа","зайнаб","любов","сольвейг","шакед","аннаид","ингрид","синди","аллаберди","лали","натали","лили","нелли","элли","эмили","амили","адели","гулькай","алтынай","гюнай","гюльчитай","нурангиз","лиз","элиз","ботагоз","юлдуз","диляфруз","габи","сажи","фанни","мери","элдари","эльдари","хилари","хиллари","аннемари","розмари","товсари","ансари","одри","тери","ири","катя","катри","мэри","сатаней","ефтений","верунчик","гюзел","этел","рэйчел","джил","мерил","нинелл","бурул","ахлам","майрам","махаррам","мириам","дилярам","асем","мерьем","мирьем","эркаим","гулаим","айгерим","марьям","мирьям","эван","гульжиган","айдан","айжан","вивиан","гульжиан","лилиан","мариан","саиман","джоан","чулпан","лоран","моран","гульшан","аделин","жаклин","карин","каролин","каталин","катрин","керстин","кэтрин","мэрилин","рузалин","хелин","цеткин","ширин","элисон","дурсун","кристин","гульжиян","марьян","ренато","зейнеп","санабар","дильбар","гулизар","гульзар","пилар","дагмар","элинар","нилуфар","анхар","гаухар","естер","эстер","дженнифер","линор","элинор","элеонор","айнур","гульнур","шамсинур","элнур","ильсияр","нигяр","сигитас","агнес","анес","долорес","инес","анаис","таис","эллис","элис","кларис","амнерис","айрис","дорис","беатрис","грейс","грэйс","ботагос","маргос","джулианс","арус","диляфрус","саодат","зулхижат","хамат","патимат","хатимат","альжанат","маймунат","гульшат","рут","иргаш","айнаш","агнеш","зауреш","тэрбиш","ануш","азгануш","гаруш","николь","адась","адула","ахмадула","гейбадула","лив","ираги","пегги","абдурефи","адерми","лакшми","мими","наоми","изабель","абигейль","зебо","аширбу","судаба","айсулу","айши","жанет","гузаль","сапият","зауре","кармен","мадлен","алсу","айсу","амели","-бану","ассоль","николь"]},suffixes:{androgynous:["щи","ки"],male:["аба","б","ав","ев","ов","во","г","д","ж","з","би","ди","жи","ли","гани","ит","до","айт","юм","дула","ив","ги","улла","улль","фи","аль","ми","бель","була","йль","яй","бо","бу","кр","ыль","ыт","вва","вель","вни","аба","бала","улу","рза","ши","паша","го","но","ет","ят","ре","ри","ай","ей","ий","ой","ый","к","л","ам","ем","им","ом","ум","ым","ям","ан","бен","вен","ген","ден","ин","сейн","он","ун","ян","ио","ло","ро","то","шо","п","ар","др","ер","ир","ор","тр","ур","ыр","яр","ас","ес","ис","йс","кс","мс","ос","нс","рс","ус","юс","яс","ат","кт","нт","рт","ст","ут","ф","х","ш","ы","сь","тау","ен","коль","рау","обе","убе","иль","ево","ово","шу","ду","пуль","нко","су","вль","оль","ёв","ём","ец","сс","льс","хт","рн","дт"],female:["иба","люба","лава","ева","га","да","еа","иза","иа","ика","нка","ска","ела","ила","илла","эла","има","на","ра","са","та","фа","еса","сса","гуль","куль","нуэль","гюль","нэ","ая","ея","ия","йя","ля","мя","оя","ря","ся","вья","лья","мья","нья","рья","сья","тья","фья","зя","нша","ха","тка","нь","чь","мь","ерь","овка","евка","мба","зь","лка","сала","бла","арь","ума","пи","дель","не","жка","си","ибе","абе","елла","ие","фе","фя"]}},middlename:{suffixes:{female:["на","кызы","гызы"],male:["ич","оглы","улы","уулу"]}}},w=1,E=2,O=4,C=1,L=2,I=3,k=4,F=5,T=6,A={exceptions:[{gender:"androgynous",test:["бонч","абдул","белиц","гасан","дюссар","дюмон","книппер","корвин","ван","шолом","тер","призван","мелик","вар","фон"],mods:[".",".",".",".","."],tags:["first_word"]},{gender:"androgynous",test:["дюма","тома","дега","люка","ферма","гамарра","петипа","шандра","скаля","каруана"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["гусь","ремень","камень","онук","богода","нечипас","долгопалец","маненок","рева","кива"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["вий","сой","цой","хой"],mods:["-я","-ю","-я","-ем","-е"]}],suffixes:[{gender:"female",test:["б","в","г","д","ж","з","й","к","л","м","н","п","р","с","т","ф","х","ц","ч","ш","щ","ъ","ь"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["орота"],mods:[".",".",".",".","."]},{gender:"female",test:["ска","цка"],mods:["-ой","-ой","-ую","-ой","-ой"]},{gender:"female",test:["цкая","ская","ная","ая"],mods:["--ой","--ой","--ую","--ой","--ой"]},{gender:"female",test:["яя"],mods:["--ей","--ей","--юю","--ей","--ей"]},{gender:"male",test:["иной","уй"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["ца"],mods:["-ы","-е","-у","-ей","-е"]},{gender:"male",test:["рих"],mods:["а","у","а","ом","е"]},{gender:"androgynous",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"androgynous",test:["иа","аа","оа","уа","ыа","еа","юа","эа"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["о","е","э","и","ы","у","ю"],mods:[".",".",".",".","."]},{gender:"male",test:["их","ых"],mods:[".",".",".",".","."]},{gender:"female",test:["ова","ева","на","ёва"],mods:["-ой","-ой","-у","-ой","-ой"]},{gender:"androgynous",test:["га","ка","ха","ча","ща","жа","ша"],mods:["-и","-е","-у","-ой","-е"]},{gender:"androgynous",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"male",test:["ь"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["обей"],mods:["--ья","--ью","--ья","--ьем","--ье"]},{gender:"male",test:["ей"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["ян","ан","йн"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ынец","овец"],mods:["--ца","--цу","--ца","--цом","--це"]},{gender:"male",test:["нец","обец"],mods:["--ца","--цу","--ца","--цем","--це"]},{gender:"male",test:["ай"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["гой","кой"],mods:["-го","-му","-го","--им","-м"]},{gender:"male",test:["ой"],mods:["-го","-му","-го","--ым","-м"]},{gender:"male",test:["ах","ив","шток"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ший","щий","жий","ний"],mods:["--его","--ему","--его","-м","--ем"]},{gender:"male",test:["ый","кий","хий"],mods:["--ого","--ому","--ого","-м","--ом"]},{gender:"male",test:["ий"],mods:["-я","-ю","-я","-ем","-и"]},{gender:"male",test:["ок"],mods:["--ка","--ку","--ка","--ком","--ке"]},{gender:"male",test:["иец","еец"],mods:["--йца","--йцу","--йца","--йцом","--йце"]},{gender:"male",test:["ец"],mods:["--ца","--цу","--ца","--цом","--це"]},{gender:"male",test:["ц","ч","ш","щ"],mods:["а","у","а","ем","е"]},{gender:"male",test:["ен","нн","он","ун","б","г","д","ж","з","к","л","м","п","р","с","т","ф","х"],mods:["а","у","а","ом","е"]},{gender:"male",test:["в","н"],mods:["а","у","а","ым","е"]}]},B={exceptions:[{gender:"androgynous",test:["борух"],mods:[".",".",".",".","."],tags:["first_word"]}],suffixes:[{gender:"male",test:["мич","ьич","кич"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ич"],mods:["а","у","а","ем","е"]},{gender:"female",test:["на"],mods:["-ы","-е","-у","-ой","-е"]}]},M={exceptions:[{gender:"male",test:["лев"],mods:["--ьва","--ьву","--ьва","--ьвом","--ьве"]},{gender:"male",test:["пётр"],mods:["---етра","---етру","---етра","---етром","---етре"]},{gender:"male",test:["павел"],mods:["--ла","--лу","--ла","--лом","--ле"]},{gender:"male",test:["яша"],mods:["-и","-е","-у","-ей","-е"]},{gender:"male",test:["шота"],mods:[".",".",".",".","."]},{gender:"female",test:["агидель","жизель","нинель","рашель","рахиль"],mods:["-и","-и",".","ю","-и"]}],suffixes:[{gender:"androgynous",test:["лок"],mods:["--ка","--ку",".","--кос","--ке"]},{gender:"androgynous",test:["ки"],mods:["-ов","-ам",".","-ами","-ах"]},{gender:"androgynous",test:["щи"],mods:["-ев","-ам",".","-ами","-ах"]},{gender:"androgynous",test:["е","ё","и","о","у","ы","э","ю"],mods:[".",".",".",".","."]},{gender:"male",test:["уа","иа"],mods:[".",".",".",".","."]},{gender:"female",test:["б","в","г","д","ж","з","й","к","л","м","н","п","р","с","т","ф","х","ц","ч","ш","щ","ъ","иа","ль"],mods:[".",".",".",".","."]},{gender:"female",test:["ь"],mods:["-и","-и",".","ю","-и"]},{gender:"male",test:["ь"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["га","ка","ха","ча","ща","жа"],mods:["-и","-е","-у","-ой","-е"]},{gender:"female",test:["ша"],mods:["-и","-е","-у","-ей","-е"]},{gender:"male",test:["ша","ча","жа"],mods:["-и","-е","-у","-ей","-е"]},{gender:"androgynous",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"female",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"female",test:["ка","га","ха"],mods:["-и","-е","-у","-ой","-е"]},{gender:"female",test:["ца"],mods:["-ы","-е","-у","-ей","-е"]},{gender:"female",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"female",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"male",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["ий"],mods:["-я","-ю","-я","-ем","-и"]},{gender:"male",test:["ый","кий","хий"],mods:["--ого","--ому","--ого","-м","--ом"]},{gender:"male",test:["ей","й"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["ш","ж"],mods:["а","у","а","ем","е"]},{gender:"male",test:["ёл"],mods:["--ла","--лу","--ла","--лом","--ле"]},{gender:"male",test:["б","в","г","д","ж","з","к","л","м","н","п","р","с","т","ф","х","ц","ч"],mods:["а","у","а","ом","е"]},{gender:"androgynous",test:["ния","рия","вия"],mods:["-и","-и","-ю","-ем","-ем"]}]};l(A),l(B),l(M);var N=["форт-шевченко"],R=["-"," ","в","на","баден","бледно","буэнос","вице","гаврилов","йошкар","коста","лос","норд","нью","орехово","принс","сан","санкт","санта","северо","ситтард","темно","улан","усолье","усть","форт","царь","экс","юго","юрьев"],_=["село","поселок","аул","город","деревня"],$={exceptions:[{gender:"androgynous",test:["сочи","тбилиси"],mods:["","","","",""]},{gender:"androgynous",test:["село"],mods:["-а","-у","","м","-е"]}],suffixes:[{gender:"androgynous",test:["чёк","чек"],mods:["--ка","--ку","","--ком","--ке"]},{gender:"androgynous",test:["чик"],mods:["а","у","","ом","е"]},{gender:"androgynous",test:["жний","хний","шний","щий"],mods:["--его","--ему","","-м","--ем"]},{gender:"androgynous",test:["ще"],mods:["-а","-у","","м",""]},{gender:"androgynous",test:["чье"],mods:["-я","-ю","","м",""]},{gender:"androgynous",test:["чь"],mods:["-и","-и","","ю","-и"]},{gender:"androgynous",test:["чи"],mods:["-ей","-ам","","-ами","-ах"]},{gender:"androgynous",test:["ые","ие"],mods:["-х","-м","","-ми","-х"]},{gender:"androgynous",test:["ый","ий","ое"],mods:["--ого","--ому","","-м","--ом"]},{gender:"androgynous",test:["ая"],mods:["--ой","--ой","--ую","--ой","--ой"]},{gender:"androgynous",test:["иев"],mods:["а","у","","ым","ом"]},{gender:"androgynous",test:["ны"],mods:["-ов","-ам","","-ами","-ах"]},{gender:"androgynous",test:["ша"],mods:["-и","-е","-у","-ей","-е"]}]};l($),e.incline=function(e,r){var n={};return n.gender||(n.gender=o(e)),e.first&&(n.first=h(e.first.trim(),r,n.gender)),e.last&&(n.last=S(e.last.trim(),r,n.gender)),e.middle&&(n.last=y(e.middle.trim(),r,n.gender)),n},e.inclineFirstname=h,e.inclineLastname=S,e.inclineMiddlename=y,e.getGender=o,e.getFirstnameGender=function(e){return d(r(e))},e.getLastnameGender=function(e){return d(n(e))},e.getMiddlenameGender=function(e){return d(t(e))},e.cityIn=function(e,r){return P(e,N)?e:e.split(/(\s|-)/g).map(function(e,n,t){if(b(e,n,t))return e;var s=m(e,O,$);return s?v(s,e,T):h(e,T,r)||e}).join("")},e.cityFrom=function(e,r){return P(e,N)?e:e.split(/(\s|-)/g).map(function(e,n,t){if(b(e,n,t))return e;var s=m(e,O,$);return s?v(s,e,L):h(e,L,r)||e}).join("")},e.cityTo=function(e){if(!e)return e;var r=e.toLowerCase();return r.endsWith("а")?p(e,"-у"):r.endsWith("ая")?p(e,"--ую"):e},Object.defineProperty(e,"__esModule",{value:!0})})},{}],2:[function(e,r,n){"use strict";function t(e,r,n,t,s,o,a){function i(){r.addOrderInfoListener(function(e){S.orderInfo=e}),r.addUpdateOrderServicesListener(function(e){S.orderInfo=e[1],S.priceVariant=e[2],S.isFreePricevariant=n.isFreePricevariant(e[2]),S.isFreePricevariant&&(S.showNeedSelectPaymentFormMesage=!1),S.es=n.reformatAvailableExtraServices(e[0],S.orderInfo,S.es),S.esList=n.getAvailableExtraServicesList(e[0],S.es),_.forEach(S.es,function(e){"insurance"===e.code&&1===e.items.length||(e.active=!0)}),_.forEach(S.esList,function(e){S.extraServicesList.push(e)}),S.searchOrderLoading=!1,S.orderServicesLoading=!1,r.getParam("ffp.enable")&&(S.orderInfo.hasBonusCard||S.orderInfo.ffpSumm)&&r.ffpBonus().then(function(e){S.ffpBonus=e.total||0})},function(e){S.searchOrderLoading=!1,S.orderServicesLoading=!1,S.errorMessage=e.error,"web.extraServices.submitError"===S.errorMessage&&(S.showBackButton=!0)}),r.updateOrderServices(!0).then(function(){S.loading=!0,r.switchDefaultSelectedServices(S.esList,S.es,S.orderInfo).then(function(){S.loading=!1})}),r.addExtraServiceListener(function(e){S.modifyServicesLoading=!e,S.orderServicesLoading=!0}),r.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(S.modifyServicesError=e.error),S.modifyServicesLoading=!1,S.orderServicesLoading=!0})}function c(e){!S.agree||S.modifyServicesLoading||S.orderServicesLoading||(S.selectedPaymentForm&&S.selectedPaymentType?r.getParam("site.rossiyaAirlineMode")?fancyboxTools.openHandler("popupOrderEmailRequired",!1,{phoneRequiredToo:!0,submitCallback:function(r,n){d(e,r,n)}}):d(e):S.showNeedSelectPaymentFormMesage=!0)}function d(e,n,t){S.confirmLoading=!0,S.confirmError&&delete S.confirmError,r.startPaymentForExtraServices(S.selectedPaymentForm,S.selectedPaymentType,e,n,t,S.card).then(function(s){s.pnr&&s.lastName?o.goToConfirmOrder(s.pnr,s.lastName):s.eraseAeroexpressBecauseOfCurrency||s.eraseInsuranceBecauseOfCurrency?fancyboxTools.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:s.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:s.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:c}):s.removedSvcs&&s.removedSvcs.length&&fancyboxTools.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d(e,n,t)},closeCallback:function(){r.updateOrderServices(!0)},removedSvcs:s.removedSvcs,svcsToIssue:s.svcsToIssue,noExtraServicesLeft:s.noExtraServicesLeft,disableOutsideCloseClick:!0}),S.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?S.fatalError=e.error:S.confirmError=e.error,S.confirmLoading=!1})}function l(){S.showNeedSelectPaymentFormMesage=!1}function u(){return s.location.reload(),!1}function m(e,n){r.getParam("site.separatePassengersSearchOrder")?o.goToViewSeparateOrder(e,n):o.goToSearchOrder(e,n)}function g(){S.loading||(S.es.insurance.active?(r.removeExtraService({code:S.es.insurance.onlineMode?"insuranceOnline":"insurance"}),S.es.insurance.active=!1):1===S.es.insurance.items.length&&r.modifyExtraService(h(S.es.insurance.items[0])))}function f(){r.clearSession().then(function(){o.goToSearchOrder()})}function v(e,r){S.selected=e}function p(){S.selected=null}function h(e,r){var n={code:"insurance",ins:e.ins,tins:e.tins};return r&&(n.passenger_id=r),S.es.insurance.onlineMode&&(n.code="insuranceOnline",n.productCode=e.productCode),n}var S=this;S.loading=!0,S.searchOrderLoading=!0,S.orderServicesLoading=!0,S.extraServicesList=[],S.selected=null,S.switchInsurance=g,S.openOrder=m,S.submitPayment=c,S.paymentFormChangeHandler=l,S.reloadPage=u,S.clearSession=f,S.handleEsSelect=v,S.closePopup=p,e.$on("plasticCardForPaymentChangeEvent",function(e,r){S.card=r}),r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","addServices")),r.addOrderInfoListener(function(e){S.orderInfo=e},!1,!0),S.pnrOrTicketNumber=t.pnrOrTicketNumber,S.lastName=t.lastName,S.loading=!1,r.clearOrderInfoListeners(),r.clearUpdateOrderServicesListeners(),S.orderInfo=r.getOrderInfo(),S.orderInfo?i():r.searchOrder(S.pnrOrTicketNumber,S.lastName,!0).then(i,function(e){S.searchOrderLoading=!1,S.orderServicesLoading=!1,S.errorMessage=e.error})})}angular.module("app").component("nordwindEs",{templateUrl:"components/nordwind-es/nordwind-es.html",bindings:{orderInfo:"=",loading:"="},bindToController:!0,controllerAs:"vm",controller:"nordwindEsController"}),angular.module("app").controller("nordwindEsController",["$scope","backend","utils","$routeParams","$window","redirect","$rootScope",t])},{}],3:[function(e,r,n){"use strict";function t(e){var r=this;e.ready.then(function(){e.getExtraServices().then(function(e){r.extraServicesList=e.slice()})})}angular.module("app").component("nordwindMeal",{templateUrl:"components/nordwind-meal/nordwind-meal.html",bindings:{service:"="},controller:["backend",t],controllerAs:"vm"})},{}],4:[function(e,r,n){"use strict";function t(e){function r(){s.locked||(s.service.active=!s.service.active,s.service.active?1===s.service.items.length&&e.modifyExtraService(t(s.service.items[0])):e.removeExtraService({code:s.service.onlineMode?"insuranceOnline":"insurance"})),s.closePopup()}function n(r,n){s.locked||("common"===n?e[s.service.items[r].selected?"modifyExtraService":"removeExtraService"](t(s.service.items[r])):e[s.service.itemsByPassengers[n][r].selected?"modifyExtraService":"removeExtraService"](t(s.service.itemsByPassengers[n][r],s.orderInfo.passengers[n].id)))}function t(e,r){var n={code:"insurance",ins:e.ins,tins:e.tins};return r&&(n.passenger_id=r),s.service.onlineMode&&(n.code="insuranceOnline",n.productCode=e.productCode),n}var s=this;s.switchService=r,s.switchServiceItem=n,s.closePopup=s.closePopup(),s.orderInfo=e.getOrderInfo()}var s=angular.module("app");s.component("nwInsurance",{templateUrl:"components/nw-insurance/nw-insurance.html",controllerAs:"vm",controller:"nwInsuranceController",bindings:{service:"=service",locked:"=locked",closePopup:"&"}}),s.controller("nwInsuranceController",["backend",t])},{}],5:[function(e,r,n){"use strict";function t(e,r,n,t){function s(){p.locked||n.checkServiceRemovalProhibited("meal")||(p.service.active=!p.service.active,p.service.active?a():n.removeExtraService({code:"meal"}),p.closePopup())}function o(e,r){p.selectedFlight=e,p.selectedPassenger=r,i()}function a(){p.selectedFlight=f(),p.selectedPassenger=v(p.selectedFlight),i()}function i(){p.mealMenu=p.service.itemsByPassengerSegments[p.selectedPassenger][p.selectedFlight],p.mealMenuSubgroup=!1}function c(e,r,t){p.locked||n.modifyExtraService({code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,subgroup:p.service.subgroups[e],amount:(r.alreadySelectedCount||0)+t,rfisc:r.rfisc})}function d(e,r){p.locked||n.checkServiceRemovalProhibited("meal",e,r)||n.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[e].id,segment_id:p.orderInfo.plainFlights[r].id})}function l(e,r){var n,t=0,s=0;return p.orderInfo.groupedEditableExtraServices&&p.orderInfo.groupedEditableExtraServices.meal&&p.orderInfo.groupedEditableExtraServices.meal[e]&&p.orderInfo.groupedEditableExtraServices.meal[e][r]&&p.orderInfo.groupedEditableExtraServices.meal[e][r].length&&p.orderInfo.groupedEditableExtraServices.meal[e][r].forEach(function(e){e.amount&&(t+=e.amount),e.totalPrice&&(s=Big(s).plus(e.totalPrice).toFixed(2),n=e.currency)}),t?{count:t,cost:s,currency:n}:!1}function u(){h.scrollTo(0)}function m(){h.scrollTo(h[0].scrollWidth)}function g(){var r=h[0].scrollLeft,n=h[0].scrollWidth,t=h[0].clientWidth,s=n-t-r;p.canScrollRight=0!==s,p.canScrollLeft=0!==r,e.$apply()}function f(){var e;for(e=0;e<p.orderInfo.plainFlights.length;e++)if(p.service.availableBySegments[e])return e;return-1}function v(e){var r;if(p.service.availableByPassengerSegments)for(r=0;r<p.orderInfo.passengers.length;r++)if(p.service.availableByPassengerSegments[r][e])return r;return-1}var p=this,h=r.find("div.passengersTableContainer");p.switchService=s,p.selectFlightPassenger=o,p.selectFirstAvailablePassengerFlight=a,p.mealCountChangeHandler=c,p.removePassengerFlightMeal=d,p.getSelectedPassengerFlightMeal=l,p.scrollToStart=u,p.scrollToEnd=m,p.hasAlias=n.hasAlias,p.getAvailablePassengersCount=t.getAvailablePassengersCount,p.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,p.closePopup=p.closePopup(),p.canScrollRight=!0,p.canScrollLeft=!1,p.selectedFlight=0,p.selectedPassenger=0,n.getParam("site.externalStorageBaseUrl")?p.mealImagesPath=n.getParam("site.externalStorageBaseUrl")+"/img/content/meal":p.mealImagesPath="./themes/websky/assets/static/img/content/meal",n.addOrderInfoListener(function(e){console.log(e),p.orderInfo=e},!1,!0),e.$watch("vm.service",function(){i()}),h.on("scroll",g),p.service.active&&i()}angular.module("app").component("nwMeal",{templateUrl:"components/nw-meal/nw-meal.html",controller:["$scope","$element","backend","utils",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked",closePopup:"&"}})},{}],6:[function(e,r,n){"use strict";function t(e,r,n,t,s,o){function a(){b.locked||s.checkServiceRemovalProhibited("seat")||(b.service.active=!b.service.active,b.service.active?l():(b.modifyError=!1,s.removeExtraService({code:"seat"}).then(i,function(e){e.error&&(b.modifyError=e.error)}))),b.closePopup()}function i(){b.seatMap=!1,b.selectedFlight=-1,b.selectedPassenger=-1}function c(e){w=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function d(e,r){c(b.selectedFlight!==e),b.selectedFlight=e,b.selectedPassenger=r,u()}function l(){b.selectedFlight=f(),b.selectedPassenger=v(b.selectedFlight),u(),console.log("here"),console.log(b.selectedFlight)}function u(){-1!==b.selectedPassenger&&-1!==b.selectedFlight&&(b.loadingSeatMap=!0,b.seatMapError=!1,s.seatMap(b.orderInfo.passengers[b.selectedPassenger].id,b.orderInfo.plainFlights[b.selectedFlight].id).then(function(e){b.seatMap=e,b.loadingSeatMap=!1,n(function(){jQuery("#seatMapCont .mCSB_container").css("top",w)})},function(e){b.seatMapError=e.error,b.loadingSeatMap=!1}))}function m(e,r,n){b.locked||e.available&&r&&(c(),b.modifyError=!1,s.modifyExtraService({code:"seat",passenger_id:b.orderInfo.passengers[b.selectedPassenger].id,segment_id:b.orderInfo.plainFlights[b.selectedFlight].id,value:n+e.number,subgroup:b.service.commonSubgroup,rfisc:e.rfisc||""}).then(u,function(e){e.error&&(b.modifyError=e.error)}))}function g(){b.sunInfoByFlights=[],b.orderInfo.plainFlights.forEach(function(e,r){s.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){b.sunInfoByFlights[r]=e})})}function f(){var e;for(e=0;e<b.orderInfo.plainFlights.length;e++)if(b.service.availableBySegments[e])return e;return-1}function v(e){var r;if(b.service.availableByPassengerSegments)for(r=0;r<b.orderInfo.passengers.length;r++)if(b.service.availableByPassengerSegments[r][e])return r;return-1}function p(){x.scrollTo(0)}function h(){x.scrollTo(x[0].scrollWidth)}function S(){var r=x[0].scrollLeft,n=x[0].scrollWidth,t=x[0].clientWidth,s=n-t-r;b.canScrollRight=0!==s,b.canScrollLeft=0!==r,e.$apply()}function y(e){var r=o.getAvailablePassengersCount(e);return r+b.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function P(e,r){b.locked||s.checkServiceRemovalProhibited("seat",e,r)||(b.modifyError=!1,s.removeExtraService({code:"seat",passenger_id:b.orderInfo.passengers[e].id,segment_id:b.orderInfo.plainFlights[r].id}).then(function(){b.selectedFlight===r&&u()},function(e){e.error&&(b.modifyError=e.error)}))}var b=this,x=r.find("div.passengersTableContainer"),w="0px";b.switchService=a,b.selectFlightPassenger=d,b.selectFirstAvailablePassengerFlight=l,b.setPassengerFlightSeat=m,b.closePopup=b.closePopup(),b.hasAlias=s.hasAlias,b.scrollToStart=p,b.scrollToEnd=h,b.getAvailablePassengersCount=o.getAvailablePassengersCount,b.getAvailablePassengersCountWrap=y,b.removePassengerFlightSeat=P,b.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,b.canScrollRight=!0,b.canScrollLeft=!1,b.isBookingScreen=t.isBookingScreen(),s.addOrderInfoListener(function(e){b.orderInfo=e},!1,!0),g(),x.on("scroll",S),b.service.active&&l()}angular.module("app").component("nwSeat",{templateUrl:"components/nw-seat/nw-seat.html",controller:["$scope","$element","$timeout","redirect","backend","utils",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked",closePopup:"&"}})},{}],7:[function(e,r,n){"use strict";var t=e("lvovich/dist/lvovich.min");angular.module("app").filter("toCity",function(){return function(e){return"в "+t.cityTo(e)}})},{"lvovich/dist/lvovich.min":1}],8:[function(e,r,n){"use strict";e("lvovich/dist/lvovich.min"),e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),e("./components/nordwind-es/nordwind-es"),e("./components/nordwind-meal/nordwind-meal"),e("./components/nw-meal/nw-meal"),e("./components/nw-seat/nw-seat"),e("./components/nw-insurance/nw-insurance"),e("./filters/toCity")},{"./components/nordwind-es/nordwind-es":2,"./components/nordwind-meal/nordwind-meal":3,"./components/nw-insurance/nw-insurance":4,"./components/nw-meal/nw-meal":5,"./components/nw-seat/nw-seat":6,"./filters/toCity":7,"./screens/add-services/AddServicesScreenController":9,"./screens/search-order/search-order":10,"lvovich/dist/lvovich.min":1}],9:[function(e,r,n){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,n,t,s,o,a){function i(){s.addOrderInfoListener(function(e){f.orderInfo=e}),s.addUpdateOrderServicesListener(function(e){f.orderInfo=e[1],f.priceVariant=e[2],f.isFreePricevariant=o.isFreePricevariant(e[2]),f.isFreePricevariant&&(f.showNeedSelectPaymentFormMesage=!1),f.es=o.reformatAvailableExtraServices(e[0],f.orderInfo,f.es),f.esList=o.getAvailableExtraServicesList(e[0],f.es),f.searchOrderLoading=!1,f.orderServicesLoading=!1,s.getParam("ffp.enable")&&(f.orderInfo.hasBonusCard||f.orderInfo.ffpSumm)&&s.ffpBonus().then(function(e){f.ffpBonus=e.total||0})},function(e){f.searchOrderLoading=!1,f.orderServicesLoading=!1,f.errorMessage=e.error,"web.extraServices.submitError"===f.errorMessage&&(f.showBackButton=!0)}),s.updateOrderServices(!0).then(function(){f.loading=!0,s.switchDefaultSelectedServices(f.esList,f.es,f.orderInfo).then(function(){f.loading=!1})}),s.addExtraServiceListener(function(e){f.modifyServicesLoading=!e,f.orderServicesLoading=!0}),s.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(f.modifyServicesError=e.error),f.modifyServicesLoading=!1,f.orderServicesLoading=!0})}function c(e){!f.agree||f.modifyServicesLoading||f.orderServicesLoading||(f.selectedPaymentForm&&f.selectedPaymentType?s.getParam("site.rossiyaAirlineMode")?a.openHandler("popupOrderEmailRequired",!1,{phoneRequiredToo:!0,submitCallback:function(r,n){d(e,r,n)}}):d(e):f.showNeedSelectPaymentFormMesage=!0);
}function d(e,r,n){f.confirmLoading=!0,f.confirmError&&delete f.confirmError,s.startPaymentForExtraServices(f.selectedPaymentForm,f.selectedPaymentType,e,r,n,f.card).then(function(o){o.pnr&&o.lastName?t.goToConfirmOrder(o.pnr,o.lastName):o.eraseAeroexpressBecauseOfCurrency||o.eraseInsuranceBecauseOfCurrency?a.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:o.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:o.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:c}):o.removedSvcs&&o.removedSvcs.length&&a.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d(e,r,n)},closeCallback:function(){s.updateOrderServices(!0)},removedSvcs:o.removedSvcs,svcsToIssue:o.svcsToIssue,noExtraServicesLeft:o.noExtraServicesLeft,disableOutsideCloseClick:!0}),f.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?f.fatalError=e.error:f.confirmError=e.error,f.confirmLoading=!1})}function l(){f.showNeedSelectPaymentFormMesage=!1}function u(){return n.location.reload(),!1}function m(e,r){s.getParam("site.separatePassengersSearchOrder")?t.goToViewSeparateOrder(e,r):t.goToSearchOrder(e,r)}function g(){s.clearSession().then(function(){t.goToSearchOrder()})}var f=this;f.loading=!0,f.searchOrderLoading=!0,f.orderServicesLoading=!0,f.openOrder=m,f.submitPayment=c,f.paymentFormChangeHandler=l,f.reloadPage=u,f.clearSession=g,e.$on("plasticCardForPaymentChangeEvent",function(e,r){f.card=r}),s.ready.then(function(){angular.element("title").text(s.getAliasWithPrefix("web.pageTitle.","addServices")),f.pnrOrTicketNumber=r.pnrOrTicketNumber,f.lastName=r.lastName,f.loading=!1,s.clearOrderInfoListeners(),s.clearUpdateOrderServicesListeners(),f.orderInfo=s.getOrderInfo(),f.orderInfo?i():s.searchOrder(f.pnrOrTicketNumber,f.lastName,!0).then(i,function(e){f.searchOrderLoading=!1,f.orderServicesLoading=!1,f.errorMessage=e.error})})}])},{}],10:[function(e,r,n){"use strict";function t(e,r,n){function t(){r.clearSession(),r.clearOrderInfo(),d.orderInfo=!1,d.showSearchForm=!0,d.partiallyAddedPassengers=[]}function s(){d.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!d.searchOrderAgree||!d.searchOrderForm.$valid||(d.searchLoading=!0,d.errorMessage=!1,r.searchOrderByParams(d.searchParams,!!d.partiallyAddedPassengers.length).then(function(e){d.searchParams.flight&&d.searchParams.date?d.searchParams={flight:d.searchParams.flight,date:d.searchParams.date}:e.needToSpecifyDocument||(d.searchParams={}),d.needToSpecifyDocument=e.needToSpecifyDocument,d.showSearchForm=!1,d.submitTouched=!1,e.orderCompletelyInitialized?(d.partiallyAddedPassengers=[],o()):(e.partiallyAddedPassengers&&(d.partiallyAddedPassengers=e.partiallyAddedPassengers),d.needToSpecifyDocument&&(d.showSearchForm=!0)),d.searchLoading=!1},a))}function o(){r.updateOrderInfo().then(function(e){e.passengers&&(d.orderInfo=e,d.showSearchForm=!1),d.loading=!1},a)}function a(e){d.loading=!1,d.searchLoading=!1,"web.messages.emptyOrder"!==e.error&&(d.errorMessage=e.error)}function i(){r.finishSeparatePassengersSearch().then(o,a)}function c(){d.showSearchForm=!0}var d=this;d.loading=!0,d.showSearchForm=!0,d.searchParams={},d.partiallyAddedPassengers=[],d.submitSearch=s,d.confirmHandler=i,d.clear=t,d.addPassenger=c,r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),d.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,d.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,d.ticketRegexp=r.applicationConstants.ticketRegexp,e.pnrOrTicketNumber&&e.lastName&&"LAST_NAME_PNR_TICKET"===r.getParam("site.searchOrdersBy")?(d.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,d.searchParams.lastName=e.lastName,d.loading=!1,n(s)):o()})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","$timeout",t])},{}]},{},[8]);
//# sourceMappingURL=controllers-nordwind.js.map
