!function(){function e(r,n,t){function s(a,i){if(!n[a]){if(!r[a]){var c="function"==typeof require&&require;if(!i&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[a]={exports:{}};r[a][0].call(l.exports,function(e){var n=r[a][1][e];return s(n||e)},l,l.exports,e,r,n,t)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<t.length;a++)s(t[a]);return s}return e}()({1:[function(e,r,n){!function(e,t){"object"==typeof n&&"undefined"!=typeof r?t(n):"function"==typeof define&&define.amd?define(["exports"],t):t(e.lvovich={})}(this,function(e){"use strict";function r(e,r){var n=e.length;return e.substring(n-r.length,n)===r}function n(e){return i(e,w.firstname)}function t(e){return i(e,w.lastname)}function s(e){return i(e,w.middlename)}function o(e,r){return e===O?r:r===O?e:e===r?e:null}function a(e){return l(function(e){var r=O;if(e.middle&&(r=o(r,s(e.middle.trim()))),e.first&&(r=o(r,n(e.first.trim()))),e.last){var a=t(e.last.trim());null!==a&&(r=o(r,a))}return r}(e))}function i(e,n){if(!e||!n)return null;var t=e.toLowerCase();if(n.exceptions){var s=c(n.exceptions,function(e){return e.substr(!s||0>s?0:+s,(n="-").length)===n?r(t,e.substr(1)):e===t;var n,s});if(s)return s}return n.suffixes?c(n.suffixes,function(e){return r(t,e)}):null}function c(e,r){var n=Object.keys(e).filter(function(n){var t=e[n];return Array.isArray(t)&&t.some(r)});return 1!==n.length?(Object.keys(e).forEach(function(n){var t=e[n];Array.isArray(t)&&t.some(r)}),null):d(n[0])}function d(e){switch(e){case"male":case E:return E;case"female":case C:return C;case"androgynous":case O:return O;default:return null}}function l(e){switch(e){case"male":case E:return"male";case"female":case C:return"female";case"androgynous":case O:return"androgynous";default:return null}}function u(e){Array.isArray(e.exceptions)&&e.exceptions.forEach(function(e){e.gender=d(e.gender)}),Array.isArray(e.suffixes)&&e.suffixes.forEach(function(e){e.gender=d(e.gender)})}function f(e,r,n,t){for(var s=function(e){switch(e){case"nominative":case B:return B;case"genitive":case _:return _;case"dative":case L:return L;case"accusative":case F:return F;case"instrumental":case k:return k;case"prepositional":case A:return A;default:return null}}(r),o=d(n),a=e.split("-"),i=[],c=0;c<a.length;c++){var l=a[c],u=m(l,o,t,{firstWord:0===c&&1<a.length});i.push(u?v(u,l,s):l)}return i.join("-")}function m(e,n,t){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(!e)return null;var o=e.toLowerCase(),a=[];if(Object.keys(s).forEach(function(e){s[e]&&a.push(e)}),t.exceptions){var i=g(t.exceptions,n,function(e){return e===o},a);if(i)return i}return t.suffixes?g(t.suffixes,n,function(e){return r(o,e)},a):null}function g(e,r,n){for(var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],s=0;s<e.length;s++){var o=e[s];if((!o.tags||o.tags.find(function(e){return-1!=t.indexOf(e)}))&&(o.gender===O||r===o.gender)&&o.test)for(var a=0;a<o.test.length;a++)if(n(o.test[a]))return o}return null}function p(e,r){return e&&r<=e.length?e[r]:"."}function v(e,r,n){var t;switch(n){case B:t=".";break;case _:t=p(e.mods,0);break;case L:t=p(e.mods,1);break;case F:t=p(e.mods,2);break;case k:t=p(e.mods,3);break;case A:t=p(e.mods,4);break;default:t="."}return h(r,t)}function h(e,r){for(var n=0;n<r.length;n++){var t=r[n];switch(t){case".":break;case"-":e=e.substr(0,e.length-1);break;default:e+=t}}return e}function y(e){return f(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||n(e),M)}function b(e){return f(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||t(e),T)}function S(e){return f(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"accusative",(2<arguments.length?arguments[2]:void 0)||s(e),N)}function x(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.forEach(function(r){var t,s,o;o=n[s=r],s in(t=e)?Object.defineProperty(t,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[s]=o})}return e}function P(e,r){for(var n=e.toLowerCase(),t=0;t<r.length;t++)if(r[t]===n)return!0;return!1}function I(e,r,n){if(1<n.length){if(P(e,R))return!0;for(var t=0;r>t;t++)if(P(n[t],W))return!0}return!1}var w={lastname:{exceptions:{androgynous:["бова","регин","дарвин","пэйлин","грин","цин","шенгелая"]},suffixes:{androgynous:["ан","ко","дзе","швили","ян","к","ер","ц","г","йн","дт","ен","ич","о","ун"],female:["ова","ая","ына","ина","ева","ска","ёва"],male:["кий","ов","ын","ев","ин","ёв","хий","ний","ый","ой"]}},firstname:{exceptions:{androgynous:["анри","алвард","валери","женя","закия","захария","иона","кири","ким","муса","райхон","саша","сева","ардак","арман","асыл","баглан","бакыт","бахыт","еркежан","жанат","жаркын","куаныш","манат","мереке","рауан","сымбат","тлеухан","умит","улжалгас","ырыс","айбала","акбала","ирза","арши","амиль"],male:["аба","абиба","савва","лёва","вова","-ага","агга","серега","алиада","муктада","абида","алда","маджуда","нурлыхуда","гиа","элиа","гарсиа","вавила","гавриила","генка","лука","дима","зосима","тима","фима","фома","кузьма","жора","миша","ермила","данила","гаврила","абдалла","аталла","абдилла","атилла","кайролла","абула","свитлана","бена","гена","агелина","джанна","кришна","степа","дра","назера","валера","эстера","двойра","калистра","заратустра","юра","иса","аиса","халиса","холиса","валенса","мусса","ата","паата","алета","никита","мота","шота","фаста","коста","маритта","малюта","васюта","вафа","мустафа","ганифа","лев","яков","константин","марсель","рамиль","эмиль","бактыгуль","даниэль","игорь","арминэ","изя","кузя","гия","мазия","кирикия","ркия","еркия","эркия","гулия","аксания","закария","зекерия","гарсия","шендля","филя","вилля","толя","коля","ваня","саня","загиря","боря","цайся","вася","ося","петя","витя","митя","костя","илья","абдала","абдель","фидель","фридель","абдилла","аталла","абла","лазарь","ава","вовка","семён"],female:["судаба","сураба","любава","джанлука","варвара","наташа","зайнаб","любов","сольвейг","шакед","аннаид","ингрид","синди","аллаберди","лали","натали","лили","нелли","элли","эмили","амили","адели","гулькай","алтынай","гюнай","гюльчитай","нурангиз","лиз","элиз","ботагоз","юлдуз","диляфруз","габи","сажи","фанни","мери","элдари","эльдари","хилари","хиллари","аннемари","розмари","товсари","ансари","одри","тери","ири","катя","катри","мэри","сатаней","ефтений","верунчик","гюзел","этел","рэйчел","джил","мерил","нинелл","бурул","ахлам","майрам","махаррам","мириам","дилярам","асем","мерьем","мирьем","эркаим","гулаим","айгерим","марьям","мирьям","эван","гульжиган","айдан","айжан","вивиан","гульжиан","лилиан","мариан","саиман","джоан","чулпан","лоран","моран","гульшан","аделин","жаклин","карин","каролин","каталин","катрин","керстин","кэтрин","мэрилин","рузалин","хелин","цеткин","ширин","элисон","дурсун","кристин","гульжиян","марьян","ренато","зейнеп","санабар","дильбар","гулизар","гульзар","пилар","дагмар","элинар","нилуфар","анхар","гаухар","естер","эстер","дженнифер","линор","элинор","элеонор","айнур","гульнур","шамсинур","элнур","ильсияр","нигяр","сигитас","агнес","анес","долорес","инес","анаис","таис","эллис","элис","кларис","амнерис","айрис","дорис","беатрис","грейс","грэйс","ботагос","маргос","джулианс","арус","диляфрус","саодат","зулхижат","хамат","патимат","хатимат","альжанат","маймунат","гульшат","рут","иргаш","айнаш","агнеш","зауреш","тэрбиш","ануш","азгануш","гаруш","николь","адась","адула","ахмадула","гейбадула","лив","ираги","пегги","абдурефи","адерми","лакшми","мими","наоми","изабель","абигейль","зебо","аширбу","судаба","айсулу","айши","жанет","гузаль","сапият","зауре","кармен","мадлен","алсу","айсу","амели","-бану","ассоль","николь"]},suffixes:{androgynous:["щи","ки"],male:["аба","б","ав","ев","ов","во","г","д","ж","з","би","ди","жи","ли","гани","ит","до","айт","юм","дула","ив","ги","улла","улль","фи","аль","ми","бель","була","йль","яй","бо","бу","кр","ыль","ыт","вва","вель","вни","аба","бала","улу","рза","ши","паша","го","но","ет","ят","ре","ри","ай","ей","ий","ой","ый","к","л","ам","ем","им","ом","ум","ым","ям","ан","бен","вен","ген","ден","ин","сейн","он","ун","ян","ио","ло","ро","то","шо","п","ар","др","ер","ир","ор","тр","ур","ыр","яр","ас","ес","ис","йс","кс","мс","ос","нс","рс","ус","юс","яс","ат","кт","нт","рт","ст","ут","ф","х","ш","ы","сь","тау","ен","коль","рау","обе","убе","иль","ево","ово","шу","ду","пуль","нко","су","вль","оль","ёв","ём","ец","сс","льс","хт","рн","дт"],female:["иба","люба","лава","ева","га","да","еа","иза","иа","ика","нка","ска","ела","ила","илла","эла","има","на","ра","са","та","фа","еса","сса","гуль","куль","нуэль","гюль","нэ","ая","ея","ия","йя","ля","мя","оя","ря","ся","вья","лья","мья","нья","рья","сья","тья","фья","зя","нша","ха","тка","нь","чь","мь","ерь","овка","евка","мба","зь","лка","сала","бла","арь","ума","пи","дель","не","жка","си","ибе","абе","елла","ие","фе","фя"]}},middlename:{suffixes:{female:["на","кызы","гызы"],male:["ич","оглы","улы","уулу"]}}},E=1,C=2,O=4,B=1,_=2,L=3,F=4,k=5,A=6,T={exceptions:[{gender:"androgynous",test:["бонч","абдул","белиц","гасан","дюссар","дюмон","книппер","корвин","ван","шолом","тер","призван","мелик","вар","фон"],mods:[".",".",".",".","."],tags:["first_word"]},{gender:"androgynous",test:["дюма","тома","дега","люка","ферма","гамарра","петипа","шандра","скаля","каруана"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["гусь","ремень","камень","онук","богода","нечипас","долгопалец","маненок","рева","кива"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["вий","сой","цой","хой"],mods:["-я","-ю","-я","-ем","-е"]}],suffixes:[{gender:"female",test:["б","в","г","д","ж","з","й","к","л","м","н","п","р","с","т","ф","х","ц","ч","ш","щ","ъ","ь"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["орота"],mods:[".",".",".",".","."]},{gender:"female",test:["ска","цка"],mods:["-ой","-ой","-ую","-ой","-ой"]},{gender:"female",test:["цкая","ская","ная","ая"],mods:["--ой","--ой","--ую","--ой","--ой"]},{gender:"female",test:["яя"],mods:["--ей","--ей","--юю","--ей","--ей"]},{gender:"male",test:["иной","уй"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["ца"],mods:["-ы","-е","-у","-ей","-е"]},{gender:"male",test:["рих"],mods:["а","у","а","ом","е"]},{gender:"androgynous",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"androgynous",test:["иа","аа","оа","уа","ыа","еа","юа","эа"],mods:[".",".",".",".","."]},{gender:"androgynous",test:["о","е","э","и","ы","у","ю"],mods:[".",".",".",".","."]},{gender:"male",test:["их","ых"],mods:[".",".",".",".","."]},{gender:"female",test:["ова","ева","на","ёва"],mods:["-ой","-ой","-у","-ой","-ой"]},{gender:"androgynous",test:["га","ка","ха","ча","ща","жа","ша"],mods:["-и","-е","-у","-ой","-е"]},{gender:"androgynous",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"male",test:["ь"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["обей"],mods:["--ья","--ью","--ья","--ьем","--ье"]},{gender:"male",test:["ей"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["ян","ан","йн"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ынец","овец"],mods:["--ца","--цу","--ца","--цом","--це"]},{gender:"male",test:["нец","обец"],mods:["--ца","--цу","--ца","--цем","--це"]},{gender:"male",test:["ай"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["гой","кой"],mods:["-го","-му","-го","--им","-м"]},{gender:"male",test:["ой"],mods:["-го","-му","-го","--ым","-м"]},{gender:"male",test:["ах","ив","шток"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ший","щий","жий","ний"],mods:["--его","--ему","--его","-м","--ем"]},{gender:"male",test:["ый","кий","хий"],mods:["--ого","--ому","--ого","-м","--ом"]},{gender:"male",test:["ий"],mods:["-я","-ю","-я","-ем","-и"]},{gender:"male",test:["ок"],mods:["--ка","--ку","--ка","--ком","--ке"]},{gender:"male",test:["иец","еец"],mods:["--йца","--йцу","--йца","--йцом","--йце"]},{gender:"male",test:["ец"],mods:["--ца","--цу","--ца","--цом","--це"]},{gender:"male",test:["ц","ч","ш","щ"],mods:["а","у","а","ем","е"]},{gender:"male",test:["ен","нн","он","ун","б","г","д","ж","з","к","л","м","п","р","с","т","ф","х"],mods:["а","у","а","ом","е"]},{gender:"male",test:["в","н"],mods:["а","у","а","ым","е"]}]},N={exceptions:[{gender:"androgynous",test:["борух"],mods:[".",".",".",".","."],tags:["first_word"]}],suffixes:[{gender:"male",test:["мич","ьич","кич"],mods:["а","у","а","ом","е"]},{gender:"male",test:["ич"],mods:["а","у","а","ем","е"]},{gender:"female",test:["на"],mods:["-ы","-е","-у","-ой","-е"]}]},M={exceptions:[{gender:"male",test:["лев"],mods:["--ьва","--ьву","--ьва","--ьвом","--ьве"]},{gender:"male",test:["пётр"],mods:["---етра","---етру","---етра","---етром","---етре"]},{gender:"male",test:["павел"],mods:["--ла","--лу","--ла","--лом","--ле"]},{gender:"male",test:["яша"],mods:["-и","-е","-у","-ей","-е"]},{gender:"male",test:["шота"],mods:[".",".",".",".","."]},{gender:"female",test:["агидель","жизель","нинель","рашель","рахиль"],mods:["-и","-и",".","ю","-и"]}],suffixes:[{gender:"androgynous",test:["лок"],mods:["--ка","--ку",".","--кос","--ке"]},{gender:"androgynous",test:["ки"],mods:["-ов","-ам",".","-ами","-ах"]},{gender:"androgynous",test:["щи"],mods:["-ев","-ам",".","-ами","-ах"]},{gender:"androgynous",test:["е","ё","и","о","у","ы","э","ю"],mods:[".",".",".",".","."]},{gender:"male",test:["уа","иа"],mods:[".",".",".",".","."]},{gender:"female",test:["б","в","г","д","ж","з","й","к","л","м","н","п","р","с","т","ф","х","ц","ч","ш","щ","ъ","иа","ль"],mods:[".",".",".",".","."]},{gender:"female",test:["ь"],mods:["-и","-и",".","ю","-и"]},{gender:"male",test:["ь"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"androgynous",test:["га","ка","ха","ча","ща","жа"],mods:["-и","-е","-у","-ой","-е"]},{gender:"female",test:["ша"],mods:["-и","-е","-у","-ей","-е"]},{gender:"male",test:["ша","ча","жа"],mods:["-и","-е","-у","-ей","-е"]},{gender:"androgynous",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"female",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"female",test:["ка","га","ха"],mods:["-и","-е","-у","-ой","-е"]},{gender:"female",test:["ца"],mods:["-ы","-е","-у","-ей","-е"]},{gender:"female",test:["а"],mods:["-ы","-е","-у","-ой","-е"]},{gender:"female",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["ия"],mods:["-и","-и","-ю","-ей","-и"]},{gender:"male",test:["я"],mods:["-и","-е","-ю","-ей","-е"]},{gender:"male",test:["ий"],mods:["-я","-ю","-я","-ем","-и"]},{gender:"male",test:["ый","кий","хий"],mods:["--ого","--ому","--ого","-м","--ом"]},{gender:"male",test:["ей","й"],mods:["-я","-ю","-я","-ем","-е"]},{gender:"male",test:["ш","ж"],mods:["а","у","а","ем","е"]},{gender:"male",test:["ёл"],mods:["--ла","--лу","--ла","--лом","--ле"]},{gender:"male",test:["ёк"],mods:["--ька","--ьку","--ька","--ьком","--ьке"]},{gender:"male",test:["б","в","г","д","ж","з","к","л","м","н","п","р","с","т","ф","х","ц","ч"],mods:["а","у","а","ом","е"]},{gender:"androgynous",test:["ния","рия","вия"],mods:["-и","-и","-ю","-ем","-ем"]}]};u(T),u(N),u(M);var D=["форт-шевченко"],R=["-"," ","в","на","баден","бледно","буэнос","вице","гаврилов","йошкар","коста","лос","норд","нью","орехово","принс","сан","санкт","санта","северо","ситтард","темно","улан","усолье","усть","форт","царь","экс","юго","юрьев"],W=["село","поселок","аул","город","деревня","урочище"],$={exceptions:[{test:["сочи","тбилиси"],mods:["","","","",""]},{test:["село","озеро","место"],mods:["-а","-у","","м","-е"]},{test:["область"],mods:["-и","-и","","ю","-и"]},{test:["деревня"],mods:["-и","-е","-ю","-ей","-е"]},{test:["море"],mods:["-я","-ю","","м",""]},{test:["холм"],mods:["а","у","","ом","е"]}],suffixes:[{test:["чёк","чек"],mods:["--ка","--ку","","--ком","--ке"]},{test:["чик"],mods:["а","у","","ом","е"]},{test:["жний","хний","шний","щий"],mods:["--его","--ему","","-м","--ем"]},{test:["ще"],mods:["-а","-у","","м",""]},{test:["чье"],mods:["-я","-ю","","м",""]},{test:["ель"],mods:["-я","-ю","","-ем","-е"]},{test:["чь"],mods:["-и","-и","","ю","-и"]},{test:["чи"],mods:["-ей","-ам","","-ами","-ах"]},{test:["ые","ие"],mods:["-х","-м","","-ми","-х"]},{test:["ый","ий","ое"],mods:["--ого","--ому","","-м","--ом"]},{test:["ая"],mods:["--ой","--ой","--ую","--ой","--ой"]},{test:["гиев"],mods:["а","у","","ым","ом"]},{test:["ны"],mods:["-ов","-ам","","-ами","-ах"]},{test:["ша"],mods:["-и","-е","-у","-ей","-е"]},{test:["ры","цы","ды","ги"],mods:["-","-ам","","-ами","-ах"]},{test:["амень"],mods:["---ня","---ню","","---нем","---не"]},{test:["ьн","нц","мм"],mods:["а","у","","ом","е"]}]},U={exceptions:$.exceptions.map(function(e){return x({gender:O},e)}),suffixes:$.suffixes.map(function(e){return x({gender:O},e)})};u(U),e.incline=function(e,r){var n={};return n.gender||(n.gender=a(e)),e.first&&(n.first=y(e.first.trim(),r,n.gender)),e.last&&(n.last=b(e.last.trim(),r,n.gender)),e.middle&&(n.last=S(e.middle.trim(),r,n.gender)),n},e.inclineFirstname=y,e.inclineLastname=b,e.inclineMiddlename=S,e.getGender=a,e.getFirstnameGender=function(e){return l(n(e))},e.getLastnameGender=function(e){return l(t(e))},e.getMiddlenameGender=function(e){return l(s(e))},e.cityIn=function(e,r){return P(e,D)?e:e.split(/(\s|-)/g).map(function(e,n,t){if(I(e,n,t))return e;var s=m(e,O,U);return s?v(s,e,A):y(e,A,r)||e}).join("")},e.cityFrom=function(e,r){return P(e,D)?e:e.split(/(\s|-)/g).map(function(e,n,t){if(I(e,n,t))return e;var s=m(e,O,U);return s?v(s,e,_):y(e,_,r)||e}).join("")},e.cityTo=function(e){return e?e.split(/(\s|-)/g).map(function(e,n,t){if(I(e,n,t))return e;var s=e.toLowerCase();return r(s,"а")?h(e,"-у"):r(s,"ая")?h(e,"--ую"):r(s,"ия")?h(e,"--ию"):r(s,"я")?h(e,"-ю"):e}).join(""):e},Object.defineProperty(e,"__esModule",{value:!0})})},{}],2:[function(e,r,n){"use strict";function t(e,r){function n(){p.locked||(p.service.active=!p.service.active,p.service.active||r.removeExtraService({code:"aeroexpress"}))}function t(){p.extraPassengers.push({}),p.optionsByExtraPassengers.push(o()),p.availableDocumentsByExtraPassengers.push([])}function s(e){p.extraPassengers.splice(e,1),p.optionsByExtraPassengers.splice(e,1),p.availableDocumentsByExtraPassengers.splice(e,1)}function o(e){return p.service.items.map(function(r){var n=angular.copy(r);return e&&(n.firstName=e.firstName,n.lastName=e.lastName,n.dateOfBirth=e.dateOfBirth,n.documentType=e.documentType,n.documentNumber=e.documentNumber),n.selected=f(n,p.orderInfo),n.issued=d(n,p.orderInfo),n.selected?n.selectedDate=m(n,p.orderInfo):n.selectedDate=n.dates[0],n.issued&&(n.issuedDate=u(n,p.orderInfo)),n})}function a(e,r){var n=_.findWhere(p.service.documents,{code:r?p.extraPassengers[e].aeroexpressDocumentType:p.orderInfo.passengers[e].aeroexpressDocumentType});p[r?"documentPatternsListByExtraPassengers":"documentPatternsListByPassengers"][e]=n.regexps}function i(e){var n=p.extraPassengers[e].dateOfBirth;return r.getAvailableDocumentsForAeroexpress({birthDate:n,departureDate:p.service.items[0].dates[0]}).then(function(r){p.availableDocumentsByExtraPassengers[e]=r.documents})}function c(e,r){var n=!0;return e&&r.forEach(function(r){e[r]||(n=!1)}),n}function d(e,r){var n=_.findWhere(r.all_extra_services,{code:"aeroexpress"});return n&&n.items&&n.items.length?!!_.findWhere(n.items,{departure_code:e.departure_code,arrival_code:e.arrival_code,firstName:e.firstName,lastName:e.lastName,status:"ISSUED"}):!1}function l(e){var r=_.findWhere(p.orderInfo.all_extra_services,{code:"aeroexpress"});if(r){var n=_.findWhere(r.items,{firstName:e.firstName,lastName:e.lastName});return!!n}}function u(e,r){var n=_.findWhere(r.all_extra_services,{code:"aeroexpress"});return n&&n.items&&n.items.length?_.findWhere(n.items,{departure_code:e.departure_code,arrival_code:e.arrival_code,firstName:e.firstName,lastName:e.lastName,status:"ISSUED"}).departure_date:void 0}function f(e,r){var n=_.findWhere(r.editable_extra_services,{code:"aeroexpress"});return n&&n.items&&n.items.length?!!_.findWhere(n.items,{departure_code:e.departure_code,arrival_code:e.arrival_code,firstName:e.firstName,lastName:e.lastName}):!1}function m(e,r){var n=_.findWhere(r.editable_extra_services,{code:"aeroexpress"});return n&&n.items&&n.items.length?_.findWhere(n.items,{departure_code:e.departure_code,arrival_code:e.arrival_code,firstName:e.firstName,lastName:e.lastName}).departure_date:void 0}function g(e){var n,t,s=moment(p.extraPassengers[e].dateOfBirth,"DD.MM.YYYY");for(n=0;n<p.optionsByExtraPassengers[e].length;n++)for(t=0;t<p.optionsByExtraPassengers[e][n].dates.length;t++)if(moment(p.optionsByExtraPassengers[e][n].dates[t],"DD.MM.YYYY").subtract(r.getParam("extraServices.aeMinChildAge"),"years").isAfter(s))return!1;return!0}var p=this;p.switchService=n,p.addExtraPassenger=t,p.removeExtraPassenger=s,p.documentTypeChangeHandler=a,p.extraPassengerDateOfBirthChangeHandler=i,p.isExtraPassengerFreeForAllDates=g,p.isIssued=l,p.availableDocumentsByExtraPassengers=[],r.ready.then(function(){p.todayDate=r.sessionParams.todayDate}),r.addOrderInfoListener(function(n){p.orderInfo=n,n&&(n.passengers&&(p.orderInfo.passengers.forEach(function(e){var r,t=_.findWhere(n.all_extra_services,{code:"aeroexpress"});_.findWhere(p.service.documents,{code:e.documentCode})&&(e.aeroexpressDocumentType=e.documentCode,e.aeroexpressDocumentNumber=e.documentNumber),t&&t.items&&t.items.length&&(r=_.findWhere(t.items,{firstName:e.firstName,lastName:e.lastName}),r&&(e.aeroexpressDocumentType=r.documentType,e.aeroexpressDocumentNumber=r.documentNumber))}),p.optionsByPassengers=p.orderInfo.passengers.map(function(e,r){return p.service.items.map(function(t){var s=angular.copy(t);return s.firstName=e.firstName,s.lastName=e.lastName,s.dateOfBirth=e.dateOfBirth,s.documentType=e.documentCode,s.documentNumber=e.documentNumber,s.free=c(p.service.passengersFree[r],s.dates),s.dates=s.dates.filter(function(e){return!p.service.passengersFree[r][e]}),s.selected=f(s,n),s.issued=d(s,n),s.selected?s.selectedDate=m(s,n):s.selectedDate=s.dates[0],s.issued&&(s.issuedDate=u(s,n)),s})}),p.documentPatternsListByPassengers=p.orderInfo.passengers.map(function(e){return e.aeroexpressDocumentType?_.findWhere(p.service.documents,{code:e.aeroexpressDocumentType}).regexps:[]}),e.all(n.passengers.map(function(e){return r.getAvailableDocumentsForAeroexpress({birthDate:e.dateOfBirth,departureDate:p.service.items[0].dates[0]})})).then(function(e){p.availableDocumentsByOrderPassengers=e.map(function(e){return e.documents})})),n.extraPassengers&&(p.extraPassengers=angular.copy(n.extraPassengers),p.optionsByExtraPassengers=p.extraPassengers.map(o),p.documentPatternsListByExtraPassengers=p.extraPassengers.map(function(){return[]})))},!1,!0)}angular.module("wes").component("nwAeroexpress",{templateUrl:"components/nw-aeroexpress/nw-aeroexpress.html",controller:["$q","backend",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],3:[function(e,r,n){"use strict";function t(e,r,n){function t(){o&&(o(!0),close())}var s=this,o=!1;s.isSingleItemInInsurance=!1,s.close=close,s.submit=t,s.popupId="#nw-"+s.esCode+"-popup",n.setOpenListener("nw-"+s.esCode+"-popup",function(e,r){var n=angular.element(s.popupId),t=n.parents(".fancybox-wrap");t.hasClass("extra-service__popup")||t.addClass("extra-service__popup")})}angular.module("app").component("nwEsPopup",{templateUrl:"components/nw-es-popup/nw-es-popup.html",controller:"nwMealPopupController",bindToController:!0,controllerAs:"vm",bindings:{locked:"=",esCode:"<",es:"="},transclude:{"extra-service":"wrap"}}),angular.module("app").controller("nwMealPopupController",["$scope","backend","fancyboxTools",t])},{}],4:[function(e,r,n){"use strict";function t(e,r){function n(){s.locked||(o.active=!o.active,o.active?1===o.items.length&&r.modifyExtraService(t(o.items[0])):r.removeExtraService({code:o.onlineMode?"insuranceOnline":"insurance"}))}function t(e,r){var n={code:"insurance",ins:e.ins,tins:e.tins};return r&&(n.passenger_id=r),o.onlineMode&&(n.code="insuranceOnline",n.productCode=e.productCode),n}var s=this;s.isCommonService=e.isCommonServiceCode,s.switchInsurance=n,s.orderInfo=r.getOrderInfo();var o=_.findWhere(s.es,{code:"insurance"});s.isSingleItemInInsurance=o&&1===o.items.length}var s=angular.module("app");s.component("nwExtraServicesList",{templateUrl:"components/nw-extra-services-list/nw-extra-services-list.html",controller:"extraServicesListController",controllerAs:"vm",bindings:{es:"=es",list:"=list",availableBundlesByPassengerSegments:"<",locked:"=locked"}}),s.controller("extraServicesListController",["utils","backend",t])},{}],5:[function(e,r,n){"use strict";function t(e){function r(){a.locked||(a.service.active=!a.service.active,a.service.active?1===a.service.items.length&&e.modifyExtraService(t(a.service.items[0])):e.removeExtraService({code:a.service.onlineMode?"insuranceOnline":"insurance"}))}function n(r,n){a.locked||("common"===n?e[a.service.items[r].selected?"modifyExtraService":"removeExtraService"](t(a.service.items[r])):e[a.service.itemsByPassengers[n][r].selected?"modifyExtraService":"removeExtraService"](t(a.service.itemsByPassengers[n][r],a.orderInfo.passengers[n].id)))}function t(e,r){var n={code:"insurance",ins:e.ins,tins:e.tins};return r&&(n.passenger_id=r),a.service.onlineMode&&(n.code="insuranceOnline",n.productCode=e.productCode),n}function s(){a.selectedFlight=o(),console.log(a.selectedFlight)}function o(){var e;for(e=0;e<a.orderInfo.plainFlights.length;e++)if(console.log(a.service),a.service.availableBySegments[e])return e;return-1}var a=this;a.switchService=r,a.switchServiceItem=n,a.selectFirstAvailablePassengerFlight=s,a.selectedFlight=null,a.orderInfo=e.getOrderInfo()}angular.module("wes").component("nwInsurance",{templateUrl:"components/nw-insurance/nw-insurance.html",controller:["backend",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],6:[function(e,r,n){"use strict";function t(e,r,n,t){function s(){v.locked||n.checkServiceRemovalProhibited("meal")||(v.service.active=!v.service.active,v.service.active?a():n.removeExtraService({code:"meal"}),v.closePopup())}function o(e,r){v.selectedFlight=e,v.selectedPassenger=r,i()}function a(){v.selectedFlight=g(),v.selectedPassenger=p(v.selectedFlight),i()}function i(){v.mealMenu=v.service.itemsByPassengerSegments[v.selectedPassenger][v.selectedFlight],v.mealMenuSubgroup=!1}function c(e,r,t){v.locked||n.modifyExtraService({code:"meal",passenger_id:v.orderInfo.passengers[v.selectedPassenger].id,segment_id:v.orderInfo.plainFlights[v.selectedFlight].id,subgroup:v.service.subgroups[e],amount:(r.alreadySelectedCount||0)+t,rfisc:r.rfisc})}function d(e,r){v.locked||n.checkServiceRemovalProhibited("meal",e,r)||n.removeExtraService({code:"meal",passenger_id:v.orderInfo.passengers[e].id,segment_id:v.orderInfo.plainFlights[r].id})}function l(e,r){var n,t=0,s=0;return v.orderInfo.groupedEditableExtraServices&&v.orderInfo.groupedEditableExtraServices.meal&&v.orderInfo.groupedEditableExtraServices.meal[e]&&v.orderInfo.groupedEditableExtraServices.meal[e][r]&&v.orderInfo.groupedEditableExtraServices.meal[e][r].length&&v.orderInfo.groupedEditableExtraServices.meal[e][r].forEach(function(e){e.amount&&(t+=e.amount),e.totalPrice&&(s=Big(s).plus(e.totalPrice).toFixed(2),n=e.currency)}),t?{count:t,cost:s,currency:n}:!1}function u(){h.scrollTo(0)}function f(){h.scrollTo(h[0].scrollWidth)}function m(){var r=h[0].scrollLeft,n=h[0].scrollWidth,t=h[0].clientWidth,s=n-t-r;v.canScrollRight=0!==s,v.canScrollLeft=0!==r,e.$apply()}function g(){var e;for(e=0;e<v.orderInfo.plainFlights.length;e++)if(v.service.availableBySegments[e])return e;return-1}function p(e){var r;if(v.service.availableByPassengerSegments)for(r=0;r<v.orderInfo.passengers.length;r++)if(v.service.availableByPassengerSegments[r][e])return r;return-1}var v=this,h=r.find("div.passengersTableContainer");v.switchService=s,v.selectFlightPassenger=o,v.selectFirstAvailablePassengerFlight=a,v.mealCountChangeHandler=c,v.removePassengerFlightMeal=d,v.getSelectedPassengerFlightMeal=l,v.scrollToStart=u,v.scrollToEnd=f,v.hasAlias=n.hasAlias,v.getAvailablePassengersCount=t.getAvailablePassengersCount,v.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,v.closePopup=v.closePopup(),v.canScrollRight=!0,v.canScrollLeft=!1,v.selectedFlight=0,v.selectedPassenger=0,n.getParam("site.externalStorageBaseUrl")?v.mealImagesPath=n.getParam("site.externalStorageBaseUrl")+"/img/content/meal":v.mealImagesPath="./themes/websky/assets/static/img/content/meal",n.addOrderInfoListener(function(e){v.orderInfo=e},!1,!0),e.$watch("vm.service",function(){i()}),h.on("scroll",m),v.service.active&&i()}var s=angular.module("app");s.component("nwMeal",{templateUrl:"components/nw-meal/nw-meal.html",controller:["$scope","$element","backend","utils",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked",closePopup:"&"}})},{}],7:[function(e,r,n){"use strict";function t(e,r){function n(){r.openHandler("nw-aeroexpress-popup")}var t=this;t.close=n,r.setOpenListener("popupAeroexpressSchedule",function(r){var s=r.attr("data-date"),o=r.attr("data-arrival-code"),a=r.attr("data-departure-code");t.loading=!0,$(".fancybox-overlay").on("click",n),e.aeroexpressSchedule({date:s,arrival:o,departure:a}).then(function(e){t.loading=!1,t.arrival=r.attr("data-arrival"),t.departure=r.attr("data-departure"),t.schedule=e.schedule},function(){t.loading=!1})})}angular.module("app").component("nwPopupAeroexpressSchedule",{templateUrl:"components/nw-popup-aeroexpress-schedule/nw-popup-aeroexpress-schedule.html",controller:["backend","fancyboxTools",t],controllerAs:"vm"})},{}],8:[function(e,r,n){"use strict";function t(e,r,n,t,s,o){function a(){b.locked||s.checkServiceRemovalProhibited("seat")||(b.service.active=!b.service.active,b.service.active?l():(b.modifyError=!1,s.removeExtraService({code:"seat"}).then(i,function(e){e.error&&(b.modifyError=e.error)}))),b.closePopup()}function i(){b.seatMap=!1,b.selectedFlight=-1,b.selectedPassenger=-1}function c(e){x=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function d(e,r){c(b.selectedFlight!==e),b.selectedFlight=e,b.selectedPassenger=r,u()}function l(){b.selectedFlight=0,b.selectedPassenger=0,u()}function u(){-1!==b.selectedPassenger&&-1!==b.selectedFlight&&(b.loadingSeatMap=!0,b.seatMapError=!1,s.seatMap(b.orderInfo.passengers[b.selectedPassenger].id,b.orderInfo.plainFlights[b.selectedFlight].id).then(function(e){b.seatMap=e,b.loadingSeatMap=!1,n(function(){jQuery("#seatMapCont .mCSB_container").css("top",x)})},function(e){b.seatMapError=e.error,b.loadingSeatMap=!1}))}function f(e,r,n){b.locked||e.available&&r&&(c(),b.modifyError=!1,s.modifyExtraService({code:"seat",passenger_id:b.orderInfo.passengers[b.selectedPassenger].id,segment_id:b.orderInfo.plainFlights[b.selectedFlight].id,value:n+e.number,subgroup:b.service.commonSubgroup,rfisc:e.rfisc||""}).then(u,function(e){e.error&&(b.modifyError=e.error)}))}function m(){b.sunInfoByFlights=[],b.orderInfo.plainFlights.forEach(function(e,r){s.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){b.sunInfoByFlights[r]=e})})}function g(){S.scrollTo(0)}function p(){S.scrollTo(S[0].scrollWidth)}function v(){var r=S[0].scrollLeft,n=S[0].scrollWidth,t=S[0].clientWidth,s=n-t-r;b.canScrollRight=0!==s,b.canScrollLeft=0!==r,e.$apply()}function h(e){var r=o.getAvailablePassengersCount(e);return r+b.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function y(e,r){b.locked||s.checkServiceRemovalProhibited("seat",e,r)||(b.modifyError=!1,s.removeExtraService({code:"seat",passenger_id:b.orderInfo.passengers[e].id,segment_id:b.orderInfo.plainFlights[r].id}).then(function(){b.selectedFlight===r&&u()},function(e){e.error&&(b.modifyError=e.error)}))}var b=this,S=r.find("div.passengersTableContainer"),x="0px";
b.switchService=a,b.selectFlightPassenger=d,b.selectFirstAvailablePassengerFlight=l,b.setPassengerFlightSeat=f,b.closePopup=b.closePopup(),b.hasAlias=s.hasAlias,b.scrollToStart=g,b.scrollToEnd=p,b.getAvailablePassengersCount=o.getAvailablePassengersCount,b.getAvailablePassengersCountWrap=h,b.removePassengerFlightSeat=y,b.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,b.canScrollRight=!0,b.canScrollLeft=!1,b.isBookingScreen=t.isBookingScreen(),s.addOrderInfoListener(function(e){b.orderInfo=e},!1,!0),m(),S.on("scroll",v),b.service.active=!0,b.service.active&&l()}angular.module("app").component("nwSeat",{templateUrl:"components/nw-seat/nw-seat.html",controller:["$scope","$element","$timeout","redirect","backend","utils",t],controllerAs:"vm",bindings:{service:"=service",locked:"=locked",closePopup:"&"}})},{}],9:[function(e,r,n){"use strict";function t(e,r,n,t,s,o,a,i){function c(e){f.loading=!0,t.retryRegister(e).then(function(e){e.pnr&&e.lastName?r.location="./order?pnr="+e.pnr+"&lastName="+e.lastName:(e.eraseAeroexpressBecauseOfCurrency||e.eraseInsuranceBecauseOfCurrency)&&a.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:e.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:e.eraseInsuranceBecauseOfCurrency,mode:"retryRegister",submitCallback:c}),f.loading=!1},function(e){f.loading=!1,f.errorMessage=e.error})}function d(){f.orderInfo.header&&f.orderInfo.header.regnum&&f.orderInfo.header.lastName&&(f.loading=!0,t.bindOrder(f.orderInfo.header.regnum,f.orderInfo.header.lastName).then(function(){f.loading=!1,f.orderInfo.bindAlowed=!1,f.showBindOrderSuccessMessage=!0,n(function(){f.showBindOrderSuccessMessage=!1},1e4)},function(){f.loading=!1,f.showBindOrderFailMessage=!0,n(function(){f.showBindOrderFailMessage=!1},1e4)}))}function l(){t.clearSession().then(function(){o.goToSearchOrder()})}function u(){t.clearLastSearchParams().then(function(){r.location=t.getAlias("web.site.firstStepUrl")})}var f=this;f.loading=!0,f.errorMessage=!1,f.choosePayMethodFailMsg=!1,f.tabId=i(),f.openExchange=o.goToExchange,f.openRefund=o.goToRefund,f.openAddServices=o.goToAddServices,f.suffixCount=s.suffixCount,f.retryPayment=c,f.bindOrder=d,f.clearSession=l,f.newBooking=u,e.$on("popupChoosePayMethodChoosePayMethodFailMsg",function(e,r){f.choosePayMethodFailMsg=r}),e.$on("popupChoosePayMethodPending",function(e,r){f.popupChoosePayMethodPending=r}),f.$onInit=function(){var e=s.getParamFromLocation("result");"success"===e?!f.orderInfo.header||"being_paid"!==f.orderInfo.header.status&&"being_paid_for_exchange"!==f.orderInfo.header.status?f.loading=!1:t.waitPayment(f.orderInfo.header.regnum,f.orderInfo.header.lastName).then(function(){r.location="./order?pnr="+f.orderInfo.header.regnum+"&lastName="+f.orderInfo.header.lastName+"&result=success"},function(){f.loading=!1}):(!f.orderInfo.hasFailedServices&&f.orderInfo.paymentRedirectTo&&(f.showPaymentFrame=!0),f.loading=!1),!f.orderInfo.hasFailedServices||e||!f.orderInfo.header||"being_paid"!==f.orderInfo.header.status&&"booked"!==f.orderInfo.header.status||n(function(){a.openHandler("popupRemovedServicesWarningByOrder",!1,{submitCallback:function(){f.orderInfo.paymentRedirectTo&&(f.showPaymentFrame=!0),f.ignoreFailedServices=!0},disableOutsideCloseClick:!0})}),t.getParam("ffp.enable")&&(f.orderInfo.hasBonusCard||f.orderInfo.ffpSumm)&&t.ffpBonus().then(function(e){f.ffpBonus=e.total||0})}}var s=angular.module("app");s.component("orderWithEs",{templateUrl:"components/order-with-es/order-with-es.html",controller:"orderWithEsController",controllerAs:"vm",transclude:{"extra-services":"nwExtraServicesList",payment:"div"},bindings:{orderInfo:"="}}),s.controller("orderWithEsController",["$scope","$window","$timeout","backend","utils","redirect","fancyboxTools","uniqueTabIdGenerator",t])},{}],10:[function(e,r,n){"use strict";function t(e,r,n){function t(e){e&&_.forEach(e,function(e){_.forEach(e.flights,function(e){var n=e.originport?e.originport:e.origincity,t=e.destinationport?e.destinationport:e.destinationcity,s=!1;_.forEach(u.redefineRules,function(o){_.forEach(o.routes,function(a){if(n===a.from&&t===a.to||a.from===t&&a.to===n){console.log("we redefine some rules here, check the replacWith directive"),s=!0;var i={brand:e.brand,brandAvailableProps:e.brandAvailableProps,brandUnavailableProps:e.brandUnavailableProps,brandPaidProps:e.brandPaidProps},c=r.getBrandConfig();c.filter(function(e){return e.code===i.brand})[0];_.forEach(o.brands,function(r){if(i.brand===r.brand){_.forEach(r.props,function(r){switch(r.available){case"yes":e.brandAvailableProps.push(r.name);break;case"no":e.brandUnavailableProps.push(r.name);break;case"paid":e.brandPaidProps.push(r.name)}})}})}})})})})}function s(e){u.needToRestoreBrandsInfo=!1,e&&"boolean"==typeof u.originalBrands&&(u.originalBrands=angular.copy(r.getBrandConfig()));var n=!1;o(e)&&(n=!0),n?a(e.brandsList):"boolean"!=typeof u.originalBrands&&e.brandsList&&(e.brandsList=e.brandsList.map(function(e,r){return u.originalBrands.filter(function(r){return r.code===e.code})[0]}),u.needToRestoreBrandsInfo=!0)}function o(e){var r=!1;return _.forEach(u.redefineRules,function(n){_.forEach(n.routes,function(n){_.forEach(e.segmentRows,function(e){_.forEach(e,function(e){var t=e.flightsInfo.originport?e.flightsInfo.originport:e.flightsInfo.origincity,s=e.flightsInfo.destinationport?e.flightsInfo.destinationport:e.flightsInfo.destinationcity;(t===n.from&&s===n.to||t===n.to&&s===n.from)&&(r=!0)})})})}),r}function a(e){_.forEach(u.redefineRules,function(r){_.forEach(r.brands,function(r){_.forEach(e.slice(),function(e){e.code===r.brand&&i(e,r)})})})}function i(e,r){console.log("we redefine some rules here, head to web.brandConfig.redefine"),console.log(e,r),_.forEach(e.props,function(e){r.props[e.code]&&_.extend(e,r.props[e.code])})}function c(){u.selectedVariantsInfo&&u.needToRestoreBrandsInfo&&(console.log("restoreBrandsInfo"),_.forEach(u.selectedVariantsInfo,d))}function d(e){var r=l(e.brand),n=[],t=[],s=[];_.forEach(r.props,function(e){switch(e.available){case"yes":e.shortDesc?n.push(e.shortDesc):n.push(e.name);break;case"paid":t.push(e.name);break;case"no":s.push(e.name);break;default:return}}),e.brandAvailableProps=n.slice(),e.brandPaidProps=t.slice(),e.brandUnavailableProps=s.slice()}function l(e){return u.originalBrands.filter(function(r){return r.code===e})[0]}var u=e.$parent.vm;u.originalBrands=!1,u.needToRestoreBrandsInfo=!1,r.ready.then(function(){try{var o=JSON.parse(r.getAlias("web.brandConfig.redefine"))}catch(a){console.error("redefine rules parse error",a)}u.redefineRules=o,e.$watch(angular.bind(this,function(){return u.selectedVariantsInfo}),c),e.$watch(angular.bind(this,function(){return u.searchResult}),function(e){"/search-order"!==n.path()&&s(e)}),e.$watch(angular.bind(this,function(){return u.orderInfo?u.orderInfo.flights:void 0}),function(e){t(e)})})}var s=angular.module("app");s.directive("replaceWith",function(){return{scope:!1,controllerAs:"replaceWith",bindToController:!0,scopeAs:"vm",controller:"isRouteController"}}),s.controller("isRouteController",["$scope","backend","$location",t])},{}],11:[function(e,r,n){"use strict";var t=e("lvovich/dist/lvovich.min");angular.module("app").filter("toCity",function(){return function(e){return"в "+t.cityTo(e)}})},{"lvovich/dist/lvovich.min":1}],12:[function(e,r,n){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),e("./directives/replaceWith"),e("./components/nw-es-popup/nw-es-popup"),e("./components/order-with-es/order-with-es"),e("./components/nw-extra-services-list/nw-extra-services-list"),e("./components/nw-meal/nw-meal"),e("./components/nw-seat/nw-seat"),e("./components/nw-insurance/nw-insurance"),e("./components/nw-aeroexpress/nw-aeroexpress"),e("./components/nw-popup-aeroexpress-schedule/nwPopupAeroexpressSchedule"),e("./filters/toCity"),angular.module("app").config(["$compileProvider",function(e){e.debugInfoEnabled(!0)}]),angular.module("app").run(["$rootScope","redirect","backend",function(e,r,n){e.$on("$locationChangeStart",function(e){var n=location.href.split("#")[1];n=n.split("/");var t=n[1],s=n[2],o=n[3];"add-services"===t&&s&&o&&(o=decodeURIComponent(o),r.goToSearchOrder(s,o))})}])},{"./components/nw-aeroexpress/nw-aeroexpress":2,"./components/nw-es-popup/nw-es-popup":3,"./components/nw-extra-services-list/nw-extra-services-list":4,"./components/nw-insurance/nw-insurance":5,"./components/nw-meal/nw-meal":6,"./components/nw-popup-aeroexpress-schedule/nwPopupAeroexpressSchedule":7,"./components/nw-seat/nw-seat":8,"./components/order-with-es/order-with-es":9,"./directives/replaceWith":10,"./filters/toCity":11,"./screens/add-services/AddServicesScreenController":13,"./screens/search-order/search-order":14}],13:[function(e,r,n){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,n,t,s,o,a){function i(e){!m.agree||m.modifyServicesLoading||m.orderServicesLoading||(m.selectedPaymentForm&&m.selectedPaymentType?c(e):m.showNeedSelectPaymentFormMesage=!0)}function c(e,r,n){m.confirmLoading=!0,m.confirmError&&delete m.confirmError,s.startPaymentForExtraServices(m.selectedPaymentForm,m.selectedPaymentType,e,r,n,m.card).then(function(o){o.pnr&&o.lastName?t.goToConfirmOrder():o.eraseAeroexpressBecauseOfCurrency||o.eraseInsuranceBecauseOfCurrency?a.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:o.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:o.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:i}):o.removedSvcs&&o.removedSvcs.length&&a.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){c(e,r,n)},closeCallback:function(){s.updateOrderServices(!0)},removedSvcs:o.removedSvcs,svcsToIssue:o.svcsToIssue,noExtraServicesLeft:o.noExtraServicesLeft,disableOutsideCloseClick:!0}),m.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?m.fatalError=e.error:m.confirmError=e.error,m.confirmLoading=!1})}function d(){m.showNeedSelectPaymentFormMesage=!1}function l(){return n.location.reload(),!1}function u(){s.clearSession().then(function(){t.goToSearchOrder()})}function f(){m.submitButtonHover=!m.submitButtonHover}var m=this;m.loading=!0,m.searchOrderLoading=!0,m.orderServicesLoading=!0,m.openOrder=t.goToSearchOrder,m.submitPayment=i,m.paymentFormChangeHandler=d,m.reloadPage=l,m.clearSession=u,m.swithcSubmitButtonHoverState=f,e.$on("plasticCardForPaymentChangeEvent",function(e,r){m.card=r}),s.ready.then(function(){angular.element("title").text(s.getAliasWithPrefix("web.pageTitle.","addServices")),m.loading=!1,s.clearOrderInfoListeners(),s.clearUpdateOrderServicesListeners(),s.addOrderInfoListener(function(e){m.orderInfo=e}),s.addUpdateOrderServicesListener(function(e){m.orderInfo=e[1],m.priceVariant=e[2],m.isFreePricevariant=o.isFreePricevariant(e[2]),m.isFreePricevariant&&(m.showNeedSelectPaymentFormMesage=!1),m.es=o.reformatAvailableExtraServices(e[0],m.orderInfo,m.es),m.esList=o.getAvailableExtraServicesList(e[0],m.es),m.searchOrderLoading=!1,m.orderServicesLoading=!1,s.getParam("ffp.enable")&&(m.orderInfo.hasBonusCard||m.orderInfo.ffpSumm)&&s.ffpBonus().then(function(e){m.ffpBonus=e.total||0})},function(e){m.searchOrderLoading=!1,m.orderServicesLoading=!1,m.errorMessage=e.error}),s.updateOrderServices(!0).then(function(){m.loading=!0,s.switchDefaultSelectedServices(m.esList,m.es,m.orderInfo).then(function(){m.loading=!1},function(e){m.errorMessage=e.error,m.loading=!1})}),s.addExtraServiceListener(function(e){m.modifyServicesLoading=!e,m.orderServicesLoading=!0}),s.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(m.modifyServicesError=e.error),m.modifyServicesLoading=!1,m.orderServicesLoading=!0})})}])},{}],14:[function(e,r,n){"use strict";function t(e,r,n,t,s,o,a){function i(e){!h.agree||h.modifyServicesLoading||h.orderServicesLoading||(h.selectedPaymentForm&&h.selectedPaymentType?c(e):h.showNeedSelectPaymentFormMesage=!0)}function c(e,r,s){h.confirmLoading=!0,h.confirmError&&delete h.confirmError,n.startPaymentForExtraServices(h.selectedPaymentForm,h.selectedPaymentType,e,r,s,h.card).then(function(o){o.pnr&&o.lastName?t.goToConfirmOrder():o.eraseAeroexpressBecauseOfCurrency||o.eraseInsuranceBecauseOfCurrency?a.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:o.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:o.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:i}):o.removedSvcs&&o.removedSvcs.length&&a.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){c(e,r,s)},closeCallback:function(){n.updateOrderServices(!0)},removedSvcs:o.removedSvcs,svcsToIssue:o.svcsToIssue,noExtraServicesLeft:o.noExtraServicesLeft,disableOutsideCloseClick:!0}),h.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?h.fatalError=e.error:h.confirmError=e.error,h.confirmLoading=!1})}function d(){n.clearSession(),n.clearOrderInfo(),h.orderInfo=!1,h.showSearchForm=!0,h.partiallyAddedPassengers=[]}function l(){h.submitTouched=!0,n.getParam("site.useSearchOrderAgreeCheckbox")&&!h.searchOrderAgree||!h.searchOrderForm.$valid||(h.searchLoading=!0,h.errorMessage=!1,n.searchOrderByParams(h.searchParams,!!h.partiallyAddedPassengers.length).then(function(e){h.searchParams.flight&&h.searchParams.date?h.searchParams={flight:h.searchParams.flight,date:h.searchParams.date}:e.needToSpecifyDocument||(h.searchParams={}),h.needToSpecifyDocument=e.needToSpecifyDocument,h.showSearchForm=!1,h.submitTouched=!1,u(),e.orderCompletelyInitialized?(h.partiallyAddedPassengers=[],f()):(e.partiallyAddedPassengers&&(h.partiallyAddedPassengers=e.partiallyAddedPassengers),h.needToSpecifyDocument&&(h.showSearchForm=!0)),h.searchLoading=!1},m))}function u(){n.addUpdateOrderServicesListener(function(e){h.orderInfo=e[1],h.priceVariant=e[2],h.isFreePricevariant=o.isFreePricevariant(e[2]),h.isFreePricevariant&&(h.showNeedSelectPaymentFormMesage=!1),h.es=o.reformatAvailableExtraServices(e[0],h.orderInfo,h.es),h.esList=o.getAvailableExtraServicesList(e[0],h.es),h.searchOrderLoading=!1,h.orderServicesLoading=!1,n.getParam("ffp.enable")&&(h.orderInfo.hasBonusCard||h.orderInfo.ffpSumm)&&n.ffpBonus().then(function(e){h.ffpBonus=e.total||0})},function(e){h.searchOrderLoading=!1,h.orderServicesLoading=!1,h.errorMessage=e.error}),n.updateOrderServices(!0).then(function(){h.loading=!0,n.switchDefaultSelectedServices(h.esList,h.es,h.orderInfo).then(function(){h.loading=!1},function(e){h.errorMessage=e.error,h.loading=!1})}),n.addExtraServiceListener(function(e){h.modifyServicesLoading=!e,h.orderServicesLoading=!0}),n.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(h.modifyServicesError=e.error),h.modifyServicesLoading=!1,h.orderServicesLoading=!0})}function f(e){n.updateOrderInfo().then(function(r){r.passengers&&(h.orderInfo=r,h.showSearchForm=!1,"function"==typeof e&&e()),h.loading=!1},m)}function m(e){h.loading=!1,h.searchLoading=!1,"web.messages.emptyOrder"!==e.error&&(h.errorMessage=e.error)}function g(){n.finishSeparatePassengersSearch().then(f,m)}function p(){h.showSearchForm=!0}function v(){h.submitButtonHover=!h.submitButtonHover}var h=this;h.loading=!0,h.searchOrderLoading=!0,h.orderServicesLoading=!0,h.showSearchForm=!0,h.searchParams={},h.partiallyAddedPassengers=[],h.submitPayment=i,h.submitSearch=l,h.confirmHandler=g,h.clear=d,h.addPassenger=p,h.swithcSubmitButtonHoverState=v,n.ready.then(function(){angular.element("title").text(n.getAliasWithPrefix("web.pageTitle.","searchOrder")),h.passengerLastNameRegexp=n.applicationConstants.passengerLastNameRegexp,h.pnrOrTicketRegexp=n.applicationConstants.pnrOrTicketRegexp,h.ticketRegexp=n.applicationConstants.ticketRegexp,n.clearOrderInfoListeners(),n.clearUpdateOrderServicesListeners(),r.pnrOrTicketNumber&&r.lastName&&"LAST_NAME_PNR_TICKET"===n.getParam("site.searchOrdersBy")?(h.searchParams.pnrOrTicketNumber=r.pnrOrTicketNumber,h.searchParams.lastName=r.lastName,h.loading=!1,s(l)):(f(),u()),n.addOrderInfoListener(function(e){h.orderInfo=e})})}angular.module("app").controller("SearchOrderScreenController",["$scope","$routeParams","backend","redirect","$timeout","utils","fancyboxTools",t])},{}]},{},[12]);
//# sourceMappingURL=controllers-nordwind.js.map
