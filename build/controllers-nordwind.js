!function(){function e(r,a,n){function o(s,i){if(!a[s]){if(!r[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(t)return t(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[s]={exports:{}};r[s][0].call(u.exports,function(e){var a=r[s][1][e];return o(a||e)},u,u.exports,e,r,a,n)}return a[s].exports}for(var t="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}return e}()({1:[function(e,r,a){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order")},{"./screens/add-services/AddServicesScreenController":2,"./screens/search-order/search-order":3}],2:[function(e,r,a){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,a,n,o,t,s){function i(){o.addOrderInfoListener(function(e){p.orderInfo=e}),o.addUpdateOrderServicesListener(function(e){p.orderInfo=e[1],p.priceVariant=e[2],p.isFreePricevariant=t.isFreePricevariant(e[2]),p.isFreePricevariant&&(p.showNeedSelectPaymentFormMesage=!1),p.es=t.reformatAvailableExtraServices(e[0],p.orderInfo,p.es),p.esList=t.getAvailableExtraServicesList(e[0],p.es),p.searchOrderLoading=!1,p.orderServicesLoading=!1,o.getParam("ffp.enable")&&(p.orderInfo.hasBonusCard||p.orderInfo.ffpSumm)&&o.ffpBonus().then(function(e){p.ffpBonus=e.total||0})},function(e){p.searchOrderLoading=!1,p.orderServicesLoading=!1,p.errorMessage=e.error,"web.extraServices.submitError"===p.errorMessage&&(p.showBackButton=!0)}),o.updateOrderServices(!0).then(function(){p.loading=!0,o.switchDefaultSelectedServices(p.esList,p.es,p.orderInfo).then(function(){p.loading=!1})}),o.addExtraServiceListener(function(e){p.modifyServicesLoading=!e,p.orderServicesLoading=!0}),o.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(p.modifyServicesError=e.error),p.modifyServicesLoading=!1,p.orderServicesLoading=!0})}function c(e){!p.agree||p.modifyServicesLoading||p.orderServicesLoading||(p.selectedPaymentForm&&p.selectedPaymentType?o.getParam("site.rossiyaAirlineMode")?s.openHandler("popupOrderEmailRequired",!1,{phoneRequiredToo:!0,submitCallback:function(r,a){d(e,r,a)}}):d(e):p.showNeedSelectPaymentFormMesage=!0)}function d(e,r,a){p.confirmLoading=!0,p.confirmError&&delete p.confirmError,o.startPaymentForExtraServices(p.selectedPaymentForm,p.selectedPaymentType,e,r,a,p.card).then(function(t){t.pnr&&t.lastName?n.goToConfirmOrder(t.pnr,t.lastName):t.eraseAeroexpressBecauseOfCurrency||t.eraseInsuranceBecauseOfCurrency?s.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:t.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:t.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:c}):t.removedSvcs&&t.removedSvcs.length&&s.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d(e,r,a)},closeCallback:function(){o.updateOrderServices(!0)},removedSvcs:t.removedSvcs,svcsToIssue:t.svcsToIssue,noExtraServicesLeft:t.noExtraServicesLeft,disableOutsideCloseClick:!0}),p.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?p.fatalError=e.error:p.confirmError=e.error,p.confirmLoading=!1})}function u(){p.showNeedSelectPaymentFormMesage=!1}function l(){return a.location.reload(),!1}function f(e,r){o.getParam("site.separatePassengersSearchOrder")?n.goToViewSeparateOrder(e,r):n.goToSearchOrder(e,r)}function m(){o.clearSession().then(function(){n.goToSearchOrder()})}var p=this;p.loading=!0,p.searchOrderLoading=!0,p.orderServicesLoading=!0,p.openOrder=f,p.submitPayment=c,p.paymentFormChangeHandler=u,p.reloadPage=l,p.clearSession=m,e.$on("plasticCardForPaymentChangeEvent",function(e,r){p.card=r}),o.ready.then(function(){angular.element("title").text(o.getAliasWithPrefix("web.pageTitle.","addServices")),p.pnrOrTicketNumber=r.pnrOrTicketNumber,p.lastName=r.lastName,p.loading=!1,o.clearOrderInfoListeners(),o.clearUpdateOrderServicesListeners(),p.orderInfo=o.getOrderInfo(),p.orderInfo?i():o.searchOrder(p.pnrOrTicketNumber,p.lastName,!0).then(i,function(e){p.searchOrderLoading=!1,p.orderServicesLoading=!1,p.errorMessage=e.error})})}])},{}],3:[function(e,r,a){"use strict";function n(e,r,a){function n(){t.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!t.searchOrderAgree||!t.searchOrderForm.$valid||a.goToAddServices(t.searchParams.pnrOrTicketNumber,t.searchParams.lastName)}function o(){t.pnrOrTicketNumber=!1,t.lastName=!1}var t=this;t.loading=!0,t.searchParams={},t.submitSearch=n,t.clear=o,r.ready.then(function(){return r.getParam("site.rossiyaAirlineMode")?void a.goToSearchSeparateOrder():(angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),t.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,t.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,r.clearOrderInfo(),r.addOrderInfoListener(function(){t.orderLoaded=!0}),e.pnrOrTicketNumber&&e.lastName&&(t.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,t.searchParams.lastName=e.lastName,t.pnrOrTicketNumber=e.pnrOrTicketNumber,t.lastName=e.lastName,t.submitTouched=!0),void(t.loading=!1))})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","redirect",n])},{}]},{},[1]);
//# sourceMappingURL=controllers-nordwind.js.map
