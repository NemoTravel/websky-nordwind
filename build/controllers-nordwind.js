!function(){function e(r,a,n){function o(t,i){if(!a[t]){if(!r[t]){var c="function"==typeof require&&require;if(!i&&c)return c(t,!0);if(s)return s(t,!0);var d=new Error("Cannot find module '"+t+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[t]={exports:{}};r[t][0].call(u.exports,function(e){var a=r[t][1][e];return o(a||e)},u,u.exports,e,r,a,n)}return a[t].exports}for(var s="function"==typeof require&&require,t=0;t<n.length;t++)o(n[t]);return o}return e}()({1:[function(e,r,a){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),angular.module("app").run(["$rootScope","redirect","backend",function(e,r,a){e.$on("$locationChangeStart",function(e){var n=location.href.split("#")[1];n=n.split("/");var o=n[1],s=n[2],t=n[3];"add-services"===o&&s&&t&&(t=decodeURIComponent(t),a.searchOrder(s,t).then(function(e){r.goToAddServices()}))})}])},{"./screens/add-services/AddServicesScreenController":2,"./screens/search-order/search-order":3}],2:[function(e,r,a){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,a,n,o,s,t){function i(e){!m.agree||m.modifyServicesLoading||m.orderServicesLoading||(m.selectedPaymentForm&&m.selectedPaymentType?c(e):m.showNeedSelectPaymentFormMesage=!0)}function c(e,r,a){m.confirmLoading=!0,m.confirmError&&delete m.confirmError,o.startPaymentForExtraServices(m.selectedPaymentForm,m.selectedPaymentType,e,r,a,m.card).then(function(s){s.pnr&&s.lastName?n.goToConfirmOrder():s.eraseAeroexpressBecauseOfCurrency||s.eraseInsuranceBecauseOfCurrency?t.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:s.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:s.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:i}):s.removedSvcs&&s.removedSvcs.length&&t.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){c(e,r,a)},closeCallback:function(){o.updateOrderServices(!0)},removedSvcs:s.removedSvcs,svcsToIssue:s.svcsToIssue,noExtraServicesLeft:s.noExtraServicesLeft,disableOutsideCloseClick:!0}),m.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?m.fatalError=e.error:m.confirmError=e.error,m.confirmLoading=!1})}function d(){m.showNeedSelectPaymentFormMesage=!1}function u(){return a.location.reload(),!1}function l(){o.clearSession().then(function(){n.goToSearchOrder()})}function f(){m.submitButtonHover=!m.submitButtonHover}var m=this;m.loading=!0,m.searchOrderLoading=!0,m.orderServicesLoading=!0,m.openOrder=n.goToSearchOrder,m.submitPayment=i,m.paymentFormChangeHandler=d,m.reloadPage=u,m.clearSession=l,m.swithcSubmitButtonHoverState=f,e.$on("plasticCardForPaymentChangeEvent",function(e,r){m.card=r}),o.ready.then(function(){angular.element("title").text(o.getAliasWithPrefix("web.pageTitle.","addServices")),m.loading=!1,o.clearOrderInfoListeners(),o.clearUpdateOrderServicesListeners(),o.addOrderInfoListener(function(e){m.orderInfo=e}),o.addUpdateOrderServicesListener(function(e){m.orderInfo=e[1],m.priceVariant=e[2],m.isFreePricevariant=s.isFreePricevariant(e[2]),m.isFreePricevariant&&(m.showNeedSelectPaymentFormMesage=!1),m.es=s.reformatAvailableExtraServices(e[0],m.orderInfo,m.es),m.esList=s.getAvailableExtraServicesList(e[0],m.es),m.searchOrderLoading=!1,m.orderServicesLoading=!1,o.getParam("ffp.enable")&&(m.orderInfo.hasBonusCard||m.orderInfo.ffpSumm)&&o.ffpBonus().then(function(e){m.ffpBonus=e.total||0})},function(e){m.searchOrderLoading=!1,m.orderServicesLoading=!1,m.errorMessage=e.error}),o.updateOrderServices(!0).then(function(){m.loading=!0,o.switchDefaultSelectedServices(m.esList,m.es,m.orderInfo).then(function(){m.loading=!1},function(e){m.errorMessage=e.error,m.loading=!1})}),o.addExtraServiceListener(function(e){m.modifyServicesLoading=!e,m.orderServicesLoading=!0}),o.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(m.modifyServicesError=e.error),m.modifyServicesLoading=!1,m.orderServicesLoading=!0})})}])},{}],3:[function(e,r,a){"use strict";function n(e,r,a){function n(){r.clearSession(),r.clearOrderInfo(),d.orderInfo=!1,d.showSearchForm=!0,d.partiallyAddedPassengers=[]}function o(){d.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!d.searchOrderAgree||!d.searchOrderForm.$valid||(d.searchLoading=!0,d.errorMessage=!1,r.searchOrderByParams(d.searchParams,!!d.partiallyAddedPassengers.length).then(function(e){d.searchParams.flight&&d.searchParams.date?d.searchParams={flight:d.searchParams.flight,date:d.searchParams.date}:e.needToSpecifyDocument||(d.searchParams={}),d.needToSpecifyDocument=e.needToSpecifyDocument,d.showSearchForm=!1,d.submitTouched=!1,e.orderCompletelyInitialized?(d.partiallyAddedPassengers=[],s()):(e.partiallyAddedPassengers&&(d.partiallyAddedPassengers=e.partiallyAddedPassengers),d.needToSpecifyDocument&&(d.showSearchForm=!0)),d.searchLoading=!1},t))}function s(){r.updateOrderInfo().then(function(e){e.passengers&&(d.orderInfo=e,d.showSearchForm=!1),d.loading=!1},t)}function t(e){d.loading=!1,d.searchLoading=!1,"web.messages.emptyOrder"!==e.error&&(d.errorMessage=e.error)}function i(){r.finishSeparatePassengersSearch().then(s,t)}function c(){d.showSearchForm=!0}var d=this;d.loading=!0,d.showSearchForm=!0,d.searchParams={},d.partiallyAddedPassengers=[],d.submitSearch=o,d.confirmHandler=i,d.clear=n,d.addPassenger=c,r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),d.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,d.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,d.ticketRegexp=r.applicationConstants.ticketRegexp,e.pnrOrTicketNumber&&e.lastName&&"LAST_NAME_PNR_TICKET"===r.getParam("site.searchOrdersBy")?(d.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,d.searchParams.lastName=e.lastName,d.loading=!1,a(o)):s()})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","$timeout",n])},{}]},{},[1]);
//# sourceMappingURL=controllers-nordwind.js.map
