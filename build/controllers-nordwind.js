!function(){function e(r,n,o){function a(i,s){if(!n[i]){if(!r[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(t)return t(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[i]={exports:{}};r[i][0].call(u.exports,function(e){var n=r[i][1][e];return a(n||e)},u,u.exports,e,r,n,o)}return n[i].exports}for(var t="function"==typeof require&&require,i=0;i<o.length;i++)a(o[i]);return a}return e}()({1:[function(e,r,n){"use strict";angular.module("app").component("popupExtraServicesRules",{templateUrl:"components/popup-extra-services-rules/popup-extra-services-rules.html",controllerAs:"vm",controller:function(){var e=this;e.close=jQuery.fancybox.close}})},{}],2:[function(e,r,n){"use strict";function o(){function e(e){n.agreeWithAirplaneChange=e,e?(n.service.active=e,n.service.userAgree=!0,n.close()):(n.service.active=!1,n.close())}function r(){n.isDropdownOpen=!n.isDropdownOpen}var n=this;n.isDropdownOpen=!1,n.isUserAgree=e,n.switchDropdown=r,n.close=jQuery.fancybox.close}angular.module("app").component("popupSeatWarning",{templateUrl:"components/popup-seat-warning/popup-seat-warning.html",controller:[o],controllerAs:"vm",bindings:{agreeWithAirplaneChange:"=",service:"="}})},{}],3:[function(e,r,n){"use strict";function o(e){var r=this,n=["AM","KZ","GE","TJ","UZ","лблю","AZ","KG","TM"],o=r.routes[0].flights[0];e.$watch("vm.routes",function(){r.routes&&("MOW"===o.origincity&&"CUN"===o.destinationcity?(r.dontFlyToMexico=!0,r.countries=r.countries.filter(function(e){return!_.contains(n,e.code)})):r.dontFlyToMexico=!1)})}var a=angular.module("app");a.directive("hideCountriesOnSpecificRoute",function(){return{controller:"hideCountriesOnSpecificRouteController",controllerAs:"vm",bindToController:!0,scope:{routes:"<",countries:"=",dontFlyToMexico:"="}}}),a.controller("hideCountriesOnSpecificRouteController",["$scope",o])},{}],4:[function(e,r,n){"use strict";function o(e,r,n){function o(e){e&&_.forEach(e,function(e){_.forEach(e.flights,function(e){var n=e.originport?e.originport:e.origincity,o=e.destinationport?e.destinationport:e.destinationcity,a=!1;_.forEach(l.redefineRules,function(t){_.forEach(t.routes,function(i){if(n===i.from&&o===i.to||i.from===o&&i.to===n){console.log("we redefine some rules here, check the replacWith directive"),a=!0;var s={brand:e.brand,brandAvailableProps:e.brandAvailableProps,brandUnavailableProps:e.brandUnavailableProps,brandPaidProps:e.brandPaidProps},c=r.getBrandConfig();c.filter(function(e){return e.code===s.brand})[0];_.forEach(t.brands,function(r){if(s.brand===r.brand){_.forEach(r.props,function(r){switch(r.available){case"yes":e.brandAvailableProps.push(r.name);break;case"no":e.brandUnavailableProps.push(r.name);break;case"paid":e.brandPaidProps.push(r.name)}})}})}})})})})}function a(e){l.needToRestoreBrandsInfo=!1,e&&"boolean"==typeof l.originalBrands&&(l.originalBrands=angular.copy(r.getBrandConfig()));var n=!1;t(e)&&(n=!0),n?i(e.brandsList):"boolean"!=typeof l.originalBrands&&e.brandsList&&(e.brandsList=e.brandsList.map(function(e,r){return l.originalBrands.filter(function(r){return r.code===e.code})[0]}),l.needToRestoreBrandsInfo=!0)}function t(e){var r=!1;return _.forEach(l.redefineRules,function(n){_.forEach(n.routes,function(n){_.forEach(e.segmentRows,function(e){_.forEach(e,function(e){var o=e.flightsInfo.originport?e.flightsInfo.originport:e.flightsInfo.origincity,a=e.flightsInfo.destinationport?e.flightsInfo.destinationport:e.flightsInfo.destinationcity;(o===n.from&&a===n.to||o===n.to&&a===n.from)&&(r=!0)})})})}),r}function i(e){_.forEach(l.redefineRules,function(r){_.forEach(r.brands,function(r){_.forEach(e.slice(),function(e){e.code===r.brand&&s(e,r)})})})}function s(e,r){console.log("we redefine some rules here, head to web.brandConfig.redefine"),console.log(e,r),_.forEach(e.props,function(e){r.props[e.code]&&_.extend(e,r.props[e.code])})}function c(){l.selectedVariantsInfo&&l.needToRestoreBrandsInfo&&(console.log("restoreBrandsInfo"),_.forEach(l.selectedVariantsInfo,d))}function d(e){var r=u(e.brand),n=[],o=[],a=[];_.forEach(r.props,function(e){switch(e.available){case"yes":e.shortDesc?n.push(e.shortDesc):n.push(e.name);break;case"paid":o.push(e.name);break;case"no":a.push(e.name);break;default:return}}),e.brandAvailableProps=n.slice(),e.brandPaidProps=o.slice(),e.brandUnavailableProps=a.slice()}function u(e){return l.originalBrands.filter(function(r){return r.code===e})[0]}var l=e.$parent.vm;l.originalBrands=!1,l.needToRestoreBrandsInfo=!1,r.ready.then(function(){try{var t=JSON.parse(r.getAlias("web.brandConfig.redefine"))}catch(i){console.error("redefine rules parse error",i)}l.redefineRules=t,e.$watch(angular.bind(this,function(){return l.selectedVariantsInfo}),c),e.$watch(angular.bind(this,function(){return l.searchResult}),function(e){"/search-order"!==n.path()&&a(e)}),e.$watch(angular.bind(this,function(){return l.orderInfo?l.orderInfo.flights:void 0}),function(e){o(e)})})}var a=angular.module("app");a.directive("replaceWith",function(){return{scope:!1,controllerAs:"replaceWith",bindToController:!0,scopeAs:"vm",controller:"isRouteController"}}),a.controller("isRouteController",["$scope","backend","$location",o])},{}],5:[function(e,r,n){"use strict";function o(e,r,n){var o=this;o.showPopup=null,r.ready.then(function(){o.showPopup=!!r.getAlias("web.seatWarning.content").length}),e.$watch("vm.service.active",function(e){e&&!o.service.userAgree&&e===!0&&o.showPopup&&(o.service.active=!1,n.openHandler("popupSeatWarning"))})}var a=angular.module("app");a.directive("showAirplanePopup",function(){return{scope:{service:"=service",showWarningSeatPopup:"=showWarningSeatPopup",popupWasAccepted:"="},controllerAs:"vm",priority:1e4,bindToController:!0,controller:"showAirplanePopupInfoController"}}),a.controller("showAirplanePopupInfoController",["$scope","backend","fancyboxTools",o])},{}],6:[function(e,r,n){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),e("./directives/replaceWith"),e("./directives/showAirplanePopupInfo"),e("./directives/hideCountriesOnSpecificRoute"),e("./components/popup-seat-warning/popup-seat-warning"),e("./components/popup-extra-services-rules/popup-extra-services-rules"),angular.module("app").run(["$rootScope","redirect","backend",function(e,r,n){e.$on("$locationChangeStart",function(e){var n=location.href.split("#")[1];n=n.split("/");var o=n[1],a=n[2],t=n[3];"add-services"===o&&a&&t&&(t=decodeURIComponent(t),r.goToSearchOrder(a,t))})}])},{"./components/popup-extra-services-rules/popup-extra-services-rules":1,"./components/popup-seat-warning/popup-seat-warning":2,"./directives/hideCountriesOnSpecificRoute":3,"./directives/replaceWith":4,"./directives/showAirplanePopupInfo":5,"./screens/add-services/AddServicesScreenController":7,"./screens/search-order/search-order":8}],7:[function(e,r,n){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,n,o,a,t,i){function s(e){!f.agree||f.modifyServicesLoading||f.orderServicesLoading||(f.selectedPaymentForm&&f.selectedPaymentType?c(e):f.showNeedSelectPaymentFormMesage=!0)}function c(e,r,n){f.confirmLoading=!0,f.confirmError&&delete f.confirmError,a.startPaymentForExtraServices(f.selectedPaymentForm,f.selectedPaymentType,e,r,n,f.card).then(function(t){t.pnr&&t.lastName?o.goToConfirmOrder():t.eraseAeroexpressBecauseOfCurrency||t.eraseInsuranceBecauseOfCurrency?i.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:t.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:t.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:s}):t.removedSvcs&&t.removedSvcs.length&&i.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){c(e,r,n)},closeCallback:function(){a.updateOrderServices(!0)},removedSvcs:t.removedSvcs,svcsToIssue:t.svcsToIssue,noExtraServicesLeft:t.noExtraServicesLeft,disableOutsideCloseClick:!0}),f.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?f.fatalError=e.error:f.confirmError=e.error,f.confirmLoading=!1})}function d(){f.showNeedSelectPaymentFormMesage=!1}function u(){return n.location.reload(),!1}function l(){a.clearSession().then(function(){o.goToSearchOrder()})}function p(){f.submitButtonHover=!f.submitButtonHover}var f=this;f.loading=!0,f.searchOrderLoading=!0,f.orderServicesLoading=!0,f.openOrder=o.goToSearchOrder,f.submitPayment=s,f.paymentFormChangeHandler=d,f.reloadPage=u,f.clearSession=l,f.swithcSubmitButtonHoverState=p,e.$on("plasticCardForPaymentChangeEvent",function(e,r){f.card=r}),a.ready.then(function(){angular.element("title").text(a.getAliasWithPrefix("web.pageTitle.","addServices")),f.loading=!1,a.clearOrderInfoListeners(),a.clearUpdateOrderServicesListeners(),a.addOrderInfoListener(function(e){f.orderInfo=e}),a.addUpdateOrderServicesListener(function(e){f.orderInfo=e[1],f.priceVariant=e[2],f.isFreePricevariant=t.isFreePricevariant(e[2]),f.isFreePricevariant&&(f.showNeedSelectPaymentFormMesage=!1),f.es=t.reformatAvailableExtraServices(e[0],f.orderInfo,f.es),f.esList=t.getAvailableExtraServicesList(e[0],f.es),f.searchOrderLoading=!1,f.orderServicesLoading=!1,a.getParam("ffp.enable")&&(f.orderInfo.hasBonusCard||f.orderInfo.ffpSumm)&&a.ffpBonus().then(function(e){f.ffpBonus=e.total||0})},function(e){f.searchOrderLoading=!1,f.orderServicesLoading=!1,f.errorMessage=e.error}),a.updateOrderServices(!0).then(function(){f.loading=!0,a.switchDefaultSelectedServices(f.esList,f.es,f.orderInfo).then(function(){f.loading=!1},function(e){f.errorMessage=e.error,f.loading=!1})}),a.addExtraServiceListener(function(e){f.modifyServicesLoading=!e,f.orderServicesLoading=!0}),a.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(f.modifyServicesError=e.error),f.modifyServicesLoading=!1,f.orderServicesLoading=!0})})}])},{}],8:[function(e,r,n){"use strict";function o(e,r,n,o){function a(){r.clearSession(),r.clearOrderInfo(),l.orderInfo=!1,l.showSearchForm=!0,l.partiallyAddedPassengers=[]}function t(){l.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!l.searchOrderAgree||!l.searchOrderForm.$valid||(l.searchLoading=!0,l.errorMessage=!1,r.searchOrderByParams(l.searchParams,!!l.partiallyAddedPassengers.length).then(function(e){l.searchParams.flight&&l.searchParams.date?l.searchParams={flight:l.searchParams.flight,date:l.searchParams.date}:e.needToSpecifyDocument||(l.searchParams={}),l.needToSpecifyDocument=e.needToSpecifyDocument,l.showSearchForm=!1,l.submitTouched=!1,e.orderCompletelyInitialized?(l.partiallyAddedPassengers=[],i(function(){console.log("inside updateOrderInfoHandler(callback)"),l.orderInfo.addingExtraServicesAllowed&&n.goToAddServices(l.searchParams.pnrOrTicketNumber,l.searchParams.lastName)})):(e.partiallyAddedPassengers&&(l.partiallyAddedPassengers=e.partiallyAddedPassengers),l.needToSpecifyDocument&&(l.showSearchForm=!0)),l.searchLoading=!1},s))}function i(e){r.updateOrderInfo().then(function(r){r.passengers&&(l.orderInfo=r,l.showSearchForm=!1,"function"==typeof e&&e()),l.loading=!1},s)}function s(e){l.loading=!1,l.searchLoading=!1,"web.messages.emptyOrder"!==e.error&&(l.errorMessage=e.error)}function c(){r.finishSeparatePassengersSearch().then(i,s)}function d(){l.showSearchForm=!0}function u(){l.submitButtonHover=!l.submitButtonHover}var l=this;l.loading=!0,l.showSearchForm=!0,l.searchParams={},l.partiallyAddedPassengers=[],l.submitSearch=t,l.confirmHandler=c,l.clear=a,l.addPassenger=d,l.swithcSubmitButtonHoverState=u,r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),l.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,l.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,l.ticketRegexp=r.applicationConstants.ticketRegexp,e.pnrOrTicketNumber&&e.lastName&&"LAST_NAME_PNR_TICKET"===r.getParam("site.searchOrdersBy")?(l.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,l.searchParams.lastName=e.lastName,l.loading=!1,o(t)):i()})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","redirect","$timeout",o])},{}]},{},[6]);
//# sourceMappingURL=controllers-nordwind.js.map
