!function(){function e(r,a,n){function o(t,i){if(!a[t]){if(!r[t]){var c="function"==typeof require&&require;if(!i&&c)return c(t,!0);if(s)return s(t,!0);var d=new Error("Cannot find module '"+t+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[t]={exports:{}};r[t][0].call(u.exports,function(e){var a=r[t][1][e];return o(a||e)},u,u.exports,e,r,a,n)}return a[t].exports}for(var s="function"==typeof require&&require,t=0;t<n.length;t++)o(n[t]);return o}return e}()({1:[function(e,r,a){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order")},{"./screens/add-services/AddServicesScreenController":2,"./screens/search-order/search-order":3}],2:[function(e,r,a){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,a,n,o,s,t){function i(){o.addOrderInfoListener(function(e){g.orderInfo=e}),o.addUpdateOrderServicesListener(function(e){g.orderInfo=e[1],g.priceVariant=e[2],g.isFreePricevariant=s.isFreePricevariant(e[2]),g.isFreePricevariant&&(g.showNeedSelectPaymentFormMesage=!1),g.es=s.reformatAvailableExtraServices(e[0],g.orderInfo,g.es),g.esList=s.getAvailableExtraServicesList(e[0],g.es),g.searchOrderLoading=!1,g.orderServicesLoading=!1,o.getParam("ffp.enable")&&(g.orderInfo.hasBonusCard||g.orderInfo.ffpSumm)&&o.ffpBonus().then(function(e){g.ffpBonus=e.total||0})},function(e){g.searchOrderLoading=!1,g.orderServicesLoading=!1,g.errorMessage=e.error,"web.extraServices.submitError"===g.errorMessage&&(g.showBackButton=!0)}),o.updateOrderServices(!0).then(function(){g.loading=!0,o.switchDefaultSelectedServices(g.esList,g.es,g.orderInfo).then(function(){g.loading=!1})}),o.addExtraServiceListener(function(e){g.modifyServicesLoading=!e,g.orderServicesLoading=!0}),o.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(g.modifyServicesError=e.error),g.modifyServicesLoading=!1,g.orderServicesLoading=!0})}function c(e){!g.agree||g.modifyServicesLoading||g.orderServicesLoading||(g.selectedPaymentForm&&g.selectedPaymentType?o.getParam("site.rossiyaAirlineMode")?t.openHandler("popupOrderEmailRequired",!1,{phoneRequiredToo:!0,submitCallback:function(r,a){d(e,r,a)}}):d(e):g.showNeedSelectPaymentFormMesage=!0)}function d(e,r,a){g.confirmLoading=!0,g.confirmError&&delete g.confirmError,o.startPaymentForExtraServices(g.selectedPaymentForm,g.selectedPaymentType,e,r,a,g.card).then(function(s){s.pnr&&s.lastName?n.goToConfirmOrder(s.pnr,s.lastName):s.eraseAeroexpressBecauseOfCurrency||s.eraseInsuranceBecauseOfCurrency?t.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:s.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:s.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:c}):s.removedSvcs&&s.removedSvcs.length&&t.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d(e,r,a)},closeCallback:function(){o.updateOrderServices(!0)},removedSvcs:s.removedSvcs,svcsToIssue:s.svcsToIssue,noExtraServicesLeft:s.noExtraServicesLeft,disableOutsideCloseClick:!0}),g.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?g.fatalError=e.error:g.confirmError=e.error,g.confirmLoading=!1})}function u(){g.showNeedSelectPaymentFormMesage=!1}function l(){return a.location.reload(),!1}function f(e,r){o.getParam("site.separatePassengersSearchOrder")?n.goToViewSeparateOrder(e,r):n.goToSearchOrder(e,r)}function m(){o.clearSession().then(function(){n.goToSearchOrder()})}var g=this;g.loading=!0,g.searchOrderLoading=!0,g.orderServicesLoading=!0,g.openOrder=f,g.submitPayment=c,g.paymentFormChangeHandler=u,g.reloadPage=l,g.clearSession=m,e.$on("plasticCardForPaymentChangeEvent",function(e,r){g.card=r}),o.ready.then(function(){angular.element("title").text(o.getAliasWithPrefix("web.pageTitle.","addServices")),g.pnrOrTicketNumber=r.pnrOrTicketNumber,g.lastName=r.lastName,g.loading=!1,o.clearOrderInfoListeners(),o.clearUpdateOrderServicesListeners(),g.orderInfo=o.getOrderInfo(),g.orderInfo?i():o.searchOrder(g.pnrOrTicketNumber,g.lastName,!0).then(i,function(e){g.searchOrderLoading=!1,g.orderServicesLoading=!1,g.errorMessage=e.error})})}])},{}],3:[function(e,r,a){"use strict";function n(e,r,a){function n(){r.clearOrderInfo(),u.orderInfo=!1,u.showSearchForm=!0,u.partiallyAddedPassengers=[]}function o(){u.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!u.searchOrderAgree||!u.searchOrderForm.$valid?u.loading=!1:(u.loading=!0,u.errorMessage=!1,r.searchOrderByParams(u.searchParams,!!u.partiallyAddedPassengers.length).then(function(e){u.searchParams.flight&&u.searchParams.date?u.searchParams={flight:u.searchParams.flight,date:u.searchParams.date}:e.needToSpecifyDocument||(u.searchParams={}),u.needToSpecifyDocument=e.needToSpecifyDocument,u.showSearchForm=!1,u.submitTouched=!1,e.orderCompletelyInitialized?(u.partiallyAddedPassengers=[],s()):(e.partiallyAddedPassengers&&(u.partiallyAddedPassengers=e.partiallyAddedPassengers),u.needToSpecifyDocument&&(u.showSearchForm=!0),u.loading=!1)},t))}function s(){r.updateOrderInfo().then(function(e){e.passengers&&(u.orderInfo=e,u.showSearchForm=!1),u.loading=!1},t)}function t(e){u.loading=!1,"web.messages.emptyOrder"!==e.error&&(u.errorMessage=e.error)}function i(){r.finishSeparatePassengersSearch().then(s,t)}function c(){u.showSearchForm=!0}function d(){u.submitButtonHover=!u.submitButtonHover}var u=this;u.loading=!0,u.showSearchForm=!0,u.searchParams={},u.partiallyAddedPassengers=[],u.submitSearch=o,u.confirmHandler=i,u.clear=n,u.addPassenger=c,u.swithcSubmitButtonHoverState=d,r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),u.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,u.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,u.ticketRegexp=r.applicationConstants.ticketRegexp,e.pnrOrTicketNumber&&e.lastName&&"LAST_NAME_PNR_TICKET"===r.getParam("site.searchOrdersBy")?(u.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,u.searchParams.lastName=e.lastName,u.pnrOrTicketNumber=e.pnrOrTicketNumber,u.lastName=e.lastName,u.loading=!1,a(o)):s()})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","$timeout",n])},{}]},{},[1]);
//# sourceMappingURL=controllers-nordwind.js.map
