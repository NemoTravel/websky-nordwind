!function(){function e(r,n,o){function a(s,i){if(!n[s]){if(!r[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(t)return t(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[s]={exports:{}};r[s][0].call(u.exports,function(e){var n=r[s][1][e];return a(n||e)},u,u.exports,e,r,n,o)}return n[s].exports}for(var t="function"==typeof require&&require,s=0;s<o.length;s++)a(o[s]);return a}return e}()({1:[function(e,r,n){"use strict";function o(e,r){function n(e){_.forEach(a.redefineRules,function(r){_.forEach(r.brands,function(r){_.forEach(e,function(e){e.code===r.brand&&o(e,r)})})})}function o(e,r){console.log(e,r),_.forEach(e.props,function(e){r.props[e.code]&&_.extend(e,r.props[e.code])})}var a=e.$parent.vm,t=null;r.ready.then(function(){try{var e=JSON.parse(r.getAlias("web.brandConfig.redefine"))}catch(n){console.error("redefine rules parse error",n)}a.redefineRules=e}),e.$watch(angular.bind(this,function(){return a.searchResult}),function(e){t=e;var r=!1;_.forEach(a.redefineRules,function(n){_.forEach(n.routes,function(n){_.forEach(e.segmentRows,function(e){_.forEach(e,function(o){console.log(e),o.flightsInfo.origincity===n.from&&o.flightsInfo.destinationcity===n.to&&(console.log("we redefine some rules here, head to web.brandConfig.redefine"),r=!0)})})})}),r&&n(e.brandsList)})}var a=angular.module("app");a.directive("replaceWith",function(){return{scope:!1,controllerAs:"replaceWith",bindToController:!0,scopeAs:"vm",controller:"isRouteController"}}),a.controller("isRouteController",["$scope","backend",o])},{}],2:[function(e,r,n){"use strict";e("./screens/add-services/AddServicesScreenController"),e("./screens/search-order/search-order"),e("./directives/replaceWith"),angular.module("app").run(["$rootScope","redirect","backend",function(e,r,n){e.$on("$locationChangeStart",function(e){var n=location.href.split("#")[1];n=n.split("/");var o=n[1],a=n[2],t=n[3];"add-services"===o&&a&&t&&(t=decodeURIComponent(t),r.goToSearchOrder(a,t))})}])},{"./directives/replaceWith":1,"./screens/add-services/AddServicesScreenController":3,"./screens/search-order/search-order":4}],3:[function(e,r,n){"use strict";angular.module("app").controller("AddServicesScreenController",["$scope","$routeParams","$window","redirect","backend","utils","fancyboxTools",function(e,r,n,o,a,t,s){function i(e){!m.agree||m.modifyServicesLoading||m.orderServicesLoading||(m.selectedPaymentForm&&m.selectedPaymentType?c(e):m.showNeedSelectPaymentFormMesage=!0)}function c(e,r,n){m.confirmLoading=!0,m.confirmError&&delete m.confirmError,a.startPaymentForExtraServices(m.selectedPaymentForm,m.selectedPaymentType,e,r,n,m.card).then(function(t){t.pnr&&t.lastName?o.goToConfirmOrder():t.eraseAeroexpressBecauseOfCurrency||t.eraseInsuranceBecauseOfCurrency?s.openHandler("popupChangeCurrencyError",!1,{eraseAeroexpressBecauseOfCurrency:t.eraseAeroexpressBecauseOfCurrency,eraseInsuranceBecauseOfCurrency:t.eraseInsuranceBecauseOfCurrency,mode:"addServices",submitCallback:i}):t.removedSvcs&&t.removedSvcs.length&&s.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){c(e,r,n)},closeCallback:function(){a.updateOrderServices(!0)},removedSvcs:t.removedSvcs,svcsToIssue:t.svcsToIssue,noExtraServicesLeft:t.noExtraServicesLeft,disableOutsideCloseClick:!0}),m.confirmLoading=!1},function(e){"web.noBookedConfirmedExtraServices"===e.error?m.fatalError=e.error:m.confirmError=e.error,m.confirmLoading=!1})}function d(){m.showNeedSelectPaymentFormMesage=!1}function u(){return n.location.reload(),!1}function l(){a.clearSession().then(function(){o.goToSearchOrder()})}function f(){m.submitButtonHover=!m.submitButtonHover}var m=this;m.loading=!0,m.searchOrderLoading=!0,m.orderServicesLoading=!0,m.openOrder=o.goToSearchOrder,m.submitPayment=i,m.paymentFormChangeHandler=d,m.reloadPage=u,m.clearSession=l,m.swithcSubmitButtonHoverState=f,e.$on("plasticCardForPaymentChangeEvent",function(e,r){m.card=r}),a.ready.then(function(){angular.element("title").text(a.getAliasWithPrefix("web.pageTitle.","addServices")),m.loading=!1,a.clearOrderInfoListeners(),a.clearUpdateOrderServicesListeners(),a.addOrderInfoListener(function(e){m.orderInfo=e}),a.addUpdateOrderServicesListener(function(e){m.orderInfo=e[1],m.priceVariant=e[2],m.isFreePricevariant=t.isFreePricevariant(e[2]),m.isFreePricevariant&&(m.showNeedSelectPaymentFormMesage=!1),m.es=t.reformatAvailableExtraServices(e[0],m.orderInfo,m.es),m.esList=t.getAvailableExtraServicesList(e[0],m.es),m.searchOrderLoading=!1,m.orderServicesLoading=!1,a.getParam("ffp.enable")&&(m.orderInfo.hasBonusCard||m.orderInfo.ffpSumm)&&a.ffpBonus().then(function(e){m.ffpBonus=e.total||0})},function(e){m.searchOrderLoading=!1,m.orderServicesLoading=!1,m.errorMessage=e.error}),a.updateOrderServices(!0).then(function(){m.loading=!0,a.switchDefaultSelectedServices(m.esList,m.es,m.orderInfo).then(function(){m.loading=!1},function(e){m.errorMessage=e.error,m.loading=!1})}),a.addExtraServiceListener(function(e){m.modifyServicesLoading=!e,m.orderServicesLoading=!0}),a.addExtraServiceErrorListener(function(e,r){r&&"seat"===r.code||(m.modifyServicesError=e.error),m.modifyServicesLoading=!1,m.orderServicesLoading=!0})})}])},{}],4:[function(e,r,n){"use strict";function o(e,r,n,o){function a(){r.clearSession(),r.clearOrderInfo(),l.orderInfo=!1,l.showSearchForm=!0,l.partiallyAddedPassengers=[]}function t(){l.submitTouched=!0,r.getParam("site.useSearchOrderAgreeCheckbox")&&!l.searchOrderAgree||!l.searchOrderForm.$valid||(l.searchLoading=!0,l.errorMessage=!1,r.searchOrderByParams(l.searchParams,!!l.partiallyAddedPassengers.length).then(function(e){l.searchParams.flight&&l.searchParams.date?l.searchParams={flight:l.searchParams.flight,date:l.searchParams.date}:e.needToSpecifyDocument||(l.searchParams={}),l.needToSpecifyDocument=e.needToSpecifyDocument,l.showSearchForm=!1,l.submitTouched=!1,e.orderCompletelyInitialized?(l.partiallyAddedPassengers=[],s(function(){console.log("inside updateOrderInfoHandler(callback)"),l.orderInfo.addingExtraServicesAllowed&&n.goToAddServices(l.searchParams.pnrOrTicketNumber,l.searchParams.lastName)})):(e.partiallyAddedPassengers&&(l.partiallyAddedPassengers=e.partiallyAddedPassengers),l.needToSpecifyDocument&&(l.showSearchForm=!0)),l.searchLoading=!1},i))}function s(e){r.updateOrderInfo().then(function(r){r.passengers&&(l.orderInfo=r,l.showSearchForm=!1,"function"==typeof e&&e()),l.loading=!1},i)}function i(e){l.loading=!1,l.searchLoading=!1,"web.messages.emptyOrder"!==e.error&&(l.errorMessage=e.error)}function c(){r.finishSeparatePassengersSearch().then(s,i)}function d(){l.showSearchForm=!0}function u(){l.submitButtonHover=!l.submitButtonHover}var l=this;l.loading=!0,l.showSearchForm=!0,l.searchParams={},l.partiallyAddedPassengers=[],l.submitSearch=t,l.confirmHandler=c,l.clear=a,l.addPassenger=d,l.swithcSubmitButtonHoverState=u,r.ready.then(function(){angular.element("title").text(r.getAliasWithPrefix("web.pageTitle.","searchOrder")),l.passengerLastNameRegexp=r.applicationConstants.passengerLastNameRegexp,l.pnrOrTicketRegexp=r.applicationConstants.pnrOrTicketRegexp,l.ticketRegexp=r.applicationConstants.ticketRegexp,e.pnrOrTicketNumber&&e.lastName&&"LAST_NAME_PNR_TICKET"===r.getParam("site.searchOrdersBy")?(l.searchParams.pnrOrTicketNumber=e.pnrOrTicketNumber,l.searchParams.lastName=e.lastName,l.loading=!1,o(t)):s()})}angular.module("app").controller("SearchOrderScreenController",["$routeParams","backend","redirect","$timeout",o])},{}]},{},[2]);
//# sourceMappingURL=controllers-nordwind.js.map
